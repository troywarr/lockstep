!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Lockstep=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
// shim for using process in browser

var process = module.exports = {};

process.nextTick = (function () {
    var canSetImmediate = typeof window !== 'undefined'
    && window.setImmediate;
    var canPost = typeof window !== 'undefined'
    && window.postMessage && window.addEventListener
    ;

    if (canSetImmediate) {
        return function (f) { return window.setImmediate(f) };
    }

    if (canPost) {
        var queue = [];
        window.addEventListener('message', function (ev) {
            var source = ev.source;
            if ((source === window || source === null) && ev.data === 'process-tick') {
                ev.stopPropagation();
                if (queue.length > 0) {
                    var fn = queue.shift();
                    fn();
                }
            }
        }, true);

        return function nextTick(fn) {
            queue.push(fn);
            window.postMessage('process-tick', '*');
        };
    }

    return function nextTick(fn) {
        setTimeout(fn, 0);
    };
})();

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
}

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};

},{}],2:[function(_dereq_,module,exports){
(function (process){
// Generated by CoffeeScript 1.7.1
(function() {
  var getNanoSeconds, hrtime, loadTime;

  if ((typeof performance !== "undefined" && performance !== null) && performance.now) {
    module.exports = function() {
      return performance.now();
    };
  } else if ((typeof process !== "undefined" && process !== null) && process.hrtime) {
    module.exports = function() {
      return (getNanoSeconds() - loadTime) / 1e6;
    };
    hrtime = process.hrtime;
    getNanoSeconds = function() {
      var hr;
      hr = hrtime();
      return hr[0] * 1e9 + hr[1];
    };
    loadTime = getNanoSeconds();
  } else if (Date.now) {
    module.exports = function() {
      return Date.now() - loadTime;
    };
    loadTime = Date.now();
  } else {
    module.exports = function() {
      return new Date().getTime() - loadTime;
    };
    loadTime = new Date().getTime();
  }

}).call(this);

}).call(this,_dereq_("1YiZ5S"))
},{"1YiZ5S":1}],3:[function(_dereq_,module,exports){
var now = _dereq_('performance-now')
  , global = typeof window === 'undefined' ? {} : window
  , vendors = ['moz', 'webkit']
  , suffix = 'AnimationFrame'
  , raf = global['request' + suffix]
  , caf = global['cancel' + suffix] || global['cancelRequest' + suffix]
  , isNative = true

for(var i = 0; i < vendors.length && !raf; i++) {
  raf = global[vendors[i] + 'Request' + suffix]
  caf = global[vendors[i] + 'Cancel' + suffix]
      || global[vendors[i] + 'CancelRequest' + suffix]
}

// Some versions of FF have rAF but not cAF
if(!raf || !caf) {
  isNative = false

  var last = 0
    , id = 0
    , queue = []
    , frameDuration = 1000 / 60

  raf = function(callback) {
    if(queue.length === 0) {
      var _now = now()
        , next = Math.max(0, frameDuration - (_now - last))
      last = next + _now
      setTimeout(function() {
        var cp = queue.slice(0)
        // Clear queue here to prevent
        // callbacks from appending listeners
        // to the current frame's queue
        queue.length = 0
        for(var i = 0; i < cp.length; i++) {
          if(!cp[i].cancelled) {
            try{
              cp[i].callback(last)
            } catch(e) {
              setTimeout(function() { throw e }, 0)
            }
          }
        }
      }, Math.round(next))
    }
    queue.push({
      handle: ++id,
      callback: callback,
      cancelled: false
    })
    return id
  }

  caf = function(handle) {
    for(var i = 0; i < queue.length; i++) {
      if(queue[i].handle === handle) {
        queue[i].cancelled = true
      }
    }
  }
}

module.exports = function(fn) {
  // Wrap in a new function to prevent
  // `cancel` potentially being assigned
  // to the native rAF function
  if(!isNative) {
    return raf.call(global, fn)
  }
  return raf.call(global, function() {
    try{
      fn.apply(this, arguments)
    } catch(e) {
      setTimeout(function() { throw e }, 0)
    }
  })
}
module.exports.cancel = function() {
  caf.apply(global, arguments)
}

},{"performance-now":4}],4:[function(_dereq_,module,exports){
(function (process){
// Generated by CoffeeScript 1.6.3
(function() {
  var getNanoSeconds, hrtime, loadTime;

  if ((typeof performance !== "undefined" && performance !== null) && performance.now) {
    module.exports = function() {
      return performance.now();
    };
  } else if ((typeof process !== "undefined" && process !== null) && process.hrtime) {
    module.exports = function() {
      return (getNanoSeconds() - loadTime) / 1e6;
    };
    hrtime = process.hrtime;
    getNanoSeconds = function() {
      var hr;
      hr = hrtime();
      return hr[0] * 1e9 + hr[1];
    };
    loadTime = getNanoSeconds();
  } else if (Date.now) {
    module.exports = function() {
      return Date.now() - loadTime;
    };
    loadTime = Date.now();
  } else {
    module.exports = function() {
      return new Date().getTime() - loadTime;
    };
    loadTime = new Date().getTime();
  }

}).call(this);

/*
//@ sourceMappingURL=performance-now.map
*/

}).call(this,_dereq_("1YiZ5S"))
},{"1YiZ5S":1}],5:[function(_dereq_,module,exports){
(function (process){
(function() {
  var COUNTS, INFO, Lockstep, MEASURES, MSQTY, NOOP, TIMES, now, raf,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  raf = _dereq_('raf');

  now = _dereq_('performance-now');

  MSQTY = {};

  MSQTY.microseconds = 0.001;

  MSQTY.milliseconds = MSQTY.microseconds * 1000;

  MSQTY.seconds = MSQTY.milliseconds * 1000;

  MSQTY.minutes = MSQTY.seconds * 60;

  MSQTY.hours = MSQTY.minutes * 60;

  MSQTY.days = MSQTY.hours * 24;

  NOOP = function() {};

  MEASURES = ['microseconds', 'milliseconds', 'seconds', 'minutes', 'hours', 'days'];

  TIMES = ['elapsed', 'clock'];

  COUNTS = ['start', 'stop', 'reset'];

  INFO = ['elapsed', 'clock', 'count'];

  Lockstep = (function() {
    function Lockstep() {
      this._loop = __bind(this._loop, this);
      var options;
      options = this._validateOptions(arguments);
      this.settings = this._buildSettings(options);
      this.running = false;
      this.microseconds = this._hasHighResolutionTime();
      this.count = {
        start: 0,
        stop: 0,
        reset: 0
      };
      this.time = {
        start: null,
        stop: null,
        run: 0
      };
    }

    Lockstep.prototype._type = function(value) {
      return {}.toString.call(value).match(/\s([a-zA-Z]+)/)[1].toLowerCase();
    };

    Lockstep.prototype._isInt = function(value) {
      return !isNaN(value) && parseInt(Number(value)) === value && !isNaN(parseInt(value, 10));
    };

    Lockstep.prototype._merge = function(obj1, obj2) {
      var name, obj3;
      obj3 = {};
      for (name in obj1) {
        obj3[name] = obj1[name];
      }
      for (name in obj2) {
        obj3[name] = obj2[name];
      }
      return obj3;
    };

    Lockstep.prototype._pad = function(int, length) {
      int += '';
      if (int.length >= length) {
        return int;
      } else {
        return "" + (new Array(length - int.length + 1).join('0')) + int;
      }
    };

    Lockstep.prototype._hasHighResolutionTime = function() {
      var _ref;
      return ((typeof window !== "undefined" && window !== null ? (_ref = window.performance) != null ? _ref.now : void 0 : void 0) != null) || ((typeof process !== "undefined" && process !== null ? process.hrtime : void 0) != null);
    };

    Lockstep.prototype._isValidTime = function(time) {
      var key, key2, oneTimeType, val, val2;
      oneTimeType = false;
      if (!this._type(time) === 'object') {
        return false;
      }
      for (key in time) {
        val = time[key];
        if (oneTimeType) {
          return false;
        } else {
          oneTimeType = true;
        }
        if (!(__indexOf.call(TIMES, key) >= 0 && this._type(val) === 'object')) {
          return false;
        }
        for (key2 in val) {
          val2 = val[key2];
          if (!(__indexOf.call(MEASURES, key2) >= 0 && this._type(val2) === 'number')) {
            return false;
          }
        }
      }
      return true;
    };

    Lockstep.prototype._isValidCount = function(count) {
      var key, val;
      for (key in count) {
        val = count[key];
        if (!(__indexOf.call(COUNTS, key) >= 0 && this._isInt(val))) {
          return false;
        }
      }
      return true;
    };

    Lockstep.prototype._isValidInfo = function(info) {
      var key, val;
      for (key in info) {
        val = info[key];
        if (__indexOf.call(TIMES, key) >= 0) {
          if (!this._isValidTime(val)) {
            return false;
          }
        } else if (key === 'count') {
          if (!this._isValidCount(val)) {
            return false;
          }
        } else {
          return false;
        }
      }
      return true;
    };

    Lockstep.prototype._validateArguments = function(argArray) {
      var argInfo, errorMessageBad, errorMessageMissing, validator, value, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = argArray.length; _i < _len; _i++) {
        argInfo = argArray[_i];
        value = argInfo[0];
        validator = argInfo[1];
        errorMessageBad = argInfo[2];
        errorMessageMissing = argInfo[3];
        if (value != null) {
          if (this._type(validator) === 'function') {
            if (!validator(value)) {
              throw new Error(errorMessageBad);
            } else {
              _results.push(void 0);
            }
          } else if (this._type(validator) === 'string') {
            switch (validator) {
              case 'time':
                if (!this._isValidTime(value)) {
                  throw new Error(errorMessageBad);
                } else {
                  _results.push(void 0);
                }
                break;
              case 'info':
                if (!this._isValidInfo(value)) {
                  throw new Error(errorMessageBad);
                } else {
                  _results.push(void 0);
                }
                break;
              case 'count':
                if (!this._isValidCount(value)) {
                  throw new Error(errorMessageBad);
                } else {
                  _results.push(void 0);
                }
                break;
              default:
                if (this._type(value) !== validator) {
                  throw new Error(errorMessageBad);
                } else {
                  _results.push(void 0);
                }
            }
          } else {
            _results.push(void 0);
          }
        } else if (errorMessageMissing != null) {
          throw new Error(errorMessageMissing);
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    Lockstep.prototype._validateOptions = function(args) {
      var options;
      if (args.length === 0) {
        throw new Error('No arguments supplied.');
      } else if (args.length === 1) {
        if (this._type(args[0]) === 'function') {
          options = {
            step: args[0]
          };
        } else if (this._type(args[0]) === 'object') {
          if (this._type(args[0].step) === 'function') {
            options = args[0];
          } else {
            throw new Error('Bad arguments supplied (no valid "step" function).');
          }
        } else {
          throw new Error('Bad arguments supplied (wrong type).');
        }
      } else if (args.length >= 2) {
        if (this._type(args[0]) === 'object' && this._type(args[1]) === 'function') {
          if (args[0].step != null) {
            throw new Error('Bad arguments supplied (redundant "step" function).');
          } else {
            args[0].step = args[1];
            options = args[0];
          }
        } else {
          throw new Error('Bad arguments supplied (wrong type).');
        }
      }
      if (options.pad != null) {
        if (!(options.pad === false || this._isInt(options.pad))) {
          throw new Error('Bad arguments supplied ("pad" option must have a false or integer value).');
        }
      }
      return options;
    };

    Lockstep.prototype._buildSettings = function(options) {
      var defaults;
      defaults = {
        pad: false,
        floor: false
      };
      return this._merge(defaults, options);
    };

    Lockstep.prototype._runTimeToClockTime = function(runTime) {
      var clockTime, milliseconds;
      clockTime = {};
      if (this.microseconds) {
        clockTime.microseconds = Math.floor((runTime % 1) / MSQTY.microseconds);
        milliseconds = Math.floor(runTime);
      } else {
        milliseconds = runTime;
      }
      clockTime.milliseconds = milliseconds % 1000;
      clockTime.seconds = Math.floor(milliseconds / MSQTY.seconds) % 60;
      clockTime.minutes = Math.floor(milliseconds / MSQTY.minutes) % 60;
      clockTime.hours = Math.floor(milliseconds / MSQTY.hours) % 24;
      clockTime.days = Math.floor(milliseconds / MSQTY.days);
      return clockTime;
    };

    Lockstep.prototype._runTimeToElapsedTime = function(runTime) {
      var elapsedTime, milliseconds;
      elapsedTime = {};
      if (this.microseconds) {
        elapsedTime.microseconds = runTime / MSQTY.microseconds;
        milliseconds = runTime;
      } else {
        milliseconds = runTime;
      }
      elapsedTime.milliseconds = milliseconds;
      elapsedTime.seconds = milliseconds / MSQTY.seconds;
      elapsedTime.minutes = milliseconds / MSQTY.minutes;
      elapsedTime.hours = milliseconds / MSQTY.hours;
      elapsedTime.days = milliseconds / MSQTY.days;
      return elapsedTime;
    };

    Lockstep.prototype._elapsedTimeToRunTime = function(elapsedTime) {
      var key, propQty, runTime, val;
      propQty = 0;
      runTime = 0;
      for (key in elapsedTime) {
        val = elapsedTime[key];
        if (++propQty > 1) {
          throw new Error('Bad arguments supplied (too many properties).');
        }
        if (__indexOf.call(MEASURES, key) >= 0) {
          runTime = MSQTY[key] * val;
        } else {
          throw new Error('Bad arguments supplied (wrong property).');
        }
      }
      return runTime;
    };

    Lockstep.prototype._clockTimeToRunTime = function(clockTime) {
      var key, runTime, val;
      runTime = 0;
      for (key in clockTime) {
        val = clockTime[key];
        if (__indexOf.call(MEASURES, key) >= 0) {
          runTime += MSQTY[key] * val;
        } else {
          throw new Error('Bad arguments supplied (wrong property).');
        }
      }
      return runTime;
    };

    Lockstep.prototype._getInfo = function() {
      var clock, elapsed, key, runTime, val;
      runTime = this.running ? this.time.run + now() - this.time.start : this.time.run;
      elapsed = this._runTimeToElapsedTime(runTime);
      clock = this._runTimeToClockTime(runTime);
      if (this.settings.floor) {
        for (key in elapsed) {
          val = elapsed[key];
          elapsed = Math.floor(val);
        }
      }
      if (this.settings.pad) {
        for (key in clock) {
          val = clock[key];
          val = this._pad(val, this.settings.pad);
        }
      }
      return {
        time: {
          elapsed: elapsed,
          clock: clock
        },
        count: this.count
      };
    };

    Lockstep.prototype._adjustRunTime = function(operation, runTime) {
      switch (operation) {
        case 'set':
          this.time.run = runTime;
          break;
        case 'add':
          this.time.run += runTime;
          break;
        case 'subtract':
          this.time.run -= runTime;
          break;
        default:
          throw new Error('Bad arguments supplied (invalid operation).');
      }
      if (!this.settings.allowNegative) {
        return this.time.run = Math.max(this.time.run, 0);
      }
    };

    Lockstep.prototype._adjustCount = function(operation, count) {
      var key, val;
      for (key in count) {
        val = count[key];
        if (key === 'start' || key === 'stop' || key === 'reset') {
          if (this._isInt(val)) {
            switch (operation) {
              case 'set':
                this.count[key] = val;
                break;
              case 'add':
                this.count[key] += val;
                break;
              case 'subtract':
                this.count[key] -= val;
                break;
              default:
                throw new Error('Bad arguments supplied (invalid operation).');
            }
            if (!this.settings.allowNegative) {
              this.count[key] = Math.max(this.count[key], 0);
            }
          } else {
            throw new Error('Bad arguments supplied (count value is not an integer).');
          }
        } else {
          throw new Error('Bad arguments supplied (wrong property).');
        }
      }
    };

    Lockstep.prototype._adjustInfo = function(operation, info) {
      if (info.elapsed != null) {
        this._adjustRunTime(operation, this._elapsedTimeToRunTime(info.elapsed));
      }
      if (info.clock != null) {
        this._adjustRunTime(operation, this._clockTimeToRunTime(info.clock));
      }
      if (info.count != null) {
        return this._adjustCount(operation, info.count);
      }
    };

    Lockstep.prototype._loop = function() {
      this.pulse = raf(this._loop);
      return this._step();
    };

    Lockstep.prototype._step = function() {
      return this.settings.step(this._getInfo());
    };

    Lockstep.prototype.start = function(callback) {
      if (callback == null) {
        callback = this.settings.start;
      }
      this._validateArguments([[callback, 'function', 'Callback supplied is not a function.']]);
      if (!this.running) {
        this.count.start++;
        this.running = true;
        this.time.start = now();
        this._loop();
        if (typeof callback === "function") {
          callback(this._getInfo());
        }
      }
      return this;
    };

    Lockstep.prototype.stop = function(callback) {
      if (callback == null) {
        callback = this.settings.stop;
      }
      this._validateArguments([[callback, 'function', 'Callback supplied is not a function.']]);
      if (this.running) {
        raf.cancel(this.pulse);
        this.time.stop = now();
        this.time.run += this.time.stop - this.time.start;
        this.count.stop++;
        this.running = false;
        this._step();
        if (typeof callback === "function") {
          callback(this._getInfo());
        }
      }
      return this;
    };

    Lockstep.prototype.reset = function(callback, count) {
      var callbackEligible, key, val, _ref;
      if (callback == null) {
        callback = this.settings.reset;
      }
      this._validateArguments([[callback, 'function', 'Callback supplied is not a function.']]);
      if (this.time.run > 0) {
        callbackEligible = true;
        this.time.run = 0;
        this.count.reset++;
        this.time.start = now();
        this.time.stop = null;
      }
      if (count) {
        _ref = this.count;
        for (key in _ref) {
          val = _ref[key];
          if (val > 0) {
            callbackEligible = true;
            this.count.start = 0;
            this.count.stop = 0;
            this.count.reset = 0;
            break;
          }
        }
      }
      callbackEligible && (typeof callback === "function" ? callback(this._getInfo()) : void 0);
      return this;
    };

    Lockstep.prototype.info = function(info, callback) {
      if (callback == null) {
        callback = this.settings.info;
      }
      if (info != null) {
        this._validateArguments([[info, 'info', 'Info supplied is not valid.', 'No arguments supplied.'], [callback, 'function', 'Callback supplied is not a function.']]);
        this._adjustInfo('set', info);
        if (typeof callback === "function") {
          callback(this._getInfo());
        }
        return this;
      } else {
        return this._getInfo();
      }
    };

    Lockstep.prototype.add = function(info, callback) {
      if (callback == null) {
        callback = this.settings.add;
      }
      this._validateArguments([[info, 'info', 'Info supplied is not valid.', 'No arguments supplied.'], [callback, 'function', 'Callback supplied is not a function.']]);
      this._adjustInfo('add', info);
      if (typeof callback === "function") {
        callback(this._getInfo());
      }
      return this;
    };

    Lockstep.prototype.subtract = function(info, callback) {
      if (callback == null) {
        callback = this.settings.subtract;
      }
      this._validateArguments([[info, 'info', 'Info supplied is not valid.', 'No arguments supplied.'], [callback, 'function', 'Callback supplied is not a function.']]);
      this._adjustInfo('subtract', info);
      if (typeof callback === "function") {
        callback(this._getInfo());
      }
      return this;
    };

    Lockstep.prototype.when = function(time, callback) {
      if (callback == null) {
        callback = this.settings.when;
      }
      this._validateArguments([[time, 'time', 'Time supplied is not valid.', 'No arguments supplied.'], [callback, 'function', 'Callback supplied is not a function.', 'No callback supplied.']]);
      return this;
    };

    Lockstep.prototype.every = function(time, callback) {
      if (callback == null) {
        callback = this.settings.every;
      }
      this._validateArguments([[time, 'time', 'Time supplied is not valid.', 'No arguments supplied.'], [callback, 'function', 'Callback supplied is not a function.', 'No callback supplied.']]);
      return this;
    };

    Lockstep.prototype["while"] = function(startTime, endTime, callback) {
      if (callback == null) {
        callback = this.settings["while"];
      }
      this._validateArguments([[startTime, 'time', 'Start time supplied is not valid.', 'No arguments supplied.'], [endTime, 'time', 'End time supplied is not valid.', 'No end time supplied.'], [callback, 'function', 'Callback supplied is not a function.', 'No callback supplied.']]);
      return this;
    };

    Lockstep.prototype.during = function(startTime, endTime, startCallback, endCallback) {
      if (startCallback == null) {
        startCallback = this.settings.duringStart;
      }
      if (endCallback == null) {
        endCallback = this.settings.duringEnd;
      }
      this._validateArguments([[startTime, 'time', 'Start time supplied is not valid.', 'No arguments supplied.'], [endTime, 'time', 'End time supplied is not valid.', 'No end time supplied.'], [startCallback, 'function', 'Start callback is not a function.', 'No start callback supplied.'], [endCallback, 'function', 'End callback is not a function', 'No end callback supplied.']]);
      return this;
    };

    Lockstep.prototype.beginning = function(startTime, startCallback) {
      if (startCallback == null) {
        startCallback = this.settings.beginning;
      }
      this._validateArguments([[startTime, 'time', 'Start time supplied is not valid.', 'No arguments supplied.'], [startCallback, 'function', 'Start callback is not a function.', 'No start callback supplied.']]);
      this.during(startTime, Infinity, startCallback, NOOP);
      return this;
    };

    Lockstep.prototype.ending = function(endTime, endCallback) {
      if (endCallback == null) {
        endCallback = this.settings.ending;
      }
      this._validateArguments([[endTime, 'time', 'Time supplied is not valid.', 'No arguments supplied.'], [endCallback, 'function', 'End callback is not a function.', 'No end callback supplied.']]);
      return this;
    };

    return Lockstep;

  })();

  module.exports = Lockstep;

}).call(this);

}).call(this,_dereq_("1YiZ5S"))
},{"1YiZ5S":1,"performance-now":2,"raf":3}]},{},[5])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyIsIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL25vZGVfbW9kdWxlcy9wZXJmb3JtYW5jZS1ub3cvbGliL3BlcmZvcm1hbmNlLW5vdy5qcyIsIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL25vZGVfbW9kdWxlcy9yYWYvaW5kZXguanMiLCIvVXNlcnMvdHdhcnIvY29kZS9sb2Nrc3RlcC9ub2RlX21vZHVsZXMvcmFmL25vZGVfbW9kdWxlcy9wZXJmb3JtYW5jZS1ub3cvbGliL3BlcmZvcm1hbmNlLW5vdy5qcyIsIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL3NyYy9mYWtlXzQ1MTRiY2IwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKX12YXIgZj1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwoZi5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxmLGYuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gc2hpbSBmb3IgdXNpbmcgcHJvY2VzcyBpbiBicm93c2VyXG5cbnZhciBwcm9jZXNzID0gbW9kdWxlLmV4cG9ydHMgPSB7fTtcblxucHJvY2Vzcy5uZXh0VGljayA9IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGNhblNldEltbWVkaWF0ZSA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnXG4gICAgJiYgd2luZG93LnNldEltbWVkaWF0ZTtcbiAgICB2YXIgY2FuUG9zdCA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnXG4gICAgJiYgd2luZG93LnBvc3RNZXNzYWdlICYmIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyXG4gICAgO1xuXG4gICAgaWYgKGNhblNldEltbWVkaWF0ZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGYpIHsgcmV0dXJuIHdpbmRvdy5zZXRJbW1lZGlhdGUoZikgfTtcbiAgICB9XG5cbiAgICBpZiAoY2FuUG9zdCkge1xuICAgICAgICB2YXIgcXVldWUgPSBbXTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgICAgIHZhciBzb3VyY2UgPSBldi5zb3VyY2U7XG4gICAgICAgICAgICBpZiAoKHNvdXJjZSA9PT0gd2luZG93IHx8IHNvdXJjZSA9PT0gbnVsbCkgJiYgZXYuZGF0YSA9PT0gJ3Byb2Nlc3MtdGljaycpIHtcbiAgICAgICAgICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICBpZiAocXVldWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZm4gPSBxdWV1ZS5zaGlmdCgpO1xuICAgICAgICAgICAgICAgICAgICBmbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIG5leHRUaWNrKGZuKSB7XG4gICAgICAgICAgICBxdWV1ZS5wdXNoKGZuKTtcbiAgICAgICAgICAgIHdpbmRvdy5wb3N0TWVzc2FnZSgncHJvY2Vzcy10aWNrJywgJyonKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gbmV4dFRpY2soZm4pIHtcbiAgICAgICAgc2V0VGltZW91dChmbiwgMCk7XG4gICAgfTtcbn0pKCk7XG5cbnByb2Nlc3MudGl0bGUgPSAnYnJvd3Nlcic7XG5wcm9jZXNzLmJyb3dzZXIgPSB0cnVlO1xucHJvY2Vzcy5lbnYgPSB7fTtcbnByb2Nlc3MuYXJndiA9IFtdO1xuXG5mdW5jdGlvbiBub29wKCkge31cblxucHJvY2Vzcy5vbiA9IG5vb3A7XG5wcm9jZXNzLmFkZExpc3RlbmVyID0gbm9vcDtcbnByb2Nlc3Mub25jZSA9IG5vb3A7XG5wcm9jZXNzLm9mZiA9IG5vb3A7XG5wcm9jZXNzLnJlbW92ZUxpc3RlbmVyID0gbm9vcDtcbnByb2Nlc3MucmVtb3ZlQWxsTGlzdGVuZXJzID0gbm9vcDtcbnByb2Nlc3MuZW1pdCA9IG5vb3A7XG5cbnByb2Nlc3MuYmluZGluZyA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCcpO1xufVxuXG4vLyBUT0RPKHNodHlsbWFuKVxucHJvY2Vzcy5jd2QgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAnLycgfTtcbnByb2Nlc3MuY2hkaXIgPSBmdW5jdGlvbiAoZGlyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn07XG4iLCIoZnVuY3Rpb24gKHByb2Nlc3Mpe1xuLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2V0TmFub1NlY29uZHMsIGhydGltZSwgbG9hZFRpbWU7XG5cbiAgaWYgKCh0eXBlb2YgcGVyZm9ybWFuY2UgIT09IFwidW5kZWZpbmVkXCIgJiYgcGVyZm9ybWFuY2UgIT09IG51bGwpICYmIHBlcmZvcm1hbmNlLm5vdykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgfTtcbiAgfSBlbHNlIGlmICgodHlwZW9mIHByb2Nlc3MgIT09IFwidW5kZWZpbmVkXCIgJiYgcHJvY2VzcyAhPT0gbnVsbCkgJiYgcHJvY2Vzcy5ocnRpbWUpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIChnZXROYW5vU2Vjb25kcygpIC0gbG9hZFRpbWUpIC8gMWU2O1xuICAgIH07XG4gICAgaHJ0aW1lID0gcHJvY2Vzcy5ocnRpbWU7XG4gICAgZ2V0TmFub1NlY29uZHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBocjtcbiAgICAgIGhyID0gaHJ0aW1lKCk7XG4gICAgICByZXR1cm4gaHJbMF0gKiAxZTkgKyBoclsxXTtcbiAgICB9O1xuICAgIGxvYWRUaW1lID0gZ2V0TmFub1NlY29uZHMoKTtcbiAgfSBlbHNlIGlmIChEYXRlLm5vdykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gRGF0ZS5ub3coKSAtIGxvYWRUaW1lO1xuICAgIH07XG4gICAgbG9hZFRpbWUgPSBEYXRlLm5vdygpO1xuICB9IGVsc2Uge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBsb2FkVGltZTtcbiAgICB9O1xuICAgIGxvYWRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gIH1cblxufSkuY2FsbCh0aGlzKTtcblxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCIxWWlaNVNcIikpIiwidmFyIG5vdyA9IHJlcXVpcmUoJ3BlcmZvcm1hbmNlLW5vdycpXG4gICwgZ2xvYmFsID0gdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcgPyB7fSA6IHdpbmRvd1xuICAsIHZlbmRvcnMgPSBbJ21veicsICd3ZWJraXQnXVxuICAsIHN1ZmZpeCA9ICdBbmltYXRpb25GcmFtZSdcbiAgLCByYWYgPSBnbG9iYWxbJ3JlcXVlc3QnICsgc3VmZml4XVxuICAsIGNhZiA9IGdsb2JhbFsnY2FuY2VsJyArIHN1ZmZpeF0gfHwgZ2xvYmFsWydjYW5jZWxSZXF1ZXN0JyArIHN1ZmZpeF1cbiAgLCBpc05hdGl2ZSA9IHRydWVcblxuZm9yKHZhciBpID0gMDsgaSA8IHZlbmRvcnMubGVuZ3RoICYmICFyYWY7IGkrKykge1xuICByYWYgPSBnbG9iYWxbdmVuZG9yc1tpXSArICdSZXF1ZXN0JyArIHN1ZmZpeF1cbiAgY2FmID0gZ2xvYmFsW3ZlbmRvcnNbaV0gKyAnQ2FuY2VsJyArIHN1ZmZpeF1cbiAgICAgIHx8IGdsb2JhbFt2ZW5kb3JzW2ldICsgJ0NhbmNlbFJlcXVlc3QnICsgc3VmZml4XVxufVxuXG4vLyBTb21lIHZlcnNpb25zIG9mIEZGIGhhdmUgckFGIGJ1dCBub3QgY0FGXG5pZighcmFmIHx8ICFjYWYpIHtcbiAgaXNOYXRpdmUgPSBmYWxzZVxuXG4gIHZhciBsYXN0ID0gMFxuICAgICwgaWQgPSAwXG4gICAgLCBxdWV1ZSA9IFtdXG4gICAgLCBmcmFtZUR1cmF0aW9uID0gMTAwMCAvIDYwXG5cbiAgcmFmID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICBpZihxdWV1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgIHZhciBfbm93ID0gbm93KClcbiAgICAgICAgLCBuZXh0ID0gTWF0aC5tYXgoMCwgZnJhbWVEdXJhdGlvbiAtIChfbm93IC0gbGFzdCkpXG4gICAgICBsYXN0ID0gbmV4dCArIF9ub3dcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBjcCA9IHF1ZXVlLnNsaWNlKDApXG4gICAgICAgIC8vIENsZWFyIHF1ZXVlIGhlcmUgdG8gcHJldmVudFxuICAgICAgICAvLyBjYWxsYmFja3MgZnJvbSBhcHBlbmRpbmcgbGlzdGVuZXJzXG4gICAgICAgIC8vIHRvIHRoZSBjdXJyZW50IGZyYW1lJ3MgcXVldWVcbiAgICAgICAgcXVldWUubGVuZ3RoID0gMFxuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgY3AubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZighY3BbaV0uY2FuY2VsbGVkKSB7XG4gICAgICAgICAgICB0cnl7XG4gICAgICAgICAgICAgIGNwW2ldLmNhbGxiYWNrKGxhc3QpXG4gICAgICAgICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsgdGhyb3cgZSB9LCAwKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwgTWF0aC5yb3VuZChuZXh0KSlcbiAgICB9XG4gICAgcXVldWUucHVzaCh7XG4gICAgICBoYW5kbGU6ICsraWQsXG4gICAgICBjYWxsYmFjazogY2FsbGJhY2ssXG4gICAgICBjYW5jZWxsZWQ6IGZhbHNlXG4gICAgfSlcbiAgICByZXR1cm4gaWRcbiAgfVxuXG4gIGNhZiA9IGZ1bmN0aW9uKGhhbmRsZSkge1xuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBxdWV1ZS5sZW5ndGg7IGkrKykge1xuICAgICAgaWYocXVldWVbaV0uaGFuZGxlID09PSBoYW5kbGUpIHtcbiAgICAgICAgcXVldWVbaV0uY2FuY2VsbGVkID0gdHJ1ZVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGZuKSB7XG4gIC8vIFdyYXAgaW4gYSBuZXcgZnVuY3Rpb24gdG8gcHJldmVudFxuICAvLyBgY2FuY2VsYCBwb3RlbnRpYWxseSBiZWluZyBhc3NpZ25lZFxuICAvLyB0byB0aGUgbmF0aXZlIHJBRiBmdW5jdGlvblxuICBpZighaXNOYXRpdmUpIHtcbiAgICByZXR1cm4gcmFmLmNhbGwoZ2xvYmFsLCBmbilcbiAgfVxuICByZXR1cm4gcmFmLmNhbGwoZ2xvYmFsLCBmdW5jdGlvbigpIHtcbiAgICB0cnl7XG4gICAgICBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG4gICAgfSBjYXRjaChlKSB7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyB0aHJvdyBlIH0sIDApXG4gICAgfVxuICB9KVxufVxubW9kdWxlLmV4cG9ydHMuY2FuY2VsID0gZnVuY3Rpb24oKSB7XG4gIGNhZi5hcHBseShnbG9iYWwsIGFyZ3VtZW50cylcbn1cbiIsIihmdW5jdGlvbiAocHJvY2Vzcyl7XG4vLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnZXROYW5vU2Vjb25kcywgaHJ0aW1lLCBsb2FkVGltZTtcblxuICBpZiAoKHR5cGVvZiBwZXJmb3JtYW5jZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBwZXJmb3JtYW5jZSAhPT0gbnVsbCkgJiYgcGVyZm9ybWFuY2Uubm93KSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICB9O1xuICB9IGVsc2UgaWYgKCh0eXBlb2YgcHJvY2VzcyAhPT0gXCJ1bmRlZmluZWRcIiAmJiBwcm9jZXNzICE9PSBudWxsKSAmJiBwcm9jZXNzLmhydGltZSkge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gKGdldE5hbm9TZWNvbmRzKCkgLSBsb2FkVGltZSkgLyAxZTY7XG4gICAgfTtcbiAgICBocnRpbWUgPSBwcm9jZXNzLmhydGltZTtcbiAgICBnZXROYW5vU2Vjb25kcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGhyO1xuICAgICAgaHIgPSBocnRpbWUoKTtcbiAgICAgIHJldHVybiBoclswXSAqIDFlOSArIGhyWzFdO1xuICAgIH07XG4gICAgbG9hZFRpbWUgPSBnZXROYW5vU2Vjb25kcygpO1xuICB9IGVsc2UgaWYgKERhdGUubm93KSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBEYXRlLm5vdygpIC0gbG9hZFRpbWU7XG4gICAgfTtcbiAgICBsb2FkVGltZSA9IERhdGUubm93KCk7XG4gIH0gZWxzZSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIGxvYWRUaW1lO1xuICAgIH07XG4gICAgbG9hZFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgfVxuXG59KS5jYWxsKHRoaXMpO1xuXG4vKlxuLy9AIHNvdXJjZU1hcHBpbmdVUkw9cGVyZm9ybWFuY2Utbm93Lm1hcFxuKi9cblxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCIxWWlaNVNcIikpIiwiKGZ1bmN0aW9uIChwcm9jZXNzKXtcbihmdW5jdGlvbigpIHtcbiAgdmFyIENPVU5UUywgSU5GTywgTG9ja3N0ZXAsIE1FQVNVUkVTLCBNU1FUWSwgTk9PUCwgVElNRVMsIG5vdywgcmFmLFxuICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gICAgX19pbmRleE9mID0gW10uaW5kZXhPZiB8fCBmdW5jdGlvbihpdGVtKSB7IGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsgaWYgKGkgaW4gdGhpcyAmJiB0aGlzW2ldID09PSBpdGVtKSByZXR1cm4gaTsgfSByZXR1cm4gLTE7IH07XG5cbiAgcmFmID0gcmVxdWlyZSgncmFmJyk7XG5cbiAgbm93ID0gcmVxdWlyZSgncGVyZm9ybWFuY2Utbm93Jyk7XG5cbiAgTVNRVFkgPSB7fTtcblxuICBNU1FUWS5taWNyb3NlY29uZHMgPSAwLjAwMTtcblxuICBNU1FUWS5taWxsaXNlY29uZHMgPSBNU1FUWS5taWNyb3NlY29uZHMgKiAxMDAwO1xuXG4gIE1TUVRZLnNlY29uZHMgPSBNU1FUWS5taWxsaXNlY29uZHMgKiAxMDAwO1xuXG4gIE1TUVRZLm1pbnV0ZXMgPSBNU1FUWS5zZWNvbmRzICogNjA7XG5cbiAgTVNRVFkuaG91cnMgPSBNU1FUWS5taW51dGVzICogNjA7XG5cbiAgTVNRVFkuZGF5cyA9IE1TUVRZLmhvdXJzICogMjQ7XG5cbiAgTk9PUCA9IGZ1bmN0aW9uKCkge307XG5cbiAgTUVBU1VSRVMgPSBbJ21pY3Jvc2Vjb25kcycsICdtaWxsaXNlY29uZHMnLCAnc2Vjb25kcycsICdtaW51dGVzJywgJ2hvdXJzJywgJ2RheXMnXTtcblxuICBUSU1FUyA9IFsnZWxhcHNlZCcsICdjbG9jayddO1xuXG4gIENPVU5UUyA9IFsnc3RhcnQnLCAnc3RvcCcsICdyZXNldCddO1xuXG4gIElORk8gPSBbJ2VsYXBzZWQnLCAnY2xvY2snLCAnY291bnQnXTtcblxuICBMb2Nrc3RlcCA9IChmdW5jdGlvbigpIHtcbiAgICBmdW5jdGlvbiBMb2Nrc3RlcCgpIHtcbiAgICAgIHRoaXMuX2xvb3AgPSBfX2JpbmQodGhpcy5fbG9vcCwgdGhpcyk7XG4gICAgICB2YXIgb3B0aW9ucztcbiAgICAgIG9wdGlvbnMgPSB0aGlzLl92YWxpZGF0ZU9wdGlvbnMoYXJndW1lbnRzKTtcbiAgICAgIHRoaXMuc2V0dGluZ3MgPSB0aGlzLl9idWlsZFNldHRpbmdzKG9wdGlvbnMpO1xuICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XG4gICAgICB0aGlzLm1pY3Jvc2Vjb25kcyA9IHRoaXMuX2hhc0hpZ2hSZXNvbHV0aW9uVGltZSgpO1xuICAgICAgdGhpcy5jb3VudCA9IHtcbiAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgIHN0b3A6IDAsXG4gICAgICAgIHJlc2V0OiAwXG4gICAgICB9O1xuICAgICAgdGhpcy50aW1lID0ge1xuICAgICAgICBzdGFydDogbnVsbCxcbiAgICAgICAgc3RvcDogbnVsbCxcbiAgICAgICAgcnVuOiAwXG4gICAgICB9O1xuICAgIH1cblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5fdHlwZSA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICByZXR1cm4ge30udG9TdHJpbmcuY2FsbCh2YWx1ZSkubWF0Y2goL1xccyhbYS16QS1aXSspLylbMV0udG9Mb3dlckNhc2UoKTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9pc0ludCA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICByZXR1cm4gIWlzTmFOKHZhbHVlKSAmJiBwYXJzZUludChOdW1iZXIodmFsdWUpKSA9PT0gdmFsdWUgJiYgIWlzTmFOKHBhcnNlSW50KHZhbHVlLCAxMCkpO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX21lcmdlID0gZnVuY3Rpb24ob2JqMSwgb2JqMikge1xuICAgICAgdmFyIG5hbWUsIG9iajM7XG4gICAgICBvYmozID0ge307XG4gICAgICBmb3IgKG5hbWUgaW4gb2JqMSkge1xuICAgICAgICBvYmozW25hbWVdID0gb2JqMVtuYW1lXTtcbiAgICAgIH1cbiAgICAgIGZvciAobmFtZSBpbiBvYmoyKSB7XG4gICAgICAgIG9iajNbbmFtZV0gPSBvYmoyW25hbWVdO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG9iajM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5fcGFkID0gZnVuY3Rpb24oaW50LCBsZW5ndGgpIHtcbiAgICAgIGludCArPSAnJztcbiAgICAgIGlmIChpbnQubGVuZ3RoID49IGxlbmd0aCkge1xuICAgICAgICByZXR1cm4gaW50O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiXCIgKyAobmV3IEFycmF5KGxlbmd0aCAtIGludC5sZW5ndGggKyAxKS5qb2luKCcwJykpICsgaW50O1xuICAgICAgfVxuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX2hhc0hpZ2hSZXNvbHV0aW9uVGltZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIF9yZWY7XG4gICAgICByZXR1cm4gKCh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiICYmIHdpbmRvdyAhPT0gbnVsbCA/IChfcmVmID0gd2luZG93LnBlcmZvcm1hbmNlKSAhPSBudWxsID8gX3JlZi5ub3cgOiB2b2lkIDAgOiB2b2lkIDApICE9IG51bGwpIHx8ICgodHlwZW9mIHByb2Nlc3MgIT09IFwidW5kZWZpbmVkXCIgJiYgcHJvY2VzcyAhPT0gbnVsbCA/IHByb2Nlc3MuaHJ0aW1lIDogdm9pZCAwKSAhPSBudWxsKTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9pc1ZhbGlkVGltZSA9IGZ1bmN0aW9uKHRpbWUpIHtcbiAgICAgIHZhciBrZXksIGtleTIsIG9uZVRpbWVUeXBlLCB2YWwsIHZhbDI7XG4gICAgICBvbmVUaW1lVHlwZSA9IGZhbHNlO1xuICAgICAgaWYgKCF0aGlzLl90eXBlKHRpbWUpID09PSAnb2JqZWN0Jykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBmb3IgKGtleSBpbiB0aW1lKSB7XG4gICAgICAgIHZhbCA9IHRpbWVba2V5XTtcbiAgICAgICAgaWYgKG9uZVRpbWVUeXBlKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9uZVRpbWVUeXBlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIShfX2luZGV4T2YuY2FsbChUSU1FUywga2V5KSA+PSAwICYmIHRoaXMuX3R5cGUodmFsKSA9PT0gJ29iamVjdCcpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoa2V5MiBpbiB2YWwpIHtcbiAgICAgICAgICB2YWwyID0gdmFsW2tleTJdO1xuICAgICAgICAgIGlmICghKF9faW5kZXhPZi5jYWxsKE1FQVNVUkVTLCBrZXkyKSA+PSAwICYmIHRoaXMuX3R5cGUodmFsMikgPT09ICdudW1iZXInKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5faXNWYWxpZENvdW50ID0gZnVuY3Rpb24oY291bnQpIHtcbiAgICAgIHZhciBrZXksIHZhbDtcbiAgICAgIGZvciAoa2V5IGluIGNvdW50KSB7XG4gICAgICAgIHZhbCA9IGNvdW50W2tleV07XG4gICAgICAgIGlmICghKF9faW5kZXhPZi5jYWxsKENPVU5UUywga2V5KSA+PSAwICYmIHRoaXMuX2lzSW50KHZhbCkpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9pc1ZhbGlkSW5mbyA9IGZ1bmN0aW9uKGluZm8pIHtcbiAgICAgIHZhciBrZXksIHZhbDtcbiAgICAgIGZvciAoa2V5IGluIGluZm8pIHtcbiAgICAgICAgdmFsID0gaW5mb1trZXldO1xuICAgICAgICBpZiAoX19pbmRleE9mLmNhbGwoVElNRVMsIGtleSkgPj0gMCkge1xuICAgICAgICAgIGlmICghdGhpcy5faXNWYWxpZFRpbWUodmFsKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdjb3VudCcpIHtcbiAgICAgICAgICBpZiAoIXRoaXMuX2lzVmFsaWRDb3VudCh2YWwpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5fdmFsaWRhdGVBcmd1bWVudHMgPSBmdW5jdGlvbihhcmdBcnJheSkge1xuICAgICAgdmFyIGFyZ0luZm8sIGVycm9yTWVzc2FnZUJhZCwgZXJyb3JNZXNzYWdlTWlzc2luZywgdmFsaWRhdG9yLCB2YWx1ZSwgX2ksIF9sZW4sIF9yZXN1bHRzO1xuICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gYXJnQXJyYXkubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgYXJnSW5mbyA9IGFyZ0FycmF5W19pXTtcbiAgICAgICAgdmFsdWUgPSBhcmdJbmZvWzBdO1xuICAgICAgICB2YWxpZGF0b3IgPSBhcmdJbmZvWzFdO1xuICAgICAgICBlcnJvck1lc3NhZ2VCYWQgPSBhcmdJbmZvWzJdO1xuICAgICAgICBlcnJvck1lc3NhZ2VNaXNzaW5nID0gYXJnSW5mb1szXTtcbiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgICBpZiAodGhpcy5fdHlwZSh2YWxpZGF0b3IpID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBpZiAoIXZhbGlkYXRvcih2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZUJhZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBfcmVzdWx0cy5wdXNoKHZvaWQgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl90eXBlKHZhbGlkYXRvcikgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHZhbGlkYXRvcikge1xuICAgICAgICAgICAgICBjYXNlICd0aW1lJzpcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzVmFsaWRUaW1lKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZUJhZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIF9yZXN1bHRzLnB1c2godm9pZCAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ2luZm8nOlxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNWYWxpZEluZm8odmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNZXNzYWdlQmFkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgX3Jlc3VsdHMucHVzaCh2b2lkIDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnY291bnQnOlxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5faXNWYWxpZENvdW50KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZUJhZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIF9yZXN1bHRzLnB1c2godm9pZCAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3R5cGUodmFsdWUpICE9PSB2YWxpZGF0b3IpIHtcbiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2VCYWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBfcmVzdWx0cy5wdXNoKHZvaWQgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfcmVzdWx0cy5wdXNoKHZvaWQgMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGVycm9yTWVzc2FnZU1pc3NpbmcgIT0gbnVsbCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2VNaXNzaW5nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfcmVzdWx0cy5wdXNoKHZvaWQgMCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl92YWxpZGF0ZU9wdGlvbnMgPSBmdW5jdGlvbihhcmdzKSB7XG4gICAgICB2YXIgb3B0aW9ucztcbiAgICAgIGlmIChhcmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIGFyZ3VtZW50cyBzdXBwbGllZC4nKTtcbiAgICAgIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgaWYgKHRoaXMuX3R5cGUoYXJnc1swXSkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBvcHRpb25zID0ge1xuICAgICAgICAgICAgc3RlcDogYXJnc1swXVxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fdHlwZShhcmdzWzBdKSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICBpZiAodGhpcy5fdHlwZShhcmdzWzBdLnN0ZXApID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBvcHRpb25zID0gYXJnc1swXTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgYXJndW1lbnRzIHN1cHBsaWVkIChubyB2YWxpZCBcInN0ZXBcIiBmdW5jdGlvbikuJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQmFkIGFyZ3VtZW50cyBzdXBwbGllZCAod3JvbmcgdHlwZSkuJyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPj0gMikge1xuICAgICAgICBpZiAodGhpcy5fdHlwZShhcmdzWzBdKSA9PT0gJ29iamVjdCcgJiYgdGhpcy5fdHlwZShhcmdzWzFdKSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGlmIChhcmdzWzBdLnN0ZXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgYXJndW1lbnRzIHN1cHBsaWVkIChyZWR1bmRhbnQgXCJzdGVwXCIgZnVuY3Rpb24pLicpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhcmdzWzBdLnN0ZXAgPSBhcmdzWzFdO1xuICAgICAgICAgICAgb3B0aW9ucyA9IGFyZ3NbMF07XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQmFkIGFyZ3VtZW50cyBzdXBwbGllZCAod3JvbmcgdHlwZSkuJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLnBhZCAhPSBudWxsKSB7XG4gICAgICAgIGlmICghKG9wdGlvbnMucGFkID09PSBmYWxzZSB8fCB0aGlzLl9pc0ludChvcHRpb25zLnBhZCkpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgYXJndW1lbnRzIHN1cHBsaWVkIChcInBhZFwiIG9wdGlvbiBtdXN0IGhhdmUgYSBmYWxzZSBvciBpbnRlZ2VyIHZhbHVlKS4nKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIG9wdGlvbnM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5fYnVpbGRTZXR0aW5ncyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIHZhciBkZWZhdWx0cztcbiAgICAgIGRlZmF1bHRzID0ge1xuICAgICAgICBwYWQ6IGZhbHNlLFxuICAgICAgICBmbG9vcjogZmFsc2VcbiAgICAgIH07XG4gICAgICByZXR1cm4gdGhpcy5fbWVyZ2UoZGVmYXVsdHMsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX3J1blRpbWVUb0Nsb2NrVGltZSA9IGZ1bmN0aW9uKHJ1blRpbWUpIHtcbiAgICAgIHZhciBjbG9ja1RpbWUsIG1pbGxpc2Vjb25kcztcbiAgICAgIGNsb2NrVGltZSA9IHt9O1xuICAgICAgaWYgKHRoaXMubWljcm9zZWNvbmRzKSB7XG4gICAgICAgIGNsb2NrVGltZS5taWNyb3NlY29uZHMgPSBNYXRoLmZsb29yKChydW5UaW1lICUgMSkgLyBNU1FUWS5taWNyb3NlY29uZHMpO1xuICAgICAgICBtaWxsaXNlY29uZHMgPSBNYXRoLmZsb29yKHJ1blRpbWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWlsbGlzZWNvbmRzID0gcnVuVGltZTtcbiAgICAgIH1cbiAgICAgIGNsb2NrVGltZS5taWxsaXNlY29uZHMgPSBtaWxsaXNlY29uZHMgJSAxMDAwO1xuICAgICAgY2xvY2tUaW1lLnNlY29uZHMgPSBNYXRoLmZsb29yKG1pbGxpc2Vjb25kcyAvIE1TUVRZLnNlY29uZHMpICUgNjA7XG4gICAgICBjbG9ja1RpbWUubWludXRlcyA9IE1hdGguZmxvb3IobWlsbGlzZWNvbmRzIC8gTVNRVFkubWludXRlcykgJSA2MDtcbiAgICAgIGNsb2NrVGltZS5ob3VycyA9IE1hdGguZmxvb3IobWlsbGlzZWNvbmRzIC8gTVNRVFkuaG91cnMpICUgMjQ7XG4gICAgICBjbG9ja1RpbWUuZGF5cyA9IE1hdGguZmxvb3IobWlsbGlzZWNvbmRzIC8gTVNRVFkuZGF5cyk7XG4gICAgICByZXR1cm4gY2xvY2tUaW1lO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX3J1blRpbWVUb0VsYXBzZWRUaW1lID0gZnVuY3Rpb24ocnVuVGltZSkge1xuICAgICAgdmFyIGVsYXBzZWRUaW1lLCBtaWxsaXNlY29uZHM7XG4gICAgICBlbGFwc2VkVGltZSA9IHt9O1xuICAgICAgaWYgKHRoaXMubWljcm9zZWNvbmRzKSB7XG4gICAgICAgIGVsYXBzZWRUaW1lLm1pY3Jvc2Vjb25kcyA9IHJ1blRpbWUgLyBNU1FUWS5taWNyb3NlY29uZHM7XG4gICAgICAgIG1pbGxpc2Vjb25kcyA9IHJ1blRpbWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtaWxsaXNlY29uZHMgPSBydW5UaW1lO1xuICAgICAgfVxuICAgICAgZWxhcHNlZFRpbWUubWlsbGlzZWNvbmRzID0gbWlsbGlzZWNvbmRzO1xuICAgICAgZWxhcHNlZFRpbWUuc2Vjb25kcyA9IG1pbGxpc2Vjb25kcyAvIE1TUVRZLnNlY29uZHM7XG4gICAgICBlbGFwc2VkVGltZS5taW51dGVzID0gbWlsbGlzZWNvbmRzIC8gTVNRVFkubWludXRlcztcbiAgICAgIGVsYXBzZWRUaW1lLmhvdXJzID0gbWlsbGlzZWNvbmRzIC8gTVNRVFkuaG91cnM7XG4gICAgICBlbGFwc2VkVGltZS5kYXlzID0gbWlsbGlzZWNvbmRzIC8gTVNRVFkuZGF5cztcbiAgICAgIHJldHVybiBlbGFwc2VkVGltZTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9lbGFwc2VkVGltZVRvUnVuVGltZSA9IGZ1bmN0aW9uKGVsYXBzZWRUaW1lKSB7XG4gICAgICB2YXIga2V5LCBwcm9wUXR5LCBydW5UaW1lLCB2YWw7XG4gICAgICBwcm9wUXR5ID0gMDtcbiAgICAgIHJ1blRpbWUgPSAwO1xuICAgICAgZm9yIChrZXkgaW4gZWxhcHNlZFRpbWUpIHtcbiAgICAgICAgdmFsID0gZWxhcHNlZFRpbWVba2V5XTtcbiAgICAgICAgaWYgKCsrcHJvcFF0eSA+IDEpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBhcmd1bWVudHMgc3VwcGxpZWQgKHRvbyBtYW55IHByb3BlcnRpZXMpLicpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfX2luZGV4T2YuY2FsbChNRUFTVVJFUywga2V5KSA+PSAwKSB7XG4gICAgICAgICAgcnVuVGltZSA9IE1TUVRZW2tleV0gKiB2YWw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdCYWQgYXJndW1lbnRzIHN1cHBsaWVkICh3cm9uZyBwcm9wZXJ0eSkuJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBydW5UaW1lO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX2Nsb2NrVGltZVRvUnVuVGltZSA9IGZ1bmN0aW9uKGNsb2NrVGltZSkge1xuICAgICAgdmFyIGtleSwgcnVuVGltZSwgdmFsO1xuICAgICAgcnVuVGltZSA9IDA7XG4gICAgICBmb3IgKGtleSBpbiBjbG9ja1RpbWUpIHtcbiAgICAgICAgdmFsID0gY2xvY2tUaW1lW2tleV07XG4gICAgICAgIGlmIChfX2luZGV4T2YuY2FsbChNRUFTVVJFUywga2V5KSA+PSAwKSB7XG4gICAgICAgICAgcnVuVGltZSArPSBNU1FUWVtrZXldICogdmFsO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQmFkIGFyZ3VtZW50cyBzdXBwbGllZCAod3JvbmcgcHJvcGVydHkpLicpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcnVuVGltZTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9nZXRJbmZvID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY2xvY2ssIGVsYXBzZWQsIGtleSwgcnVuVGltZSwgdmFsO1xuICAgICAgcnVuVGltZSA9IHRoaXMucnVubmluZyA/IHRoaXMudGltZS5ydW4gKyBub3coKSAtIHRoaXMudGltZS5zdGFydCA6IHRoaXMudGltZS5ydW47XG4gICAgICBlbGFwc2VkID0gdGhpcy5fcnVuVGltZVRvRWxhcHNlZFRpbWUocnVuVGltZSk7XG4gICAgICBjbG9jayA9IHRoaXMuX3J1blRpbWVUb0Nsb2NrVGltZShydW5UaW1lKTtcbiAgICAgIGlmICh0aGlzLnNldHRpbmdzLmZsb29yKSB7XG4gICAgICAgIGZvciAoa2V5IGluIGVsYXBzZWQpIHtcbiAgICAgICAgICB2YWwgPSBlbGFwc2VkW2tleV07XG4gICAgICAgICAgZWxhcHNlZCA9IE1hdGguZmxvb3IodmFsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMuc2V0dGluZ3MucGFkKSB7XG4gICAgICAgIGZvciAoa2V5IGluIGNsb2NrKSB7XG4gICAgICAgICAgdmFsID0gY2xvY2tba2V5XTtcbiAgICAgICAgICB2YWwgPSB0aGlzLl9wYWQodmFsLCB0aGlzLnNldHRpbmdzLnBhZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRpbWU6IHtcbiAgICAgICAgICBlbGFwc2VkOiBlbGFwc2VkLFxuICAgICAgICAgIGNsb2NrOiBjbG9ja1xuICAgICAgICB9LFxuICAgICAgICBjb3VudDogdGhpcy5jb3VudFxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9hZGp1c3RSdW5UaW1lID0gZnVuY3Rpb24ob3BlcmF0aW9uLCBydW5UaW1lKSB7XG4gICAgICBzd2l0Y2ggKG9wZXJhdGlvbikge1xuICAgICAgICBjYXNlICdzZXQnOlxuICAgICAgICAgIHRoaXMudGltZS5ydW4gPSBydW5UaW1lO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdhZGQnOlxuICAgICAgICAgIHRoaXMudGltZS5ydW4gKz0gcnVuVGltZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnc3VidHJhY3QnOlxuICAgICAgICAgIHRoaXMudGltZS5ydW4gLT0gcnVuVGltZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBhcmd1bWVudHMgc3VwcGxpZWQgKGludmFsaWQgb3BlcmF0aW9uKS4nKTtcbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5zZXR0aW5ncy5hbGxvd05lZ2F0aXZlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRpbWUucnVuID0gTWF0aC5tYXgodGhpcy50aW1lLnJ1biwgMCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5fYWRqdXN0Q291bnQgPSBmdW5jdGlvbihvcGVyYXRpb24sIGNvdW50KSB7XG4gICAgICB2YXIga2V5LCB2YWw7XG4gICAgICBmb3IgKGtleSBpbiBjb3VudCkge1xuICAgICAgICB2YWwgPSBjb3VudFtrZXldO1xuICAgICAgICBpZiAoa2V5ID09PSAnc3RhcnQnIHx8IGtleSA9PT0gJ3N0b3AnIHx8IGtleSA9PT0gJ3Jlc2V0Jykge1xuICAgICAgICAgIGlmICh0aGlzLl9pc0ludCh2YWwpKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKG9wZXJhdGlvbikge1xuICAgICAgICAgICAgICBjYXNlICdzZXQnOlxuICAgICAgICAgICAgICAgIHRoaXMuY291bnRba2V5XSA9IHZhbDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnYWRkJzpcbiAgICAgICAgICAgICAgICB0aGlzLmNvdW50W2tleV0gKz0gdmFsO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdzdWJ0cmFjdCc6XG4gICAgICAgICAgICAgICAgdGhpcy5jb3VudFtrZXldIC09IHZhbDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBhcmd1bWVudHMgc3VwcGxpZWQgKGludmFsaWQgb3BlcmF0aW9uKS4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5zZXR0aW5ncy5hbGxvd05lZ2F0aXZlKSB7XG4gICAgICAgICAgICAgIHRoaXMuY291bnRba2V5XSA9IE1hdGgubWF4KHRoaXMuY291bnRba2V5XSwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQmFkIGFyZ3VtZW50cyBzdXBwbGllZCAoY291bnQgdmFsdWUgaXMgbm90IGFuIGludGVnZXIpLicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBhcmd1bWVudHMgc3VwcGxpZWQgKHdyb25nIHByb3BlcnR5KS4nKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX2FkanVzdEluZm8gPSBmdW5jdGlvbihvcGVyYXRpb24sIGluZm8pIHtcbiAgICAgIGlmIChpbmZvLmVsYXBzZWQgIT0gbnVsbCkge1xuICAgICAgICB0aGlzLl9hZGp1c3RSdW5UaW1lKG9wZXJhdGlvbiwgdGhpcy5fZWxhcHNlZFRpbWVUb1J1blRpbWUoaW5mby5lbGFwc2VkKSk7XG4gICAgICB9XG4gICAgICBpZiAoaW5mby5jbG9jayAhPSBudWxsKSB7XG4gICAgICAgIHRoaXMuX2FkanVzdFJ1blRpbWUob3BlcmF0aW9uLCB0aGlzLl9jbG9ja1RpbWVUb1J1blRpbWUoaW5mby5jbG9jaykpO1xuICAgICAgfVxuICAgICAgaWYgKGluZm8uY291bnQgIT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYWRqdXN0Q291bnQob3BlcmF0aW9uLCBpbmZvLmNvdW50KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9sb29wID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnB1bHNlID0gcmFmKHRoaXMuX2xvb3ApO1xuICAgICAgcmV0dXJuIHRoaXMuX3N0ZXAoKTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9zdGVwID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5zdGVwKHRoaXMuX2dldEluZm8oKSk7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICBpZiAoY2FsbGJhY2sgPT0gbnVsbCkge1xuICAgICAgICBjYWxsYmFjayA9IHRoaXMuc2V0dGluZ3Muc3RhcnQ7XG4gICAgICB9XG4gICAgICB0aGlzLl92YWxpZGF0ZUFyZ3VtZW50cyhbW2NhbGxiYWNrLCAnZnVuY3Rpb24nLCAnQ2FsbGJhY2sgc3VwcGxpZWQgaXMgbm90IGEgZnVuY3Rpb24uJ11dKTtcbiAgICAgIGlmICghdGhpcy5ydW5uaW5nKSB7XG4gICAgICAgIHRoaXMuY291bnQuc3RhcnQrKztcbiAgICAgICAgdGhpcy5ydW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy50aW1lLnN0YXJ0ID0gbm93KCk7XG4gICAgICAgIHRoaXMuX2xvb3AoKTtcbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgY2FsbGJhY2sodGhpcy5fZ2V0SW5mbygpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgIGlmIChjYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICAgIGNhbGxiYWNrID0gdGhpcy5zZXR0aW5ncy5zdG9wO1xuICAgICAgfVxuICAgICAgdGhpcy5fdmFsaWRhdGVBcmd1bWVudHMoW1tjYWxsYmFjaywgJ2Z1bmN0aW9uJywgJ0NhbGxiYWNrIHN1cHBsaWVkIGlzIG5vdCBhIGZ1bmN0aW9uLiddXSk7XG4gICAgICBpZiAodGhpcy5ydW5uaW5nKSB7XG4gICAgICAgIHJhZi5jYW5jZWwodGhpcy5wdWxzZSk7XG4gICAgICAgIHRoaXMudGltZS5zdG9wID0gbm93KCk7XG4gICAgICAgIHRoaXMudGltZS5ydW4gKz0gdGhpcy50aW1lLnN0b3AgLSB0aGlzLnRpbWUuc3RhcnQ7XG4gICAgICAgIHRoaXMuY291bnQuc3RvcCsrO1xuICAgICAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fc3RlcCgpO1xuICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICBjYWxsYmFjayh0aGlzLl9nZXRJbmZvKCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oY2FsbGJhY2ssIGNvdW50KSB7XG4gICAgICB2YXIgY2FsbGJhY2tFbGlnaWJsZSwga2V5LCB2YWwsIF9yZWY7XG4gICAgICBpZiAoY2FsbGJhY2sgPT0gbnVsbCkge1xuICAgICAgICBjYWxsYmFjayA9IHRoaXMuc2V0dGluZ3MucmVzZXQ7XG4gICAgICB9XG4gICAgICB0aGlzLl92YWxpZGF0ZUFyZ3VtZW50cyhbW2NhbGxiYWNrLCAnZnVuY3Rpb24nLCAnQ2FsbGJhY2sgc3VwcGxpZWQgaXMgbm90IGEgZnVuY3Rpb24uJ11dKTtcbiAgICAgIGlmICh0aGlzLnRpbWUucnVuID4gMCkge1xuICAgICAgICBjYWxsYmFja0VsaWdpYmxlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy50aW1lLnJ1biA9IDA7XG4gICAgICAgIHRoaXMuY291bnQucmVzZXQrKztcbiAgICAgICAgdGhpcy50aW1lLnN0YXJ0ID0gbm93KCk7XG4gICAgICAgIHRoaXMudGltZS5zdG9wID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmIChjb3VudCkge1xuICAgICAgICBfcmVmID0gdGhpcy5jb3VudDtcbiAgICAgICAgZm9yIChrZXkgaW4gX3JlZikge1xuICAgICAgICAgIHZhbCA9IF9yZWZba2V5XTtcbiAgICAgICAgICBpZiAodmFsID4gMCkge1xuICAgICAgICAgICAgY2FsbGJhY2tFbGlnaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmNvdW50LnN0YXJ0ID0gMDtcbiAgICAgICAgICAgIHRoaXMuY291bnQuc3RvcCA9IDA7XG4gICAgICAgICAgICB0aGlzLmNvdW50LnJlc2V0ID0gMDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY2FsbGJhY2tFbGlnaWJsZSAmJiAodHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIgPyBjYWxsYmFjayh0aGlzLl9nZXRJbmZvKCkpIDogdm9pZCAwKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuaW5mbyA9IGZ1bmN0aW9uKGluZm8sIGNhbGxiYWNrKSB7XG4gICAgICBpZiAoY2FsbGJhY2sgPT0gbnVsbCkge1xuICAgICAgICBjYWxsYmFjayA9IHRoaXMuc2V0dGluZ3MuaW5mbztcbiAgICAgIH1cbiAgICAgIGlmIChpbmZvICE9IG51bGwpIHtcbiAgICAgICAgdGhpcy5fdmFsaWRhdGVBcmd1bWVudHMoW1tpbmZvLCAnaW5mbycsICdJbmZvIHN1cHBsaWVkIGlzIG5vdCB2YWxpZC4nLCAnTm8gYXJndW1lbnRzIHN1cHBsaWVkLiddLCBbY2FsbGJhY2ssICdmdW5jdGlvbicsICdDYWxsYmFjayBzdXBwbGllZCBpcyBub3QgYSBmdW5jdGlvbi4nXV0pO1xuICAgICAgICB0aGlzLl9hZGp1c3RJbmZvKCdzZXQnLCBpbmZvKTtcbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgY2FsbGJhY2sodGhpcy5fZ2V0SW5mbygpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9nZXRJbmZvKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihpbmZvLCBjYWxsYmFjaykge1xuICAgICAgaWYgKGNhbGxiYWNrID09IG51bGwpIHtcbiAgICAgICAgY2FsbGJhY2sgPSB0aGlzLnNldHRpbmdzLmFkZDtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3ZhbGlkYXRlQXJndW1lbnRzKFtbaW5mbywgJ2luZm8nLCAnSW5mbyBzdXBwbGllZCBpcyBub3QgdmFsaWQuJywgJ05vIGFyZ3VtZW50cyBzdXBwbGllZC4nXSwgW2NhbGxiYWNrLCAnZnVuY3Rpb24nLCAnQ2FsbGJhY2sgc3VwcGxpZWQgaXMgbm90IGEgZnVuY3Rpb24uJ11dKTtcbiAgICAgIHRoaXMuX2FkanVzdEluZm8oJ2FkZCcsIGluZm8pO1xuICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGNhbGxiYWNrKHRoaXMuX2dldEluZm8oKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLnN1YnRyYWN0ID0gZnVuY3Rpb24oaW5mbywgY2FsbGJhY2spIHtcbiAgICAgIGlmIChjYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICAgIGNhbGxiYWNrID0gdGhpcy5zZXR0aW5ncy5zdWJ0cmFjdDtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3ZhbGlkYXRlQXJndW1lbnRzKFtbaW5mbywgJ2luZm8nLCAnSW5mbyBzdXBwbGllZCBpcyBub3QgdmFsaWQuJywgJ05vIGFyZ3VtZW50cyBzdXBwbGllZC4nXSwgW2NhbGxiYWNrLCAnZnVuY3Rpb24nLCAnQ2FsbGJhY2sgc3VwcGxpZWQgaXMgbm90IGEgZnVuY3Rpb24uJ11dKTtcbiAgICAgIHRoaXMuX2FkanVzdEluZm8oJ3N1YnRyYWN0JywgaW5mbyk7XG4gICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgY2FsbGJhY2sodGhpcy5fZ2V0SW5mbygpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUud2hlbiA9IGZ1bmN0aW9uKHRpbWUsIGNhbGxiYWNrKSB7XG4gICAgICBpZiAoY2FsbGJhY2sgPT0gbnVsbCkge1xuICAgICAgICBjYWxsYmFjayA9IHRoaXMuc2V0dGluZ3Mud2hlbjtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3ZhbGlkYXRlQXJndW1lbnRzKFtbdGltZSwgJ3RpbWUnLCAnVGltZSBzdXBwbGllZCBpcyBub3QgdmFsaWQuJywgJ05vIGFyZ3VtZW50cyBzdXBwbGllZC4nXSwgW2NhbGxiYWNrLCAnZnVuY3Rpb24nLCAnQ2FsbGJhY2sgc3VwcGxpZWQgaXMgbm90IGEgZnVuY3Rpb24uJywgJ05vIGNhbGxiYWNrIHN1cHBsaWVkLiddXSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLmV2ZXJ5ID0gZnVuY3Rpb24odGltZSwgY2FsbGJhY2spIHtcbiAgICAgIGlmIChjYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICAgIGNhbGxiYWNrID0gdGhpcy5zZXR0aW5ncy5ldmVyeTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3ZhbGlkYXRlQXJndW1lbnRzKFtbdGltZSwgJ3RpbWUnLCAnVGltZSBzdXBwbGllZCBpcyBub3QgdmFsaWQuJywgJ05vIGFyZ3VtZW50cyBzdXBwbGllZC4nXSwgW2NhbGxiYWNrLCAnZnVuY3Rpb24nLCAnQ2FsbGJhY2sgc3VwcGxpZWQgaXMgbm90IGEgZnVuY3Rpb24uJywgJ05vIGNhbGxiYWNrIHN1cHBsaWVkLiddXSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlW1wid2hpbGVcIl0gPSBmdW5jdGlvbihzdGFydFRpbWUsIGVuZFRpbWUsIGNhbGxiYWNrKSB7XG4gICAgICBpZiAoY2FsbGJhY2sgPT0gbnVsbCkge1xuICAgICAgICBjYWxsYmFjayA9IHRoaXMuc2V0dGluZ3NbXCJ3aGlsZVwiXTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3ZhbGlkYXRlQXJndW1lbnRzKFtbc3RhcnRUaW1lLCAndGltZScsICdTdGFydCB0aW1lIHN1cHBsaWVkIGlzIG5vdCB2YWxpZC4nLCAnTm8gYXJndW1lbnRzIHN1cHBsaWVkLiddLCBbZW5kVGltZSwgJ3RpbWUnLCAnRW5kIHRpbWUgc3VwcGxpZWQgaXMgbm90IHZhbGlkLicsICdObyBlbmQgdGltZSBzdXBwbGllZC4nXSwgW2NhbGxiYWNrLCAnZnVuY3Rpb24nLCAnQ2FsbGJhY2sgc3VwcGxpZWQgaXMgbm90IGEgZnVuY3Rpb24uJywgJ05vIGNhbGxiYWNrIHN1cHBsaWVkLiddXSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLmR1cmluZyA9IGZ1bmN0aW9uKHN0YXJ0VGltZSwgZW5kVGltZSwgc3RhcnRDYWxsYmFjaywgZW5kQ2FsbGJhY2spIHtcbiAgICAgIGlmIChzdGFydENhbGxiYWNrID09IG51bGwpIHtcbiAgICAgICAgc3RhcnRDYWxsYmFjayA9IHRoaXMuc2V0dGluZ3MuZHVyaW5nU3RhcnQ7XG4gICAgICB9XG4gICAgICBpZiAoZW5kQ2FsbGJhY2sgPT0gbnVsbCkge1xuICAgICAgICBlbmRDYWxsYmFjayA9IHRoaXMuc2V0dGluZ3MuZHVyaW5nRW5kO1xuICAgICAgfVxuICAgICAgdGhpcy5fdmFsaWRhdGVBcmd1bWVudHMoW1tzdGFydFRpbWUsICd0aW1lJywgJ1N0YXJ0IHRpbWUgc3VwcGxpZWQgaXMgbm90IHZhbGlkLicsICdObyBhcmd1bWVudHMgc3VwcGxpZWQuJ10sIFtlbmRUaW1lLCAndGltZScsICdFbmQgdGltZSBzdXBwbGllZCBpcyBub3QgdmFsaWQuJywgJ05vIGVuZCB0aW1lIHN1cHBsaWVkLiddLCBbc3RhcnRDYWxsYmFjaywgJ2Z1bmN0aW9uJywgJ1N0YXJ0IGNhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uLicsICdObyBzdGFydCBjYWxsYmFjayBzdXBwbGllZC4nXSwgW2VuZENhbGxiYWNrLCAnZnVuY3Rpb24nLCAnRW5kIGNhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uJywgJ05vIGVuZCBjYWxsYmFjayBzdXBwbGllZC4nXV0pO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5iZWdpbm5pbmcgPSBmdW5jdGlvbihzdGFydFRpbWUsIHN0YXJ0Q2FsbGJhY2spIHtcbiAgICAgIGlmIChzdGFydENhbGxiYWNrID09IG51bGwpIHtcbiAgICAgICAgc3RhcnRDYWxsYmFjayA9IHRoaXMuc2V0dGluZ3MuYmVnaW5uaW5nO1xuICAgICAgfVxuICAgICAgdGhpcy5fdmFsaWRhdGVBcmd1bWVudHMoW1tzdGFydFRpbWUsICd0aW1lJywgJ1N0YXJ0IHRpbWUgc3VwcGxpZWQgaXMgbm90IHZhbGlkLicsICdObyBhcmd1bWVudHMgc3VwcGxpZWQuJ10sIFtzdGFydENhbGxiYWNrLCAnZnVuY3Rpb24nLCAnU3RhcnQgY2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24uJywgJ05vIHN0YXJ0IGNhbGxiYWNrIHN1cHBsaWVkLiddXSk7XG4gICAgICB0aGlzLmR1cmluZyhzdGFydFRpbWUsIEluZmluaXR5LCBzdGFydENhbGxiYWNrLCBOT09QKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuZW5kaW5nID0gZnVuY3Rpb24oZW5kVGltZSwgZW5kQ2FsbGJhY2spIHtcbiAgICAgIGlmIChlbmRDYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICAgIGVuZENhbGxiYWNrID0gdGhpcy5zZXR0aW5ncy5lbmRpbmc7XG4gICAgICB9XG4gICAgICB0aGlzLl92YWxpZGF0ZUFyZ3VtZW50cyhbW2VuZFRpbWUsICd0aW1lJywgJ1RpbWUgc3VwcGxpZWQgaXMgbm90IHZhbGlkLicsICdObyBhcmd1bWVudHMgc3VwcGxpZWQuJ10sIFtlbmRDYWxsYmFjaywgJ2Z1bmN0aW9uJywgJ0VuZCBjYWxsYmFjayBpcyBub3QgYSBmdW5jdGlvbi4nLCAnTm8gZW5kIGNhbGxiYWNrIHN1cHBsaWVkLiddXSk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgcmV0dXJuIExvY2tzdGVwO1xuXG4gIH0pKCk7XG5cbiAgbW9kdWxlLmV4cG9ydHMgPSBMb2Nrc3RlcDtcblxufSkuY2FsbCh0aGlzKTtcblxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCIxWWlaNVNcIikpIl19
(5)
});
