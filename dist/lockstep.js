!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Lockstep=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
// shim for using process in browser

var process = module.exports = {};

process.nextTick = (function () {
    var canSetImmediate = typeof window !== 'undefined'
    && window.setImmediate;
    var canPost = typeof window !== 'undefined'
    && window.postMessage && window.addEventListener
    ;

    if (canSetImmediate) {
        return function (f) { return window.setImmediate(f) };
    }

    if (canPost) {
        var queue = [];
        window.addEventListener('message', function (ev) {
            var source = ev.source;
            if ((source === window || source === null) && ev.data === 'process-tick') {
                ev.stopPropagation();
                if (queue.length > 0) {
                    var fn = queue.shift();
                    fn();
                }
            }
        }, true);

        return function nextTick(fn) {
            queue.push(fn);
            window.postMessage('process-tick', '*');
        };
    }

    return function nextTick(fn) {
        setTimeout(fn, 0);
    };
})();

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
}

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};

},{}],2:[function(_dereq_,module,exports){
var now = _dereq_('performance-now')
  , global = typeof window === 'undefined' ? {} : window
  , vendors = ['moz', 'webkit']
  , suffix = 'AnimationFrame'
  , raf = global['request' + suffix]
  , caf = global['cancel' + suffix] || global['cancelRequest' + suffix]
  , isNative = true

for(var i = 0; i < vendors.length && !raf; i++) {
  raf = global[vendors[i] + 'Request' + suffix]
  caf = global[vendors[i] + 'Cancel' + suffix]
      || global[vendors[i] + 'CancelRequest' + suffix]
}

// Some versions of FF have rAF but not cAF
if(!raf || !caf) {
  isNative = false

  var last = 0
    , id = 0
    , queue = []
    , frameDuration = 1000 / 60

  raf = function(callback) {
    if(queue.length === 0) {
      var _now = now()
        , next = Math.max(0, frameDuration - (_now - last))
      last = next + _now
      setTimeout(function() {
        var cp = queue.slice(0)
        // Clear queue here to prevent
        // callbacks from appending listeners
        // to the current frame's queue
        queue.length = 0
        for(var i = 0; i < cp.length; i++) {
          if(!cp[i].cancelled) {
            try{
              cp[i].callback(last)
            } catch(e) {
              setTimeout(function() { throw e }, 0)
            }
          }
        }
      }, Math.round(next))
    }
    queue.push({
      handle: ++id,
      callback: callback,
      cancelled: false
    })
    return id
  }

  caf = function(handle) {
    for(var i = 0; i < queue.length; i++) {
      if(queue[i].handle === handle) {
        queue[i].cancelled = true
      }
    }
  }
}

module.exports = function(fn) {
  // Wrap in a new function to prevent
  // `cancel` potentially being assigned
  // to the native rAF function
  if(!isNative) {
    return raf.call(global, fn)
  }
  return raf.call(global, function() {
    try{
      fn.apply(this, arguments)
    } catch(e) {
      setTimeout(function() { throw e }, 0)
    }
  })
}
module.exports.cancel = function() {
  caf.apply(global, arguments)
}

},{"performance-now":3}],3:[function(_dereq_,module,exports){
(function (process){
// Generated by CoffeeScript 1.6.3
(function() {
  var getNanoSeconds, hrtime, loadTime;

  if ((typeof performance !== "undefined" && performance !== null) && performance.now) {
    module.exports = function() {
      return performance.now();
    };
  } else if ((typeof process !== "undefined" && process !== null) && process.hrtime) {
    module.exports = function() {
      return (getNanoSeconds() - loadTime) / 1e6;
    };
    hrtime = process.hrtime;
    getNanoSeconds = function() {
      var hr;
      hr = hrtime();
      return hr[0] * 1e9 + hr[1];
    };
    loadTime = getNanoSeconds();
  } else if (Date.now) {
    module.exports = function() {
      return Date.now() - loadTime;
    };
    loadTime = Date.now();
  } else {
    module.exports = function() {
      return new Date().getTime() - loadTime;
    };
    loadTime = new Date().getTime();
  }

}).call(this);

/*
//@ sourceMappingURL=performance-now.map
*/

}).call(this,_dereq_("1YiZ5S"))
},{"1YiZ5S":1}],4:[function(_dereq_,module,exports){
(function() {
  var Lockstep, MSQTY, isInt, merge, microseconds, noop, raf, type, _ref,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  raf = _dereq_('raf');

  MSQTY = {};

  MSQTY.microseconds = 0.001;

  MSQTY.milliseconds = 1;

  MSQTY.seconds = 1000;

  MSQTY.minutes = MSQTY.seconds * 60;

  MSQTY.hours = MSQTY.minutes * 60;

  MSQTY.days = MSQTY.hours * 24;

  noop = function() {};

  type = function(value) {
    return {}.toString.call(value).match(/\s([a-zA-Z]+)/)[1].toLowerCase();
  };

  isInt = function(value) {
    return !isNaN(value) && parseInt(Number(value)) === value && !isNaN(parseInt(value, 10));
  };

  merge = function(obj1, obj2) {
    var name, obj3;
    obj3 = {};
    for (name in obj1) {
      obj3[name] = obj1[name];
    }
    for (name in obj2) {
      obj3[name] = obj2[name];
    }
    return obj3;
  };

  microseconds = true;

  window.performance = (_ref = window.performance) != null ? _ref : {};

  performance.now = (function() {
    var _ref1, _ref2, _ref3, _ref4, _ref5;
    return (_ref1 = (_ref2 = (_ref3 = (_ref4 = (_ref5 = performance.now) != null ? _ref5 : performance.mozNow) != null ? _ref4 : performance.msNow) != null ? _ref3 : performance.oNow) != null ? _ref2 : performance.webkitNow) != null ? _ref1 : microseconds = false || function() {
      var _ref6;
      return (_ref6 = typeof Date.now === "function" ? Date.now() : void 0) != null ? _ref6 : new Date().getTime();
    };
  })();

  Lockstep = (function() {
    function Lockstep() {
      this._loop = __bind(this._loop, this);
      var options;
      options = this._checkArguments(arguments);
      this.settings = this._buildSettings(options);
      this.running = false;
      this.count = {
        start: 0,
        stop: 0,
        reset: 0
      };
      this.time = {
        start: null,
        stop: null,
        elapsed: 0
      };
    }

    Lockstep.prototype._checkArguments = function(args) {
      var options;
      if (args.length === 0) {
        throw new Error('No arguments supplied.');
      } else if (args.length === 1) {
        if (type(args[0]) === 'function') {
          options = {
            step: args[0]
          };
        } else if (type(args[0]) === 'object') {
          if (type(args[0].step) === 'function') {
            options = args[0];
          } else {
            throw new Error('Bad arguments supplied (no valid "step" function).');
          }
        } else {
          throw new Error('Bad arguments supplied (wrong type).');
        }
      } else if (args.length >= 2) {
        if (type(args[0]) === 'object' && type(args[1]) === 'function') {
          if (args[0].step != null) {
            throw new Error('Bad arguments supplied (redundant "step" function).');
          } else {
            args[0].step = args[1];
            options = args[0];
          }
        } else {
          throw new Error('Bad arguments supplied (wrong type).');
        }
      }
      if (options.pad != null) {
        if (!(options.pad === false || isInt(options.pad))) {
          throw new Error('Bad arguments supplied ("pad" option must have a false or integer value).');
        }
      }
      return options;
    };

    Lockstep.prototype._buildSettings = function(options) {
      var defaults;
      defaults = {
        pad: false,
        floor: false
      };
      return merge(defaults, options);
    };

    Lockstep.prototype._millisecondsToClockTime = function(ms) {
      var clockTime, clockTimeMicroseconds;
      if (microseconds) {
        clockTimeMicroseconds = {
          microseconds: Math.floor((ms % 1) / MSQTY.microseconds)
        };
        ms = Math.floor(ms);
      }
      clockTime = {
        milliseconds: ms % 1000,
        seconds: Math.floor(ms / MSQTY.seconds) % 60,
        minutes: Math.floor(ms / MSQTY.minutes) % 60,
        hours: Math.floor(ms / MSQTY.hours) % 24,
        days: Math.floor(ms / MSQTY.days)
      };
      return merge(clockTime, clockTimeMicroseconds != null ? clockTimeMicroseconds : {});
    };

    Lockstep.prototype._millisecondsToElapsedTime = function(ms) {
      var clockTime, clockTimeMicroseconds;
      if (microseconds) {
        clockTimeMicroseconds = {
          microseconds: ms / MSQTY.microseconds
        };
      }
      clockTime = {
        milliseconds: ms,
        seconds: ms / MSQTY.seconds,
        minutes: ms / MSQTY.minutes,
        hours: ms / MSQTY.hours,
        days: ms / MSQTY.days
      };
      return merge(clockTime, clockTimeMicroseconds != null ? clockTimeMicroseconds : {});
    };

    Lockstep.prototype._elapsedTimeToMilliseconds = function(elapsedTime) {
      return elapsedTime.milliseconds;
    };

    Lockstep.prototype._clockTimeToMilliseconds = function(clockTime) {
      var key, ms, val;
      ms = 0;
      for (key in clockTime) {
        val = clockTime[key];
        ms += val * MSQTY[key];
      }
      return ms;
    };

    Lockstep.prototype._loop = function() {
      this.pulse = raf(this._loop);
      return this._step();
    };

    Lockstep.prototype._step = function() {
      return this.settings.step(this.getInfo());
    };

    Lockstep.prototype._pad = function(int, length) {
      int += '';
      if (int.length >= length) {
        return int;
      } else {
        return "" + (new Array(length - int.length + 1).join('0')) + "int";
      }
    };

    Lockstep.prototype.start = function(callback) {
      if (callback == null) {
        callback = this.settings.start;
      }
      if (!this.running) {
        this.time.start = performance.now();
        this.count.start++;
        this.running = true;
        this._loop();
        if (typeof callback === "function") {
          callback(this.getInfo());
        }
      }
      return this;
    };

    Lockstep.prototype.stop = function(callback) {
      if (callback == null) {
        callback = this.settings.stop;
      }
      if (this.running) {
        raf.cancel(this.pulse);
        this.time.stop = performance.now();
        this.time.elapsed += this.time.stop - this.time.start;
        this.count.stop++;
        this.running = false;
        this._step();
        if (typeof callback === "function") {
          callback(this.getInfo());
        }
      }
      return this;
    };

    Lockstep.prototype.reset = function(callback, count) {
      var key, val;
      if (callback == null) {
        callback = this.settings.reset;
      }
      if (this.time.elapsed > 0) {
        this.count.reset++;
        this.time.start = performance.now();
        this.time.stop = null;
        this.time.elapsed = 0;
        if ((function() {
          var _ref1, _results;
          _ref1 = this.time;
          _results = [];
          for (key in _ref1) {
            val = _ref1[key];
            _results.push(count && val > 0);
          }
          return _results;
        }).call(this)) {
          this.count.start = 0;
          this.count.stop = 0;
          this.count.reset = 0;
        }
        if (typeof callback === "function") {
          callback(this.getInfo());
        }
      }
      return this;
    };

    Lockstep.prototype.add = function(milliseconds) {
      return this;
    };

    Lockstep.prototype.subtract = function(milliseconds) {
      return this;
    };

    Lockstep.prototype.getInfo = function() {
      var clock, elapsed, key, milliseconds, val;
      milliseconds = this.running ? this.time.elapsed + performance.now() - this.time.start : this.time.elapsed;
      elapsed = this._millisecondsToElapsedTime(milliseconds);
      clock = this._millisecondsToClockTime(milliseconds);
      if (this.settings.floor) {
        for (key in elapsed) {
          val = elapsed[key];
          elapsed = Math.floor(val);
        }
      }
      if (this.settings.pad) {
        for (key in clock) {
          val = clock[key];
          val = this._pad(val, this.settings.pad);
        }
      }
      return {
        time: {
          elapsed: elapsed,
          clock: clock
        },
        count: this.count
      };
    };

    Lockstep.prototype.setInfo = function(info) {
      return this;
    };

    Lockstep.prototype.when = function(time, callback) {
      return this;
    };

    Lockstep.prototype.every = function(time, callback) {
      return this;
    };

    Lockstep.prototype["while"] = function(startTime, endTime, callback) {
      return this;
    };

    Lockstep.prototype.during = function(startTime, endTime, startCallback, endCallback) {
      return this;
    };

    Lockstep.prototype.beginning = function(startTime, startCallback) {
      this.during(startTime, Infinity, startCallback, noop);
      return this;
    };

    Lockstep.prototype.ending = function(endTime, endCallback) {
      return this;
    };

    return Lockstep;

  })();

  module.exports = Lockstep;

}).call(this);

},{"raf":2}]},{},[4])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyIsIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL25vZGVfbW9kdWxlcy9yYWYvaW5kZXguanMiLCIvVXNlcnMvdHdhcnIvY29kZS9sb2Nrc3RlcC9ub2RlX21vZHVsZXMvcmFmL25vZGVfbW9kdWxlcy9wZXJmb3JtYW5jZS1ub3cvbGliL3BlcmZvcm1hbmNlLW5vdy5qcyIsIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL3NyYy9mYWtlX2MwZGFmZjhkLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8vIHNoaW0gZm9yIHVzaW5nIHByb2Nlc3MgaW4gYnJvd3NlclxuXG52YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307XG5cbnByb2Nlc3MubmV4dFRpY2sgPSAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBjYW5TZXRJbW1lZGlhdGUgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJ1xuICAgICYmIHdpbmRvdy5zZXRJbW1lZGlhdGU7XG4gICAgdmFyIGNhblBvc3QgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJ1xuICAgICYmIHdpbmRvdy5wb3N0TWVzc2FnZSAmJiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lclxuICAgIDtcblxuICAgIGlmIChjYW5TZXRJbW1lZGlhdGUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChmKSB7IHJldHVybiB3aW5kb3cuc2V0SW1tZWRpYXRlKGYpIH07XG4gICAgfVxuXG4gICAgaWYgKGNhblBvc3QpIHtcbiAgICAgICAgdmFyIHF1ZXVlID0gW107XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgICAgICB2YXIgc291cmNlID0gZXYuc291cmNlO1xuICAgICAgICAgICAgaWYgKChzb3VyY2UgPT09IHdpbmRvdyB8fCBzb3VyY2UgPT09IG51bGwpICYmIGV2LmRhdGEgPT09ICdwcm9jZXNzLXRpY2snKSB7XG4gICAgICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKHF1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZuID0gcXVldWUuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAgICAgZm4oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRydWUpO1xuXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBuZXh0VGljayhmbikge1xuICAgICAgICAgICAgcXVldWUucHVzaChmbik7XG4gICAgICAgICAgICB3aW5kb3cucG9zdE1lc3NhZ2UoJ3Byb2Nlc3MtdGljaycsICcqJyk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIGZ1bmN0aW9uIG5leHRUaWNrKGZuKSB7XG4gICAgICAgIHNldFRpbWVvdXQoZm4sIDApO1xuICAgIH07XG59KSgpO1xuXG5wcm9jZXNzLnRpdGxlID0gJ2Jyb3dzZXInO1xucHJvY2Vzcy5icm93c2VyID0gdHJ1ZTtcbnByb2Nlc3MuZW52ID0ge307XG5wcm9jZXNzLmFyZ3YgPSBbXTtcblxuZnVuY3Rpb24gbm9vcCgpIHt9XG5cbnByb2Nlc3Mub24gPSBub29wO1xucHJvY2Vzcy5hZGRMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLm9uY2UgPSBub29wO1xucHJvY2Vzcy5vZmYgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7XG5wcm9jZXNzLmVtaXQgPSBub29wO1xuXG5wcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5iaW5kaW5nIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn1cblxuLy8gVE9ETyhzaHR5bG1hbilcbnByb2Nlc3MuY3dkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gJy8nIH07XG5wcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xuIiwidmFyIG5vdyA9IHJlcXVpcmUoJ3BlcmZvcm1hbmNlLW5vdycpXG4gICwgZ2xvYmFsID0gdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcgPyB7fSA6IHdpbmRvd1xuICAsIHZlbmRvcnMgPSBbJ21veicsICd3ZWJraXQnXVxuICAsIHN1ZmZpeCA9ICdBbmltYXRpb25GcmFtZSdcbiAgLCByYWYgPSBnbG9iYWxbJ3JlcXVlc3QnICsgc3VmZml4XVxuICAsIGNhZiA9IGdsb2JhbFsnY2FuY2VsJyArIHN1ZmZpeF0gfHwgZ2xvYmFsWydjYW5jZWxSZXF1ZXN0JyArIHN1ZmZpeF1cbiAgLCBpc05hdGl2ZSA9IHRydWVcblxuZm9yKHZhciBpID0gMDsgaSA8IHZlbmRvcnMubGVuZ3RoICYmICFyYWY7IGkrKykge1xuICByYWYgPSBnbG9iYWxbdmVuZG9yc1tpXSArICdSZXF1ZXN0JyArIHN1ZmZpeF1cbiAgY2FmID0gZ2xvYmFsW3ZlbmRvcnNbaV0gKyAnQ2FuY2VsJyArIHN1ZmZpeF1cbiAgICAgIHx8IGdsb2JhbFt2ZW5kb3JzW2ldICsgJ0NhbmNlbFJlcXVlc3QnICsgc3VmZml4XVxufVxuXG4vLyBTb21lIHZlcnNpb25zIG9mIEZGIGhhdmUgckFGIGJ1dCBub3QgY0FGXG5pZighcmFmIHx8ICFjYWYpIHtcbiAgaXNOYXRpdmUgPSBmYWxzZVxuXG4gIHZhciBsYXN0ID0gMFxuICAgICwgaWQgPSAwXG4gICAgLCBxdWV1ZSA9IFtdXG4gICAgLCBmcmFtZUR1cmF0aW9uID0gMTAwMCAvIDYwXG5cbiAgcmFmID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICBpZihxdWV1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgIHZhciBfbm93ID0gbm93KClcbiAgICAgICAgLCBuZXh0ID0gTWF0aC5tYXgoMCwgZnJhbWVEdXJhdGlvbiAtIChfbm93IC0gbGFzdCkpXG4gICAgICBsYXN0ID0gbmV4dCArIF9ub3dcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBjcCA9IHF1ZXVlLnNsaWNlKDApXG4gICAgICAgIC8vIENsZWFyIHF1ZXVlIGhlcmUgdG8gcHJldmVudFxuICAgICAgICAvLyBjYWxsYmFja3MgZnJvbSBhcHBlbmRpbmcgbGlzdGVuZXJzXG4gICAgICAgIC8vIHRvIHRoZSBjdXJyZW50IGZyYW1lJ3MgcXVldWVcbiAgICAgICAgcXVldWUubGVuZ3RoID0gMFxuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgY3AubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZighY3BbaV0uY2FuY2VsbGVkKSB7XG4gICAgICAgICAgICB0cnl7XG4gICAgICAgICAgICAgIGNwW2ldLmNhbGxiYWNrKGxhc3QpXG4gICAgICAgICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsgdGhyb3cgZSB9LCAwKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwgTWF0aC5yb3VuZChuZXh0KSlcbiAgICB9XG4gICAgcXVldWUucHVzaCh7XG4gICAgICBoYW5kbGU6ICsraWQsXG4gICAgICBjYWxsYmFjazogY2FsbGJhY2ssXG4gICAgICBjYW5jZWxsZWQ6IGZhbHNlXG4gICAgfSlcbiAgICByZXR1cm4gaWRcbiAgfVxuXG4gIGNhZiA9IGZ1bmN0aW9uKGhhbmRsZSkge1xuICAgIGZvcih2YXIgaSA9IDA7IGkgPCBxdWV1ZS5sZW5ndGg7IGkrKykge1xuICAgICAgaWYocXVldWVbaV0uaGFuZGxlID09PSBoYW5kbGUpIHtcbiAgICAgICAgcXVldWVbaV0uY2FuY2VsbGVkID0gdHJ1ZVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGZuKSB7XG4gIC8vIFdyYXAgaW4gYSBuZXcgZnVuY3Rpb24gdG8gcHJldmVudFxuICAvLyBgY2FuY2VsYCBwb3RlbnRpYWxseSBiZWluZyBhc3NpZ25lZFxuICAvLyB0byB0aGUgbmF0aXZlIHJBRiBmdW5jdGlvblxuICBpZighaXNOYXRpdmUpIHtcbiAgICByZXR1cm4gcmFmLmNhbGwoZ2xvYmFsLCBmbilcbiAgfVxuICByZXR1cm4gcmFmLmNhbGwoZ2xvYmFsLCBmdW5jdGlvbigpIHtcbiAgICB0cnl7XG4gICAgICBmbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG4gICAgfSBjYXRjaChlKSB7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyB0aHJvdyBlIH0sIDApXG4gICAgfVxuICB9KVxufVxubW9kdWxlLmV4cG9ydHMuY2FuY2VsID0gZnVuY3Rpb24oKSB7XG4gIGNhZi5hcHBseShnbG9iYWwsIGFyZ3VtZW50cylcbn1cbiIsIihmdW5jdGlvbiAocHJvY2Vzcyl7XG4vLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNi4zXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBnZXROYW5vU2Vjb25kcywgaHJ0aW1lLCBsb2FkVGltZTtcblxuICBpZiAoKHR5cGVvZiBwZXJmb3JtYW5jZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBwZXJmb3JtYW5jZSAhPT0gbnVsbCkgJiYgcGVyZm9ybWFuY2Uubm93KSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICB9O1xuICB9IGVsc2UgaWYgKCh0eXBlb2YgcHJvY2VzcyAhPT0gXCJ1bmRlZmluZWRcIiAmJiBwcm9jZXNzICE9PSBudWxsKSAmJiBwcm9jZXNzLmhydGltZSkge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gKGdldE5hbm9TZWNvbmRzKCkgLSBsb2FkVGltZSkgLyAxZTY7XG4gICAgfTtcbiAgICBocnRpbWUgPSBwcm9jZXNzLmhydGltZTtcbiAgICBnZXROYW5vU2Vjb25kcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGhyO1xuICAgICAgaHIgPSBocnRpbWUoKTtcbiAgICAgIHJldHVybiBoclswXSAqIDFlOSArIGhyWzFdO1xuICAgIH07XG4gICAgbG9hZFRpbWUgPSBnZXROYW5vU2Vjb25kcygpO1xuICB9IGVsc2UgaWYgKERhdGUubm93KSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBEYXRlLm5vdygpIC0gbG9hZFRpbWU7XG4gICAgfTtcbiAgICBsb2FkVGltZSA9IERhdGUubm93KCk7XG4gIH0gZWxzZSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIGxvYWRUaW1lO1xuICAgIH07XG4gICAgbG9hZFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgfVxuXG59KS5jYWxsKHRoaXMpO1xuXG4vKlxuLy9AIHNvdXJjZU1hcHBpbmdVUkw9cGVyZm9ybWFuY2Utbm93Lm1hcFxuKi9cblxufSkuY2FsbCh0aGlzLHJlcXVpcmUoXCIxWWlaNVNcIikpIiwiKGZ1bmN0aW9uKCkge1xuICB2YXIgTG9ja3N0ZXAsIE1TUVRZLCBpc0ludCwgbWVyZ2UsIG1pY3Jvc2Vjb25kcywgbm9vcCwgcmFmLCB0eXBlLCBfcmVmLFxuICAgIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH07XG5cbiAgcmFmID0gcmVxdWlyZSgncmFmJyk7XG5cbiAgTVNRVFkgPSB7fTtcblxuICBNU1FUWS5taWNyb3NlY29uZHMgPSAwLjAwMTtcblxuICBNU1FUWS5taWxsaXNlY29uZHMgPSAxO1xuXG4gIE1TUVRZLnNlY29uZHMgPSAxMDAwO1xuXG4gIE1TUVRZLm1pbnV0ZXMgPSBNU1FUWS5zZWNvbmRzICogNjA7XG5cbiAgTVNRVFkuaG91cnMgPSBNU1FUWS5taW51dGVzICogNjA7XG5cbiAgTVNRVFkuZGF5cyA9IE1TUVRZLmhvdXJzICogMjQ7XG5cbiAgbm9vcCA9IGZ1bmN0aW9uKCkge307XG5cbiAgdHlwZSA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgcmV0dXJuIHt9LnRvU3RyaW5nLmNhbGwodmFsdWUpLm1hdGNoKC9cXHMoW2EtekEtWl0rKS8pWzFdLnRvTG93ZXJDYXNlKCk7XG4gIH07XG5cbiAgaXNJbnQgPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgIHJldHVybiAhaXNOYU4odmFsdWUpICYmIHBhcnNlSW50KE51bWJlcih2YWx1ZSkpID09PSB2YWx1ZSAmJiAhaXNOYU4ocGFyc2VJbnQodmFsdWUsIDEwKSk7XG4gIH07XG5cbiAgbWVyZ2UgPSBmdW5jdGlvbihvYmoxLCBvYmoyKSB7XG4gICAgdmFyIG5hbWUsIG9iajM7XG4gICAgb2JqMyA9IHt9O1xuICAgIGZvciAobmFtZSBpbiBvYmoxKSB7XG4gICAgICBvYmozW25hbWVdID0gb2JqMVtuYW1lXTtcbiAgICB9XG4gICAgZm9yIChuYW1lIGluIG9iajIpIHtcbiAgICAgIG9iajNbbmFtZV0gPSBvYmoyW25hbWVdO1xuICAgIH1cbiAgICByZXR1cm4gb2JqMztcbiAgfTtcblxuICBtaWNyb3NlY29uZHMgPSB0cnVlO1xuXG4gIHdpbmRvdy5wZXJmb3JtYW5jZSA9IChfcmVmID0gd2luZG93LnBlcmZvcm1hbmNlKSAhPSBudWxsID8gX3JlZiA6IHt9O1xuXG4gIHBlcmZvcm1hbmNlLm5vdyA9IChmdW5jdGlvbigpIHtcbiAgICB2YXIgX3JlZjEsIF9yZWYyLCBfcmVmMywgX3JlZjQsIF9yZWY1O1xuICAgIHJldHVybiAoX3JlZjEgPSAoX3JlZjIgPSAoX3JlZjMgPSAoX3JlZjQgPSAoX3JlZjUgPSBwZXJmb3JtYW5jZS5ub3cpICE9IG51bGwgPyBfcmVmNSA6IHBlcmZvcm1hbmNlLm1vek5vdykgIT0gbnVsbCA/IF9yZWY0IDogcGVyZm9ybWFuY2UubXNOb3cpICE9IG51bGwgPyBfcmVmMyA6IHBlcmZvcm1hbmNlLm9Ob3cpICE9IG51bGwgPyBfcmVmMiA6IHBlcmZvcm1hbmNlLndlYmtpdE5vdykgIT0gbnVsbCA/IF9yZWYxIDogbWljcm9zZWNvbmRzID0gZmFsc2UgfHwgZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgX3JlZjY7XG4gICAgICByZXR1cm4gKF9yZWY2ID0gdHlwZW9mIERhdGUubm93ID09PSBcImZ1bmN0aW9uXCIgPyBEYXRlLm5vdygpIDogdm9pZCAwKSAhPSBudWxsID8gX3JlZjYgOiBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICB9O1xuICB9KSgpO1xuXG4gIExvY2tzdGVwID0gKGZ1bmN0aW9uKCkge1xuICAgIGZ1bmN0aW9uIExvY2tzdGVwKCkge1xuICAgICAgdGhpcy5fbG9vcCA9IF9fYmluZCh0aGlzLl9sb29wLCB0aGlzKTtcbiAgICAgIHZhciBvcHRpb25zO1xuICAgICAgb3B0aW9ucyA9IHRoaXMuX2NoZWNrQXJndW1lbnRzKGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLnNldHRpbmdzID0gdGhpcy5fYnVpbGRTZXR0aW5ncyhvcHRpb25zKTtcbiAgICAgIHRoaXMucnVubmluZyA9IGZhbHNlO1xuICAgICAgdGhpcy5jb3VudCA9IHtcbiAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgIHN0b3A6IDAsXG4gICAgICAgIHJlc2V0OiAwXG4gICAgICB9O1xuICAgICAgdGhpcy50aW1lID0ge1xuICAgICAgICBzdGFydDogbnVsbCxcbiAgICAgICAgc3RvcDogbnVsbCxcbiAgICAgICAgZWxhcHNlZDogMFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX2NoZWNrQXJndW1lbnRzID0gZnVuY3Rpb24oYXJncykge1xuICAgICAgdmFyIG9wdGlvbnM7XG4gICAgICBpZiAoYXJncy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBhcmd1bWVudHMgc3VwcGxpZWQuJyk7XG4gICAgICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGlmICh0eXBlKGFyZ3NbMF0pID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHN0ZXA6IGFyZ3NbMF1cbiAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGUoYXJnc1swXSkgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgaWYgKHR5cGUoYXJnc1swXS5zdGVwKSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgb3B0aW9ucyA9IGFyZ3NbMF07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQmFkIGFyZ3VtZW50cyBzdXBwbGllZCAobm8gdmFsaWQgXCJzdGVwXCIgZnVuY3Rpb24pLicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBhcmd1bWVudHMgc3VwcGxpZWQgKHdyb25nIHR5cGUpLicpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID49IDIpIHtcbiAgICAgICAgaWYgKHR5cGUoYXJnc1swXSkgPT09ICdvYmplY3QnICYmIHR5cGUoYXJnc1sxXSkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBpZiAoYXJnc1swXS5zdGVwICE9IG51bGwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQmFkIGFyZ3VtZW50cyBzdXBwbGllZCAocmVkdW5kYW50IFwic3RlcFwiIGZ1bmN0aW9uKS4nKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXJnc1swXS5zdGVwID0gYXJnc1sxXTtcbiAgICAgICAgICAgIG9wdGlvbnMgPSBhcmdzWzBdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JhZCBhcmd1bWVudHMgc3VwcGxpZWQgKHdyb25nIHR5cGUpLicpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5wYWQgIT0gbnVsbCkge1xuICAgICAgICBpZiAoIShvcHRpb25zLnBhZCA9PT0gZmFsc2UgfHwgaXNJbnQob3B0aW9ucy5wYWQpKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQmFkIGFyZ3VtZW50cyBzdXBwbGllZCAoXCJwYWRcIiBvcHRpb24gbXVzdCBoYXZlIGEgZmFsc2Ugb3IgaW50ZWdlciB2YWx1ZSkuJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBvcHRpb25zO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX2J1aWxkU2V0dGluZ3MgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICB2YXIgZGVmYXVsdHM7XG4gICAgICBkZWZhdWx0cyA9IHtcbiAgICAgICAgcGFkOiBmYWxzZSxcbiAgICAgICAgZmxvb3I6IGZhbHNlXG4gICAgICB9O1xuICAgICAgcmV0dXJuIG1lcmdlKGRlZmF1bHRzLCBvcHRpb25zKTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9taWxsaXNlY29uZHNUb0Nsb2NrVGltZSA9IGZ1bmN0aW9uKG1zKSB7XG4gICAgICB2YXIgY2xvY2tUaW1lLCBjbG9ja1RpbWVNaWNyb3NlY29uZHM7XG4gICAgICBpZiAobWljcm9zZWNvbmRzKSB7XG4gICAgICAgIGNsb2NrVGltZU1pY3Jvc2Vjb25kcyA9IHtcbiAgICAgICAgICBtaWNyb3NlY29uZHM6IE1hdGguZmxvb3IoKG1zICUgMSkgLyBNU1FUWS5taWNyb3NlY29uZHMpXG4gICAgICAgIH07XG4gICAgICAgIG1zID0gTWF0aC5mbG9vcihtcyk7XG4gICAgICB9XG4gICAgICBjbG9ja1RpbWUgPSB7XG4gICAgICAgIG1pbGxpc2Vjb25kczogbXMgJSAxMDAwLFxuICAgICAgICBzZWNvbmRzOiBNYXRoLmZsb29yKG1zIC8gTVNRVFkuc2Vjb25kcykgJSA2MCxcbiAgICAgICAgbWludXRlczogTWF0aC5mbG9vcihtcyAvIE1TUVRZLm1pbnV0ZXMpICUgNjAsXG4gICAgICAgIGhvdXJzOiBNYXRoLmZsb29yKG1zIC8gTVNRVFkuaG91cnMpICUgMjQsXG4gICAgICAgIGRheXM6IE1hdGguZmxvb3IobXMgLyBNU1FUWS5kYXlzKVxuICAgICAgfTtcbiAgICAgIHJldHVybiBtZXJnZShjbG9ja1RpbWUsIGNsb2NrVGltZU1pY3Jvc2Vjb25kcyAhPSBudWxsID8gY2xvY2tUaW1lTWljcm9zZWNvbmRzIDoge30pO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX21pbGxpc2Vjb25kc1RvRWxhcHNlZFRpbWUgPSBmdW5jdGlvbihtcykge1xuICAgICAgdmFyIGNsb2NrVGltZSwgY2xvY2tUaW1lTWljcm9zZWNvbmRzO1xuICAgICAgaWYgKG1pY3Jvc2Vjb25kcykge1xuICAgICAgICBjbG9ja1RpbWVNaWNyb3NlY29uZHMgPSB7XG4gICAgICAgICAgbWljcm9zZWNvbmRzOiBtcyAvIE1TUVRZLm1pY3Jvc2Vjb25kc1xuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgY2xvY2tUaW1lID0ge1xuICAgICAgICBtaWxsaXNlY29uZHM6IG1zLFxuICAgICAgICBzZWNvbmRzOiBtcyAvIE1TUVRZLnNlY29uZHMsXG4gICAgICAgIG1pbnV0ZXM6IG1zIC8gTVNRVFkubWludXRlcyxcbiAgICAgICAgaG91cnM6IG1zIC8gTVNRVFkuaG91cnMsXG4gICAgICAgIGRheXM6IG1zIC8gTVNRVFkuZGF5c1xuICAgICAgfTtcbiAgICAgIHJldHVybiBtZXJnZShjbG9ja1RpbWUsIGNsb2NrVGltZU1pY3Jvc2Vjb25kcyAhPSBudWxsID8gY2xvY2tUaW1lTWljcm9zZWNvbmRzIDoge30pO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX2VsYXBzZWRUaW1lVG9NaWxsaXNlY29uZHMgPSBmdW5jdGlvbihlbGFwc2VkVGltZSkge1xuICAgICAgcmV0dXJuIGVsYXBzZWRUaW1lLm1pbGxpc2Vjb25kcztcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9jbG9ja1RpbWVUb01pbGxpc2Vjb25kcyA9IGZ1bmN0aW9uKGNsb2NrVGltZSkge1xuICAgICAgdmFyIGtleSwgbXMsIHZhbDtcbiAgICAgIG1zID0gMDtcbiAgICAgIGZvciAoa2V5IGluIGNsb2NrVGltZSkge1xuICAgICAgICB2YWwgPSBjbG9ja1RpbWVba2V5XTtcbiAgICAgICAgbXMgKz0gdmFsICogTVNRVFlba2V5XTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtcztcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9sb29wID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnB1bHNlID0gcmFmKHRoaXMuX2xvb3ApO1xuICAgICAgcmV0dXJuIHRoaXMuX3N0ZXAoKTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9zdGVwID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5zdGVwKHRoaXMuZ2V0SW5mbygpKTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9wYWQgPSBmdW5jdGlvbihpbnQsIGxlbmd0aCkge1xuICAgICAgaW50ICs9ICcnO1xuICAgICAgaWYgKGludC5sZW5ndGggPj0gbGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBpbnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gXCJcIiArIChuZXcgQXJyYXkobGVuZ3RoIC0gaW50Lmxlbmd0aCArIDEpLmpvaW4oJzAnKSkgKyBcImludFwiO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgaWYgKGNhbGxiYWNrID09IG51bGwpIHtcbiAgICAgICAgY2FsbGJhY2sgPSB0aGlzLnNldHRpbmdzLnN0YXJ0O1xuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLnJ1bm5pbmcpIHtcbiAgICAgICAgdGhpcy50aW1lLnN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIHRoaXMuY291bnQuc3RhcnQrKztcbiAgICAgICAgdGhpcy5ydW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fbG9vcCgpO1xuICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICBjYWxsYmFjayh0aGlzLmdldEluZm8oKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICBpZiAoY2FsbGJhY2sgPT0gbnVsbCkge1xuICAgICAgICBjYWxsYmFjayA9IHRoaXMuc2V0dGluZ3Muc3RvcDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnJ1bm5pbmcpIHtcbiAgICAgICAgcmFmLmNhbmNlbCh0aGlzLnB1bHNlKTtcbiAgICAgICAgdGhpcy50aW1lLnN0b3AgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgdGhpcy50aW1lLmVsYXBzZWQgKz0gdGhpcy50aW1lLnN0b3AgLSB0aGlzLnRpbWUuc3RhcnQ7XG4gICAgICAgIHRoaXMuY291bnQuc3RvcCsrO1xuICAgICAgICB0aGlzLnJ1bm5pbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fc3RlcCgpO1xuICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICBjYWxsYmFjayh0aGlzLmdldEluZm8oKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbihjYWxsYmFjaywgY291bnQpIHtcbiAgICAgIHZhciBrZXksIHZhbDtcbiAgICAgIGlmIChjYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICAgIGNhbGxiYWNrID0gdGhpcy5zZXR0aW5ncy5yZXNldDtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnRpbWUuZWxhcHNlZCA+IDApIHtcbiAgICAgICAgdGhpcy5jb3VudC5yZXNldCsrO1xuICAgICAgICB0aGlzLnRpbWUuc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgdGhpcy50aW1lLnN0b3AgPSBudWxsO1xuICAgICAgICB0aGlzLnRpbWUuZWxhcHNlZCA9IDA7XG4gICAgICAgIGlmICgoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIF9yZWYxLCBfcmVzdWx0cztcbiAgICAgICAgICBfcmVmMSA9IHRoaXMudGltZTtcbiAgICAgICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgICAgIGZvciAoa2V5IGluIF9yZWYxKSB7XG4gICAgICAgICAgICB2YWwgPSBfcmVmMVtrZXldO1xuICAgICAgICAgICAgX3Jlc3VsdHMucHVzaChjb3VudCAmJiB2YWwgPiAwKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgICAgICB9KS5jYWxsKHRoaXMpKSB7XG4gICAgICAgICAgdGhpcy5jb3VudC5zdGFydCA9IDA7XG4gICAgICAgICAgdGhpcy5jb3VudC5zdG9wID0gMDtcbiAgICAgICAgICB0aGlzLmNvdW50LnJlc2V0ID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICBjYWxsYmFjayh0aGlzLmdldEluZm8oKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24obWlsbGlzZWNvbmRzKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLnN1YnRyYWN0ID0gZnVuY3Rpb24obWlsbGlzZWNvbmRzKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLmdldEluZm8gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjbG9jaywgZWxhcHNlZCwga2V5LCBtaWxsaXNlY29uZHMsIHZhbDtcbiAgICAgIG1pbGxpc2Vjb25kcyA9IHRoaXMucnVubmluZyA/IHRoaXMudGltZS5lbGFwc2VkICsgcGVyZm9ybWFuY2Uubm93KCkgLSB0aGlzLnRpbWUuc3RhcnQgOiB0aGlzLnRpbWUuZWxhcHNlZDtcbiAgICAgIGVsYXBzZWQgPSB0aGlzLl9taWxsaXNlY29uZHNUb0VsYXBzZWRUaW1lKG1pbGxpc2Vjb25kcyk7XG4gICAgICBjbG9jayA9IHRoaXMuX21pbGxpc2Vjb25kc1RvQ2xvY2tUaW1lKG1pbGxpc2Vjb25kcyk7XG4gICAgICBpZiAodGhpcy5zZXR0aW5ncy5mbG9vcikge1xuICAgICAgICBmb3IgKGtleSBpbiBlbGFwc2VkKSB7XG4gICAgICAgICAgdmFsID0gZWxhcHNlZFtrZXldO1xuICAgICAgICAgIGVsYXBzZWQgPSBNYXRoLmZsb29yKHZhbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnNldHRpbmdzLnBhZCkge1xuICAgICAgICBmb3IgKGtleSBpbiBjbG9jaykge1xuICAgICAgICAgIHZhbCA9IGNsb2NrW2tleV07XG4gICAgICAgICAgdmFsID0gdGhpcy5fcGFkKHZhbCwgdGhpcy5zZXR0aW5ncy5wYWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aW1lOiB7XG4gICAgICAgICAgZWxhcHNlZDogZWxhcHNlZCxcbiAgICAgICAgICBjbG9jazogY2xvY2tcbiAgICAgICAgfSxcbiAgICAgICAgY291bnQ6IHRoaXMuY291bnRcbiAgICAgIH07XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5zZXRJbmZvID0gZnVuY3Rpb24oaW5mbykge1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS53aGVuID0gZnVuY3Rpb24odGltZSwgY2FsbGJhY2spIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuZXZlcnkgPSBmdW5jdGlvbih0aW1lLCBjYWxsYmFjaykge1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZVtcIndoaWxlXCJdID0gZnVuY3Rpb24oc3RhcnRUaW1lLCBlbmRUaW1lLCBjYWxsYmFjaykge1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5kdXJpbmcgPSBmdW5jdGlvbihzdGFydFRpbWUsIGVuZFRpbWUsIHN0YXJ0Q2FsbGJhY2ssIGVuZENhbGxiYWNrKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLmJlZ2lubmluZyA9IGZ1bmN0aW9uKHN0YXJ0VGltZSwgc3RhcnRDYWxsYmFjaykge1xuICAgICAgdGhpcy5kdXJpbmcoc3RhcnRUaW1lLCBJbmZpbml0eSwgc3RhcnRDYWxsYmFjaywgbm9vcCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLmVuZGluZyA9IGZ1bmN0aW9uKGVuZFRpbWUsIGVuZENhbGxiYWNrKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgcmV0dXJuIExvY2tzdGVwO1xuXG4gIH0pKCk7XG5cbiAgbW9kdWxlLmV4cG9ydHMgPSBMb2Nrc3RlcDtcblxufSkuY2FsbCh0aGlzKTtcbiJdfQ==
(4)
});
