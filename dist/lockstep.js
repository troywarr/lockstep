!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Lockstep=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
// shim for using process in browser

var process = module.exports = {};

process.nextTick = (function () {
    var canSetImmediate = typeof window !== 'undefined'
    && window.setImmediate;
    var canPost = typeof window !== 'undefined'
    && window.postMessage && window.addEventListener
    ;

    if (canSetImmediate) {
        return function (f) { return window.setImmediate(f) };
    }

    if (canPost) {
        var queue = [];
        window.addEventListener('message', function (ev) {
            var source = ev.source;
            if ((source === window || source === null) && ev.data === 'process-tick') {
                ev.stopPropagation();
                if (queue.length > 0) {
                    var fn = queue.shift();
                    fn();
                }
            }
        }, true);

        return function nextTick(fn) {
            queue.push(fn);
            window.postMessage('process-tick', '*');
        };
    }

    return function nextTick(fn) {
        setTimeout(fn, 0);
    };
})();

process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
}

// TODO(shtylman)
process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};

},{}],2:[function(_dereq_,module,exports){
(function (process){
// Generated by CoffeeScript 1.7.1
(function() {
  var getNanoSeconds, hrtime, loadTime;

  if ((typeof performance !== "undefined" && performance !== null) && performance.now) {
    module.exports = function() {
      return performance.now();
    };
  } else if ((typeof process !== "undefined" && process !== null) && process.hrtime) {
    module.exports = function() {
      return (getNanoSeconds() - loadTime) / 1e6;
    };
    hrtime = process.hrtime;
    getNanoSeconds = function() {
      var hr;
      hr = hrtime();
      return hr[0] * 1e9 + hr[1];
    };
    loadTime = getNanoSeconds();
  } else if (Date.now) {
    module.exports = function() {
      return Date.now() - loadTime;
    };
    loadTime = Date.now();
  } else {
    module.exports = function() {
      return new Date().getTime() - loadTime;
    };
    loadTime = new Date().getTime();
  }

}).call(this);

}).call(this,_dereq_("1YiZ5S"))
},{"1YiZ5S":1}],3:[function(_dereq_,module,exports){
var now = _dereq_('performance-now')
  , global = typeof window === 'undefined' ? {} : window
  , vendors = ['moz', 'webkit']
  , suffix = 'AnimationFrame'
  , raf = global['request' + suffix]
  , caf = global['cancel' + suffix] || global['cancelRequest' + suffix]
  , isNative = true

for(var i = 0; i < vendors.length && !raf; i++) {
  raf = global[vendors[i] + 'Request' + suffix]
  caf = global[vendors[i] + 'Cancel' + suffix]
      || global[vendors[i] + 'CancelRequest' + suffix]
}

// Some versions of FF have rAF but not cAF
if(!raf || !caf) {
  isNative = false

  var last = 0
    , id = 0
    , queue = []
    , frameDuration = 1000 / 60

  raf = function(callback) {
    if(queue.length === 0) {
      var _now = now()
        , next = Math.max(0, frameDuration - (_now - last))
      last = next + _now
      setTimeout(function() {
        var cp = queue.slice(0)
        // Clear queue here to prevent
        // callbacks from appending listeners
        // to the current frame's queue
        queue.length = 0
        for(var i = 0; i < cp.length; i++) {
          if(!cp[i].cancelled) {
            try{
              cp[i].callback(last)
            } catch(e) {
              setTimeout(function() { throw e }, 0)
            }
          }
        }
      }, Math.round(next))
    }
    queue.push({
      handle: ++id,
      callback: callback,
      cancelled: false
    })
    return id
  }

  caf = function(handle) {
    for(var i = 0; i < queue.length; i++) {
      if(queue[i].handle === handle) {
        queue[i].cancelled = true
      }
    }
  }
}

module.exports = function(fn) {
  // Wrap in a new function to prevent
  // `cancel` potentially being assigned
  // to the native rAF function
  if(!isNative) {
    return raf.call(global, fn)
  }
  return raf.call(global, function() {
    try{
      fn.apply(this, arguments)
    } catch(e) {
      setTimeout(function() { throw e }, 0)
    }
  })
}
module.exports.cancel = function() {
  caf.apply(global, arguments)
}

},{"performance-now":4}],4:[function(_dereq_,module,exports){
(function (process){
// Generated by CoffeeScript 1.6.3
(function() {
  var getNanoSeconds, hrtime, loadTime;

  if ((typeof performance !== "undefined" && performance !== null) && performance.now) {
    module.exports = function() {
      return performance.now();
    };
  } else if ((typeof process !== "undefined" && process !== null) && process.hrtime) {
    module.exports = function() {
      return (getNanoSeconds() - loadTime) / 1e6;
    };
    hrtime = process.hrtime;
    getNanoSeconds = function() {
      var hr;
      hr = hrtime();
      return hr[0] * 1e9 + hr[1];
    };
    loadTime = getNanoSeconds();
  } else if (Date.now) {
    module.exports = function() {
      return Date.now() - loadTime;
    };
    loadTime = Date.now();
  } else {
    module.exports = function() {
      return new Date().getTime() - loadTime;
    };
    loadTime = new Date().getTime();
  }

}).call(this);

/*
//@ sourceMappingURL=performance-now.map
*/

}).call(this,_dereq_("1YiZ5S"))
},{"1YiZ5S":1}],5:[function(_dereq_,module,exports){
(function (process){
(function() {
  var CALLBACKS, COUNTS, ERRMSG, INFO, INITIAL, Lockstep, MEASURES, MSQTY, NOOP, TIMES, now, raf,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    __hasProp = {}.hasOwnProperty,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  raf = _dereq_('raf');

  now = _dereq_('performance-now');

  MSQTY = {};

  MSQTY.microseconds = 0.001;

  MSQTY.milliseconds = MSQTY.microseconds * 1000;

  MSQTY.seconds = MSQTY.milliseconds * 1000;

  MSQTY.minutes = MSQTY.seconds * 60;

  MSQTY.hours = MSQTY.minutes * 60;

  MSQTY.days = MSQTY.hours * 24;

  MEASURES = ['microseconds', 'milliseconds', 'seconds', 'minutes', 'hours', 'days'];

  TIMES = ['elapsed', 'clock'];

  COUNTS = ['start', 'stop', 'reset'];

  INFO = ['elapsed', 'clock', 'count'];

  CALLBACKS = ['when', 'every', 'while', 'during', 'beginning', 'ending'];

  ERRMSG = {
    noArguments: 'No arguments supplied.',
    options: {
      bad: {
        oneArgument: 'Argument supplied is not a callback function or options object.',
        twoArguments: 'Arguments supplied are not a callback function followed by an options object.'
      },
      step: {
        missing: 'Options supplied are incomplete (no valid "step" function).',
        redundant: 'Options supplied are invalid (redundant "step" function).'
      },
      pad: {
        bad: 'Options supplied are invalid ("pad" option must have a false or integer value).'
      }
    },
    callback: {
      bad: 'Callback supplied is not a function.',
      missing: 'No callback supplied.'
    },
    startCallback: {
      bad: 'Start callback is not a function.',
      missing: 'No start callback supplied.'
    },
    endCallback: {
      bad: 'End callback is not a function.',
      missing: 'No end callback supplied.'
    },
    time: {
      bad: 'Time supplied is not valid.'
    },
    startTime: {
      bad: 'Start time supplied is not valid.'
    },
    endTime: {
      bad: 'End time supplied is not valid.',
      missing: 'No end time supplied.'
    },
    info: {
      bad: 'Info supplied is not valid.'
    },
    condition: {
      bad: 'Condition callback is not a function.',
      missing: 'No condition callback supplied.'
    }
  };

  NOOP = function() {};

  INITIAL = {
    meta: function() {
      return {
        called: {
          last: 0,
          count: 0
        },
        passed: {
          last: 0,
          count: 0
        },
        failed: {
          last: 0,
          count: 0
        }
      };
    },
    count: function() {
      return {
        start: 0,
        stop: 0,
        reset: 0
      };
    },
    time: function() {
      return {
        running: 0,
        stored: 0,
        last: {
          start: null,
          stop: null,
          reset: null
        }
      };
    }
  };

  Lockstep = (function() {
    function Lockstep() {
      this._loop = __bind(this._loop, this);
      var options;
      options = this._validateOptions(arguments);
      this.settings = this._buildSettings(options);
      this.running = false;
      this.microseconds = this._hasHighResolutionTime();
      this.count = INITIAL.count();
      this.time = INITIAL.time();
      this.registeredCallbacks = [];
    }

    Lockstep.prototype._merge = function(obj1, obj2) {
      var name, obj3;
      obj3 = {};
      for (name in obj1) {
        obj3[name] = obj1[name];
      }
      for (name in obj2) {
        obj3[name] = obj2[name];
      }
      return obj3;
    };

    Lockstep.prototype._pad = function(int, length) {
      int += '';
      if (int.length >= length) {
        return int;
      } else {
        return "" + (new Array(length - int.length + 1).join('0')) + int;
      }
    };

    Lockstep.prototype._type = function(value) {
      return {}.toString.call(value).match(/\s([a-zA-Z]+)/)[1].toLowerCase();
    };

    Lockstep.prototype._isInt = function(value) {
      return !isNaN(value) && parseInt(Number(value)) === value && !isNaN(parseInt(value, 10));
    };

    Lockstep.prototype._isEmpty = function(obj) {
      var key;
      for (key in obj) {
        if (!__hasProp.call(obj, key)) continue;
        return false;
      }
      return true;
    };

    Lockstep.prototype._hasHighResolutionTime = function() {
      var _ref;
      return ((typeof window !== "undefined" && window !== null ? (_ref = window.performance) != null ? _ref.now : void 0 : void 0) != null) || ((typeof process !== "undefined" && process !== null ? process.hrtime : void 0) != null);
    };

    Lockstep.prototype._isValidTime = function(time) {
      var key, key2, oneTimeType, val, val2;
      if (!this._type(time) === 'object') {
        return false;
      }
      oneTimeType = false;
      for (key in time) {
        val = time[key];
        if (oneTimeType) {
          return false;
        } else {
          oneTimeType = true;
        }
        if (!(__indexOf.call(TIMES, key) >= 0 && this._type(val) === 'object')) {
          return false;
        }
        for (key2 in val) {
          val2 = val[key2];
          if (!(__indexOf.call(MEASURES, key2) >= 0 && this._type(val2) === 'number')) {
            return false;
          }
        }
      }
      return true;
    };

    Lockstep.prototype._isValidCount = function(count) {
      var key, val;
      for (key in count) {
        val = count[key];
        if (!(__indexOf.call(COUNTS, key) >= 0 && this._isInt(val))) {
          return false;
        }
      }
      return true;
    };

    Lockstep.prototype._isValidInfo = function(info) {
      var key, time, val;
      time = {};
      for (key in info) {
        val = info[key];
        if (__indexOf.call(TIMES, key) >= 0) {
          time[key] = val;
        } else if (key === 'count') {
          if (!this._isValidCount(val)) {
            return false;
          }
        } else {
          return false;
        }
      }
      if (!this._isEmpty(time)) {
        if (!this._isValidTime(time)) {
          return false;
        }
      }
      return true;
    };

    Lockstep.prototype._validateOptions = function(args) {
      var options;
      if (args.length === 0) {
        throw new Error(ERRMSG.noArguments);
      } else if (args.length === 1) {
        if (this._type(args[0]) === 'function') {
          options = {
            step: args[0]
          };
        } else if (this._type(args[0]) === 'object') {
          if (this._type(args[0].step) === 'function') {
            options = args[0];
          } else {
            throw new Error(ERRMSG.options.step.missing);
          }
        } else {
          throw new Error(ERRMSG.options.bad.oneArgument);
        }
      } else if (args.length >= 2) {
        if (this._type(args[0]) === 'object' && this._type(args[1]) === 'function') {
          if (args[0].step != null) {
            throw new Error(ERRMSG.options.step.redundant);
          } else {
            args[0].step = args[1];
            options = args[0];
          }
        } else {
          throw new Error(ERRMSG.options.bad.twoArguments);
        }
      }
      if (options.pad != null) {
        if (!(options.pad === false || this._isInt(options.pad))) {
          throw new Error(ERRMSG.options.pad.bad);
        }
      }
      return options;
    };

    Lockstep.prototype._validateArguments = function(argArray) {
      var argInfo, errorMessageBad, errorMessageMissing, validator, value, _i, _len;
      for (_i = 0, _len = argArray.length; _i < _len; _i++) {
        argInfo = argArray[_i];
        value = argInfo[0];
        validator = argInfo[1];
        errorMessageBad = argInfo[2];
        errorMessageMissing = argInfo[3];
        if (value != null) {
          if (this._type(validator) === 'function') {
            if (!validator(value)) {
              throw new Error(errorMessageBad);
            }
          } else if (this._type(validator) === 'string') {
            switch (validator) {
              case 'time':
                if (!this._isValidTime(value)) {
                  throw new Error(errorMessageBad);
                }
                break;
              case 'info':
                if (!this._isValidInfo(value)) {
                  throw new Error(errorMessageBad);
                }
                break;
              case 'count':
                if (!this._isValidCount(value)) {
                  throw new Error(errorMessageBad);
                }
                break;
              default:
                if (this._type(value) !== validator) {
                  throw new Error(errorMessageBad);
                }
            }
          }
        } else if (errorMessageMissing != null) {
          throw new Error(errorMessageMissing);
        }
      }
    };

    Lockstep.prototype._buildSettings = function(options) {
      var defaults;
      defaults = {
        pad: false,
        floor: false
      };
      return this._merge(defaults, options);
    };

    Lockstep.prototype._fireRegisteredCallbacks = function(info) {
      var i, obj, runningTime, _i, _len, _ref, _results;
      runningTime = this.time.running;
      _ref = this.registeredCallbacks;
      _results = [];
      for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
        obj = _ref[i];
        obj.meta.called.count++;
        obj.meta.called.last = runningTime;
        if (obj.condition(info, obj.meta)) {
          obj.callback(info);
          obj.meta.passed.count++;
          _results.push(obj.meta.passed.last = runningTime);
        } else {
          obj.meta.failed.count++;
          _results.push(obj.meta.failed.last = runningTime);
        }
      }
      return _results;
    };

    Lockstep.prototype._runningTimeToElapsedTime = function(runningTime) {
      var elapsedTime, milliseconds;
      elapsedTime = {};
      if (this.microseconds) {
        elapsedTime.microseconds = runningTime / MSQTY.microseconds;
        milliseconds = runningTime;
      } else {
        milliseconds = runningTime;
      }
      elapsedTime.milliseconds = milliseconds;
      elapsedTime.seconds = milliseconds / MSQTY.seconds;
      elapsedTime.minutes = milliseconds / MSQTY.minutes;
      elapsedTime.hours = milliseconds / MSQTY.hours;
      elapsedTime.days = milliseconds / MSQTY.days;
      return elapsedTime;
    };

    Lockstep.prototype._runningTimeToClockTime = function(runningTime) {
      var clockTime, milliseconds;
      clockTime = {};
      if (this.microseconds) {
        clockTime.microseconds = Math.floor((runningTime % 1) / MSQTY.microseconds);
        milliseconds = Math.floor(runningTime);
      } else {
        milliseconds = runningTime;
      }
      clockTime.milliseconds = milliseconds % 1000;
      clockTime.seconds = Math.floor(milliseconds / MSQTY.seconds) % 60;
      clockTime.minutes = Math.floor(milliseconds / MSQTY.minutes) % 60;
      clockTime.hours = Math.floor(milliseconds / MSQTY.hours) % 24;
      clockTime.days = Math.floor(milliseconds / MSQTY.days);
      return clockTime;
    };

    Lockstep.prototype._elapsedTimeToRunningTime = function(elapsedTime) {
      var key, runningTime, val;
      runningTime = 0;
      for (key in elapsedTime) {
        val = elapsedTime[key];
        runningTime = MSQTY[key] * val;
      }
      return runningTime;
    };

    Lockstep.prototype._clockTimeToRunningTime = function(clockTime) {
      var key, runningTime, val;
      runningTime = 0;
      for (key in clockTime) {
        val = clockTime[key];
        runningTime += MSQTY[key] * val;
      }
      return runningTime;
    };

    Lockstep.prototype._toRunningTime = function(time) {
      if (time.elapsed != null) {
        return this._elapsedTimeToRunningTime(time.elapsed);
      } else if (time.clock != null) {
        return this._clockTimeToRunningTime(time.clock);
      }
    };

    Lockstep.prototype._getInfo = function() {
      var clock, elapsed, key, totalTime, val;
      totalTime = this.time.stored + this.time.running;
      elapsed = this._runningTimeToElapsedTime(totalTime);
      clock = this._runningTimeToClockTime(totalTime);
      if (this.settings.floor) {
        for (key in elapsed) {
          val = elapsed[key];
          elapsed = Math.floor(val);
        }
      }
      if (this.settings.pad) {
        for (key in clock) {
          val = clock[key];
          val = this._pad(val, this.settings.pad);
        }
      }
      return {
        time: {
          elapsed: elapsed,
          clock: clock
        },
        count: this.count
      };
    };

    Lockstep.prototype._adjustTime = function(operation, runningTime) {
      var called;
      called = now();
      this.time.last.start = called;
      this.time.running = 0;
      switch (operation) {
        case 'set':
          this.time.stored = runningTime;
          break;
        case 'add':
          this.time.stored += runningTime;
          break;
        case 'subtract':
          this.time.stored -= runningTime;
      }
      if (!this.settings.allowNegative) {
        return this.time.stored = Math.max(this.time.stored, 0);
      }
    };

    Lockstep.prototype._adjustCount = function(operation, count) {
      var key, val;
      for (key in count) {
        val = count[key];
        switch (operation) {
          case 'set':
            this.count[key] = val;
            break;
          case 'add':
            this.count[key] += val;
            break;
          case 'subtract':
            this.count[key] -= val;
        }
        if (!this.settings.allowNegative) {
          this.count[key] = Math.max(this.count[key], 0);
        }
      }
    };

    Lockstep.prototype._adjustInfo = function(operation, info) {
      if (info.elapsed != null) {
        this._adjustTime(operation, this._elapsedTimeToRunningTime(info.elapsed));
      }
      if (info.clock != null) {
        this._adjustTime(operation, this._clockTimeToRunningTime(info.clock));
      }
      if (info.count != null) {
        return this._adjustCount(operation, info.count);
      }
    };

    Lockstep.prototype._resetTime = function(called) {
      if (this.time.running > 0 || this.time.stored > 0) {
        this.count.reset++;
        this.time = INITIAL.time();
        this.time.last.reset = called;
        if (this.running) {
          this.time.last.start = called;
        }
        return true;
      }
      return false;
    };

    Lockstep.prototype._resetCount = function() {
      var key, val, _ref;
      _ref = this.count;
      for (key in _ref) {
        val = _ref[key];
        if (val > 0) {
          this.count = INITIAL.count();
          return true;
        }
      }
      return false;
    };

    Lockstep.prototype._resetMeta = function() {
      var obj, _i, _len, _ref, _results;
      _ref = this.registeredCallbacks;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        obj = _ref[_i];
        _results.push(obj.meta = INITIAL.meta());
      }
      return _results;
    };

    Lockstep.prototype._loop = function() {
      this.pulse = raf(this._loop);
      return this._step();
    };

    Lockstep.prototype._step = function(timeNow) {
      var info;
      if (timeNow == null) {
        timeNow = now();
      }
      this.time.running = timeNow - this.time.last.start;
      info = this._getInfo();
      this.settings.step(info);
      return this._fireRegisteredCallbacks(info);
    };

    Lockstep.prototype.registerCallback = function(condition, callback) {
      this._validateArguments([[condition, 'function', ERRMSG.condition.bad, ERRMSG.condition.missing], [callback, 'function', ERRMSG.callback.bad, ERRMSG.callback.missing]]);
      return this.registeredCallbacks.push({
        condition: condition,
        callback: callback,
        meta: INITIAL.meta()
      });
    };

    Lockstep.prototype.start = function(callback) {
      var called;
      if (callback == null) {
        callback = this.settings.start;
      }
      called = now();
      this._validateArguments([[callback, 'function', ERRMSG.callback.bad]]);
      if (!this.running) {
        this.count.start++;
        this.running = true;
        this.time.last.start = called;
        this._loop();
        if (typeof callback === "function") {
          callback(this._getInfo());
        }
      }
      return this;
    };

    Lockstep.prototype.stop = function(callback) {
      var called;
      if (callback == null) {
        callback = this.settings.stop;
      }
      called = now();
      this._validateArguments([[callback, 'function', ERRMSG.callback.bad]]);
      if (this.running) {
        raf.cancel(this.pulse);
        this.count.stop++;
        this.running = false;
        this.time.last.stop = called;
        this._step(called);
        this.time.stored += this.time.running;
        this.time.running = 0;
        if (typeof callback === "function") {
          callback(this._getInfo());
        }
      }
      return this;
    };

    Lockstep.prototype.reset = function(callback, count, meta) {
      var callbackEligible, called;
      if (callback == null) {
        callback = this.settings.reset;
      }
      if (count == null) {
        count = false;
      }
      if (meta == null) {
        meta = true;
      }
      called = now();
      this._validateArguments([[callback, 'function', ERRMSG.callback.bad]]);
      if (this._resetTime(called)) {
        callbackEligible = true;
      }
      if (count) {
        if (this._resetCount()) {
          callbackEligible = true;
        }
      }
      if (meta) {
        this._resetMeta();
      }
      callbackEligible && (typeof callback === "function" ? callback(this._getInfo()) : void 0);
      return this;
    };

    Lockstep.prototype.info = function(info, callback) {
      if (callback == null) {
        callback = this.settings.info;
      }
      if (info != null) {
        this._validateArguments([[info, 'info', ERRMSG.info.bad, ERRMSG.noArguments], [callback, 'function', ERRMSG.callback.bad]]);
        this._adjustInfo('set', info);
        if (typeof callback === "function") {
          callback(this._getInfo());
        }
        return this;
      } else {
        return this._getInfo();
      }
    };

    Lockstep.prototype.add = function(info, callback) {
      if (callback == null) {
        callback = this.settings.add;
      }
      this._validateArguments([[info, 'info', ERRMSG.info.bad, ERRMSG.noArguments], [callback, 'function', ERRMSG.callback.bad]]);
      this._adjustInfo('add', info);
      if (typeof callback === "function") {
        callback(this._getInfo());
      }
      return this;
    };

    Lockstep.prototype.subtract = function(info, callback) {
      if (callback == null) {
        callback = this.settings.subtract;
      }
      this._validateArguments([[info, 'info', ERRMSG.info.bad, ERRMSG.noArguments], [callback, 'function', ERRMSG.callback.bad]]);
      this._adjustInfo('subtract', info);
      if (typeof callback === "function") {
        callback(this._getInfo());
      }
      return this;
    };

    Lockstep.prototype.when = function(time, callback) {
      if (callback == null) {
        callback = this.settings.when;
      }
      this._validateArguments([[time, 'time', ERRMSG.time.bad, ERRMSG.noArguments], [callback, 'function', ERRMSG.callback.bad, ERRMSG.callback.missing]]);
      this.registerCallback((function(_this) {
        return function(info, meta) {
          return meta.passed.count === 0 && _this._elapsedTimeToRunningTime(info.time.elapsed) >= _this._toRunningTime(time);
        };
      })(this), callback);
      return this;
    };

    Lockstep.prototype.every = function(time, callback) {
      if (callback == null) {
        callback = this.settings.every;
      }
      this._validateArguments([[time, 'time', ERRMSG.time.bad, ERRMSG.noArguments], [callback, 'function', ERRMSG.callback.bad, ERRMSG.callback.missing]]);
      this.registerCallback((function(_this) {
        return function(info, meta) {
          return _this._elapsedTimeToRunningTime(info.time.elapsed) - meta.passed.last >= _this._toRunningTime(time);
        };
      })(this), callback);
      return this;
    };

    Lockstep.prototype["while"] = function(startTime, endTime, callback) {
      if (callback == null) {
        callback = this.settings["while"];
      }
      this._validateArguments([[startTime, 'time', ERRMSG.startTime.bad, ERRMSG.noArguments], [endTime, 'time', ERRMSG.endTime.bad, ERRMSG.endTime.missing], [callback, 'function', ERRMSG.callback.bad, ERRMSG.callback.missing]]);
      this.registerCallback((function(_this) {
        return function(info) {
          var _ref;
          return (_this._toRunningTime(startTime) <= (_ref = _this._elapsedTimeToRunningTime(info.time.elapsed)) && _ref <= _this._toRunningTime(endTime));
        };
      })(this), callback);
      return this;
    };

    Lockstep.prototype.during = function(startTime, endTime, startCallback, endCallback) {
      if (startCallback == null) {
        startCallback = this.settings.duringStart;
      }
      if (endCallback == null) {
        endCallback = this.settings.duringEnd;
      }
      this._validateArguments([[startTime, 'time', ERRMSG.startTime.bad, ERRMSG.noArguments], [endTime, 'time', ERRMSG.endTime.bad, ERRMSG.endTime.missing], [startCallback, 'function', ERRMSG.startCallback.bad, ERRMSG.startCallback.missing], [endCallback, 'function', ERRMSG.endCallback.bad, ERRMSG.endCallback.missing]]);
      this.when(startTime, startCallback);
      this.when(endTime, endCallback);
      return this;
    };

    Lockstep.prototype.beginning = function(startTime, startCallback) {
      if (startCallback == null) {
        startCallback = this.settings.beginning;
      }
      this._validateArguments([[startTime, 'time', ERRMSG.startTime.bad, ERRMSG.noArguments], [startCallback, 'function', ERRMSG.startCallback.bad, ERRMSG.startCallback.missing]]);
      this["while"](startTime, Infinity, startCallback);
      return this;
    };

    Lockstep.prototype.ending = function(endTime, endCallback) {
      if (endCallback == null) {
        endCallback = this.settings.ending;
      }
      this._validateArguments([[endTime, 'time', ERRMSG.time.bad, ERRMSG.noArguments], [endCallback, 'function', ERRMSG.endCallback.bad, ERRMSG.endCallback.missing]]);
      this["while"](0, endTime, endCallback);
      return this;
    };

    return Lockstep;

  })();

  module.exports = Lockstep;

}).call(this);

}).call(this,_dereq_("1YiZ5S"))
},{"1YiZ5S":1,"performance-now":2,"raf":3}]},{},[5])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL3Byb2Nlc3MvYnJvd3Nlci5qcyIsIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL25vZGVfbW9kdWxlcy9wZXJmb3JtYW5jZS1ub3cvbGliL3BlcmZvcm1hbmNlLW5vdy5qcyIsIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL25vZGVfbW9kdWxlcy9yYWYvaW5kZXguanMiLCIvVXNlcnMvdHdhcnIvY29kZS9sb2Nrc3RlcC9ub2RlX21vZHVsZXMvcmFmL25vZGVfbW9kdWxlcy9wZXJmb3JtYW5jZS1ub3cvbGliL3BlcmZvcm1hbmNlLW5vdy5qcyIsIi9Vc2Vycy90d2Fyci9jb2RlL2xvY2tzdGVwL3NyYy9mYWtlXzliZjdhYjZkLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8vIHNoaW0gZm9yIHVzaW5nIHByb2Nlc3MgaW4gYnJvd3NlclxuXG52YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307XG5cbnByb2Nlc3MubmV4dFRpY2sgPSAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBjYW5TZXRJbW1lZGlhdGUgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJ1xuICAgICYmIHdpbmRvdy5zZXRJbW1lZGlhdGU7XG4gICAgdmFyIGNhblBvc3QgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJ1xuICAgICYmIHdpbmRvdy5wb3N0TWVzc2FnZSAmJiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lclxuICAgIDtcblxuICAgIGlmIChjYW5TZXRJbW1lZGlhdGUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChmKSB7IHJldHVybiB3aW5kb3cuc2V0SW1tZWRpYXRlKGYpIH07XG4gICAgfVxuXG4gICAgaWYgKGNhblBvc3QpIHtcbiAgICAgICAgdmFyIHF1ZXVlID0gW107XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgICAgICB2YXIgc291cmNlID0gZXYuc291cmNlO1xuICAgICAgICAgICAgaWYgKChzb3VyY2UgPT09IHdpbmRvdyB8fCBzb3VyY2UgPT09IG51bGwpICYmIGV2LmRhdGEgPT09ICdwcm9jZXNzLXRpY2snKSB7XG4gICAgICAgICAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgaWYgKHF1ZXVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZuID0gcXVldWUuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAgICAgZm4oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRydWUpO1xuXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBuZXh0VGljayhmbikge1xuICAgICAgICAgICAgcXVldWUucHVzaChmbik7XG4gICAgICAgICAgICB3aW5kb3cucG9zdE1lc3NhZ2UoJ3Byb2Nlc3MtdGljaycsICcqJyk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIGZ1bmN0aW9uIG5leHRUaWNrKGZuKSB7XG4gICAgICAgIHNldFRpbWVvdXQoZm4sIDApO1xuICAgIH07XG59KSgpO1xuXG5wcm9jZXNzLnRpdGxlID0gJ2Jyb3dzZXInO1xucHJvY2Vzcy5icm93c2VyID0gdHJ1ZTtcbnByb2Nlc3MuZW52ID0ge307XG5wcm9jZXNzLmFyZ3YgPSBbXTtcblxuZnVuY3Rpb24gbm9vcCgpIHt9XG5cbnByb2Nlc3Mub24gPSBub29wO1xucHJvY2Vzcy5hZGRMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLm9uY2UgPSBub29wO1xucHJvY2Vzcy5vZmYgPSBub29wO1xucHJvY2Vzcy5yZW1vdmVMaXN0ZW5lciA9IG5vb3A7XG5wcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7XG5wcm9jZXNzLmVtaXQgPSBub29wO1xuXG5wcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5iaW5kaW5nIGlzIG5vdCBzdXBwb3J0ZWQnKTtcbn1cblxuLy8gVE9ETyhzaHR5bG1hbilcbnByb2Nlc3MuY3dkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gJy8nIH07XG5wcm9jZXNzLmNoZGlyID0gZnVuY3Rpb24gKGRpcikge1xuICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7XG59O1xuIiwiKGZ1bmN0aW9uIChwcm9jZXNzKXtcbi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbihmdW5jdGlvbigpIHtcbiAgdmFyIGdldE5hbm9TZWNvbmRzLCBocnRpbWUsIGxvYWRUaW1lO1xuXG4gIGlmICgodHlwZW9mIHBlcmZvcm1hbmNlICE9PSBcInVuZGVmaW5lZFwiICYmIHBlcmZvcm1hbmNlICE9PSBudWxsKSAmJiBwZXJmb3JtYW5jZS5ub3cpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIH07XG4gIH0gZWxzZSBpZiAoKHR5cGVvZiBwcm9jZXNzICE9PSBcInVuZGVmaW5lZFwiICYmIHByb2Nlc3MgIT09IG51bGwpICYmIHByb2Nlc3MuaHJ0aW1lKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiAoZ2V0TmFub1NlY29uZHMoKSAtIGxvYWRUaW1lKSAvIDFlNjtcbiAgICB9O1xuICAgIGhydGltZSA9IHByb2Nlc3MuaHJ0aW1lO1xuICAgIGdldE5hbm9TZWNvbmRzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgaHI7XG4gICAgICBociA9IGhydGltZSgpO1xuICAgICAgcmV0dXJuIGhyWzBdICogMWU5ICsgaHJbMV07XG4gICAgfTtcbiAgICBsb2FkVGltZSA9IGdldE5hbm9TZWNvbmRzKCk7XG4gIH0gZWxzZSBpZiAoRGF0ZS5ub3cpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIERhdGUubm93KCkgLSBsb2FkVGltZTtcbiAgICB9O1xuICAgIGxvYWRUaW1lID0gRGF0ZS5ub3coKTtcbiAgfSBlbHNlIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gbG9hZFRpbWU7XG4gICAgfTtcbiAgICBsb2FkVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICB9XG5cbn0pLmNhbGwodGhpcyk7XG5cbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiMVlpWjVTXCIpKSIsInZhciBub3cgPSByZXF1aXJlKCdwZXJmb3JtYW5jZS1ub3cnKVxuICAsIGdsb2JhbCA9IHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnID8ge30gOiB3aW5kb3dcbiAgLCB2ZW5kb3JzID0gWydtb3onLCAnd2Via2l0J11cbiAgLCBzdWZmaXggPSAnQW5pbWF0aW9uRnJhbWUnXG4gICwgcmFmID0gZ2xvYmFsWydyZXF1ZXN0JyArIHN1ZmZpeF1cbiAgLCBjYWYgPSBnbG9iYWxbJ2NhbmNlbCcgKyBzdWZmaXhdIHx8IGdsb2JhbFsnY2FuY2VsUmVxdWVzdCcgKyBzdWZmaXhdXG4gICwgaXNOYXRpdmUgPSB0cnVlXG5cbmZvcih2YXIgaSA9IDA7IGkgPCB2ZW5kb3JzLmxlbmd0aCAmJiAhcmFmOyBpKyspIHtcbiAgcmFmID0gZ2xvYmFsW3ZlbmRvcnNbaV0gKyAnUmVxdWVzdCcgKyBzdWZmaXhdXG4gIGNhZiA9IGdsb2JhbFt2ZW5kb3JzW2ldICsgJ0NhbmNlbCcgKyBzdWZmaXhdXG4gICAgICB8fCBnbG9iYWxbdmVuZG9yc1tpXSArICdDYW5jZWxSZXF1ZXN0JyArIHN1ZmZpeF1cbn1cblxuLy8gU29tZSB2ZXJzaW9ucyBvZiBGRiBoYXZlIHJBRiBidXQgbm90IGNBRlxuaWYoIXJhZiB8fCAhY2FmKSB7XG4gIGlzTmF0aXZlID0gZmFsc2VcblxuICB2YXIgbGFzdCA9IDBcbiAgICAsIGlkID0gMFxuICAgICwgcXVldWUgPSBbXVxuICAgICwgZnJhbWVEdXJhdGlvbiA9IDEwMDAgLyA2MFxuXG4gIHJhZiA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgaWYocXVldWUubGVuZ3RoID09PSAwKSB7XG4gICAgICB2YXIgX25vdyA9IG5vdygpXG4gICAgICAgICwgbmV4dCA9IE1hdGgubWF4KDAsIGZyYW1lRHVyYXRpb24gLSAoX25vdyAtIGxhc3QpKVxuICAgICAgbGFzdCA9IG5leHQgKyBfbm93XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgY3AgPSBxdWV1ZS5zbGljZSgwKVxuICAgICAgICAvLyBDbGVhciBxdWV1ZSBoZXJlIHRvIHByZXZlbnRcbiAgICAgICAgLy8gY2FsbGJhY2tzIGZyb20gYXBwZW5kaW5nIGxpc3RlbmVyc1xuICAgICAgICAvLyB0byB0aGUgY3VycmVudCBmcmFtZSdzIHF1ZXVlXG4gICAgICAgIHF1ZXVlLmxlbmd0aCA9IDBcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGNwLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYoIWNwW2ldLmNhbmNlbGxlZCkge1xuICAgICAgICAgICAgdHJ5e1xuICAgICAgICAgICAgICBjcFtpXS5jYWxsYmFjayhsYXN0KVxuICAgICAgICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IHRocm93IGUgfSwgMClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sIE1hdGgucm91bmQobmV4dCkpXG4gICAgfVxuICAgIHF1ZXVlLnB1c2goe1xuICAgICAgaGFuZGxlOiArK2lkLFxuICAgICAgY2FsbGJhY2s6IGNhbGxiYWNrLFxuICAgICAgY2FuY2VsbGVkOiBmYWxzZVxuICAgIH0pXG4gICAgcmV0dXJuIGlkXG4gIH1cblxuICBjYWYgPSBmdW5jdGlvbihoYW5kbGUpIHtcbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmKHF1ZXVlW2ldLmhhbmRsZSA9PT0gaGFuZGxlKSB7XG4gICAgICAgIHF1ZXVlW2ldLmNhbmNlbGxlZCA9IHRydWVcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihmbikge1xuICAvLyBXcmFwIGluIGEgbmV3IGZ1bmN0aW9uIHRvIHByZXZlbnRcbiAgLy8gYGNhbmNlbGAgcG90ZW50aWFsbHkgYmVpbmcgYXNzaWduZWRcbiAgLy8gdG8gdGhlIG5hdGl2ZSByQUYgZnVuY3Rpb25cbiAgaWYoIWlzTmF0aXZlKSB7XG4gICAgcmV0dXJuIHJhZi5jYWxsKGdsb2JhbCwgZm4pXG4gIH1cbiAgcmV0dXJuIHJhZi5jYWxsKGdsb2JhbCwgZnVuY3Rpb24oKSB7XG4gICAgdHJ5e1xuICAgICAgZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKVxuICAgIH0gY2F0Y2goZSkge1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsgdGhyb3cgZSB9LCAwKVxuICAgIH1cbiAgfSlcbn1cbm1vZHVsZS5leHBvcnRzLmNhbmNlbCA9IGZ1bmN0aW9uKCkge1xuICBjYWYuYXBwbHkoZ2xvYmFsLCBhcmd1bWVudHMpXG59XG4iLCIoZnVuY3Rpb24gKHByb2Nlc3Mpe1xuLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjYuM1xuKGZ1bmN0aW9uKCkge1xuICB2YXIgZ2V0TmFub1NlY29uZHMsIGhydGltZSwgbG9hZFRpbWU7XG5cbiAgaWYgKCh0eXBlb2YgcGVyZm9ybWFuY2UgIT09IFwidW5kZWZpbmVkXCIgJiYgcGVyZm9ybWFuY2UgIT09IG51bGwpICYmIHBlcmZvcm1hbmNlLm5vdykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgfTtcbiAgfSBlbHNlIGlmICgodHlwZW9mIHByb2Nlc3MgIT09IFwidW5kZWZpbmVkXCIgJiYgcHJvY2VzcyAhPT0gbnVsbCkgJiYgcHJvY2Vzcy5ocnRpbWUpIHtcbiAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIChnZXROYW5vU2Vjb25kcygpIC0gbG9hZFRpbWUpIC8gMWU2O1xuICAgIH07XG4gICAgaHJ0aW1lID0gcHJvY2Vzcy5ocnRpbWU7XG4gICAgZ2V0TmFub1NlY29uZHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBocjtcbiAgICAgIGhyID0gaHJ0aW1lKCk7XG4gICAgICByZXR1cm4gaHJbMF0gKiAxZTkgKyBoclsxXTtcbiAgICB9O1xuICAgIGxvYWRUaW1lID0gZ2V0TmFub1NlY29uZHMoKTtcbiAgfSBlbHNlIGlmIChEYXRlLm5vdykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gRGF0ZS5ub3coKSAtIGxvYWRUaW1lO1xuICAgIH07XG4gICAgbG9hZFRpbWUgPSBEYXRlLm5vdygpO1xuICB9IGVsc2Uge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCkgLSBsb2FkVGltZTtcbiAgICB9O1xuICAgIGxvYWRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gIH1cblxufSkuY2FsbCh0aGlzKTtcblxuLypcbi8vQCBzb3VyY2VNYXBwaW5nVVJMPXBlcmZvcm1hbmNlLW5vdy5tYXBcbiovXG5cbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiMVlpWjVTXCIpKSIsIihmdW5jdGlvbiAocHJvY2Vzcyl7XG4oZnVuY3Rpb24oKSB7XG4gIHZhciBDQUxMQkFDS1MsIENPVU5UUywgRVJSTVNHLCBJTkZPLCBJTklUSUFMLCBMb2Nrc3RlcCwgTUVBU1VSRVMsIE1TUVRZLCBOT09QLCBUSU1FUywgbm93LCByYWYsXG4gICAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgICBfX2luZGV4T2YgPSBbXS5pbmRleE9mIHx8IGZ1bmN0aW9uKGl0ZW0pIHsgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLmxlbmd0aDsgaSA8IGw7IGkrKykgeyBpZiAoaSBpbiB0aGlzICYmIHRoaXNbaV0gPT09IGl0ZW0pIHJldHVybiBpOyB9IHJldHVybiAtMTsgfTtcblxuICByYWYgPSByZXF1aXJlKCdyYWYnKTtcblxuICBub3cgPSByZXF1aXJlKCdwZXJmb3JtYW5jZS1ub3cnKTtcblxuICBNU1FUWSA9IHt9O1xuXG4gIE1TUVRZLm1pY3Jvc2Vjb25kcyA9IDAuMDAxO1xuXG4gIE1TUVRZLm1pbGxpc2Vjb25kcyA9IE1TUVRZLm1pY3Jvc2Vjb25kcyAqIDEwMDA7XG5cbiAgTVNRVFkuc2Vjb25kcyA9IE1TUVRZLm1pbGxpc2Vjb25kcyAqIDEwMDA7XG5cbiAgTVNRVFkubWludXRlcyA9IE1TUVRZLnNlY29uZHMgKiA2MDtcblxuICBNU1FUWS5ob3VycyA9IE1TUVRZLm1pbnV0ZXMgKiA2MDtcblxuICBNU1FUWS5kYXlzID0gTVNRVFkuaG91cnMgKiAyNDtcblxuICBNRUFTVVJFUyA9IFsnbWljcm9zZWNvbmRzJywgJ21pbGxpc2Vjb25kcycsICdzZWNvbmRzJywgJ21pbnV0ZXMnLCAnaG91cnMnLCAnZGF5cyddO1xuXG4gIFRJTUVTID0gWydlbGFwc2VkJywgJ2Nsb2NrJ107XG5cbiAgQ09VTlRTID0gWydzdGFydCcsICdzdG9wJywgJ3Jlc2V0J107XG5cbiAgSU5GTyA9IFsnZWxhcHNlZCcsICdjbG9jaycsICdjb3VudCddO1xuXG4gIENBTExCQUNLUyA9IFsnd2hlbicsICdldmVyeScsICd3aGlsZScsICdkdXJpbmcnLCAnYmVnaW5uaW5nJywgJ2VuZGluZyddO1xuXG4gIEVSUk1TRyA9IHtcbiAgICBub0FyZ3VtZW50czogJ05vIGFyZ3VtZW50cyBzdXBwbGllZC4nLFxuICAgIG9wdGlvbnM6IHtcbiAgICAgIGJhZDoge1xuICAgICAgICBvbmVBcmd1bWVudDogJ0FyZ3VtZW50IHN1cHBsaWVkIGlzIG5vdCBhIGNhbGxiYWNrIGZ1bmN0aW9uIG9yIG9wdGlvbnMgb2JqZWN0LicsXG4gICAgICAgIHR3b0FyZ3VtZW50czogJ0FyZ3VtZW50cyBzdXBwbGllZCBhcmUgbm90IGEgY2FsbGJhY2sgZnVuY3Rpb24gZm9sbG93ZWQgYnkgYW4gb3B0aW9ucyBvYmplY3QuJ1xuICAgICAgfSxcbiAgICAgIHN0ZXA6IHtcbiAgICAgICAgbWlzc2luZzogJ09wdGlvbnMgc3VwcGxpZWQgYXJlIGluY29tcGxldGUgKG5vIHZhbGlkIFwic3RlcFwiIGZ1bmN0aW9uKS4nLFxuICAgICAgICByZWR1bmRhbnQ6ICdPcHRpb25zIHN1cHBsaWVkIGFyZSBpbnZhbGlkIChyZWR1bmRhbnQgXCJzdGVwXCIgZnVuY3Rpb24pLidcbiAgICAgIH0sXG4gICAgICBwYWQ6IHtcbiAgICAgICAgYmFkOiAnT3B0aW9ucyBzdXBwbGllZCBhcmUgaW52YWxpZCAoXCJwYWRcIiBvcHRpb24gbXVzdCBoYXZlIGEgZmFsc2Ugb3IgaW50ZWdlciB2YWx1ZSkuJ1xuICAgICAgfVxuICAgIH0sXG4gICAgY2FsbGJhY2s6IHtcbiAgICAgIGJhZDogJ0NhbGxiYWNrIHN1cHBsaWVkIGlzIG5vdCBhIGZ1bmN0aW9uLicsXG4gICAgICBtaXNzaW5nOiAnTm8gY2FsbGJhY2sgc3VwcGxpZWQuJ1xuICAgIH0sXG4gICAgc3RhcnRDYWxsYmFjazoge1xuICAgICAgYmFkOiAnU3RhcnQgY2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24uJyxcbiAgICAgIG1pc3Npbmc6ICdObyBzdGFydCBjYWxsYmFjayBzdXBwbGllZC4nXG4gICAgfSxcbiAgICBlbmRDYWxsYmFjazoge1xuICAgICAgYmFkOiAnRW5kIGNhbGxiYWNrIGlzIG5vdCBhIGZ1bmN0aW9uLicsXG4gICAgICBtaXNzaW5nOiAnTm8gZW5kIGNhbGxiYWNrIHN1cHBsaWVkLidcbiAgICB9LFxuICAgIHRpbWU6IHtcbiAgICAgIGJhZDogJ1RpbWUgc3VwcGxpZWQgaXMgbm90IHZhbGlkLidcbiAgICB9LFxuICAgIHN0YXJ0VGltZToge1xuICAgICAgYmFkOiAnU3RhcnQgdGltZSBzdXBwbGllZCBpcyBub3QgdmFsaWQuJ1xuICAgIH0sXG4gICAgZW5kVGltZToge1xuICAgICAgYmFkOiAnRW5kIHRpbWUgc3VwcGxpZWQgaXMgbm90IHZhbGlkLicsXG4gICAgICBtaXNzaW5nOiAnTm8gZW5kIHRpbWUgc3VwcGxpZWQuJ1xuICAgIH0sXG4gICAgaW5mbzoge1xuICAgICAgYmFkOiAnSW5mbyBzdXBwbGllZCBpcyBub3QgdmFsaWQuJ1xuICAgIH0sXG4gICAgY29uZGl0aW9uOiB7XG4gICAgICBiYWQ6ICdDb25kaXRpb24gY2FsbGJhY2sgaXMgbm90IGEgZnVuY3Rpb24uJyxcbiAgICAgIG1pc3Npbmc6ICdObyBjb25kaXRpb24gY2FsbGJhY2sgc3VwcGxpZWQuJ1xuICAgIH1cbiAgfTtcblxuICBOT09QID0gZnVuY3Rpb24oKSB7fTtcblxuICBJTklUSUFMID0ge1xuICAgIG1ldGE6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2FsbGVkOiB7XG4gICAgICAgICAgbGFzdDogMCxcbiAgICAgICAgICBjb3VudDogMFxuICAgICAgICB9LFxuICAgICAgICBwYXNzZWQ6IHtcbiAgICAgICAgICBsYXN0OiAwLFxuICAgICAgICAgIGNvdW50OiAwXG4gICAgICAgIH0sXG4gICAgICAgIGZhaWxlZDoge1xuICAgICAgICAgIGxhc3Q6IDAsXG4gICAgICAgICAgY291bnQ6IDBcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9LFxuICAgIGNvdW50OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXJ0OiAwLFxuICAgICAgICBzdG9wOiAwLFxuICAgICAgICByZXNldDogMFxuICAgICAgfTtcbiAgICB9LFxuICAgIHRpbWU6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcnVubmluZzogMCxcbiAgICAgICAgc3RvcmVkOiAwLFxuICAgICAgICBsYXN0OiB7XG4gICAgICAgICAgc3RhcnQ6IG51bGwsXG4gICAgICAgICAgc3RvcDogbnVsbCxcbiAgICAgICAgICByZXNldDogbnVsbFxuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgfTtcblxuICBMb2Nrc3RlcCA9IChmdW5jdGlvbigpIHtcbiAgICBmdW5jdGlvbiBMb2Nrc3RlcCgpIHtcbiAgICAgIHRoaXMuX2xvb3AgPSBfX2JpbmQodGhpcy5fbG9vcCwgdGhpcyk7XG4gICAgICB2YXIgb3B0aW9ucztcbiAgICAgIG9wdGlvbnMgPSB0aGlzLl92YWxpZGF0ZU9wdGlvbnMoYXJndW1lbnRzKTtcbiAgICAgIHRoaXMuc2V0dGluZ3MgPSB0aGlzLl9idWlsZFNldHRpbmdzKG9wdGlvbnMpO1xuICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7XG4gICAgICB0aGlzLm1pY3Jvc2Vjb25kcyA9IHRoaXMuX2hhc0hpZ2hSZXNvbHV0aW9uVGltZSgpO1xuICAgICAgdGhpcy5jb3VudCA9IElOSVRJQUwuY291bnQoKTtcbiAgICAgIHRoaXMudGltZSA9IElOSVRJQUwudGltZSgpO1xuICAgICAgdGhpcy5yZWdpc3RlcmVkQ2FsbGJhY2tzID0gW107XG4gICAgfVxuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9tZXJnZSA9IGZ1bmN0aW9uKG9iajEsIG9iajIpIHtcbiAgICAgIHZhciBuYW1lLCBvYmozO1xuICAgICAgb2JqMyA9IHt9O1xuICAgICAgZm9yIChuYW1lIGluIG9iajEpIHtcbiAgICAgICAgb2JqM1tuYW1lXSA9IG9iajFbbmFtZV07XG4gICAgICB9XG4gICAgICBmb3IgKG5hbWUgaW4gb2JqMikge1xuICAgICAgICBvYmozW25hbWVdID0gb2JqMltuYW1lXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvYmozO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX3BhZCA9IGZ1bmN0aW9uKGludCwgbGVuZ3RoKSB7XG4gICAgICBpbnQgKz0gJyc7XG4gICAgICBpZiAoaW50Lmxlbmd0aCA+PSBsZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGludDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBcIlwiICsgKG5ldyBBcnJheShsZW5ndGggLSBpbnQubGVuZ3RoICsgMSkuam9pbignMCcpKSArIGludDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl90eXBlID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIHJldHVybiB7fS50b1N0cmluZy5jYWxsKHZhbHVlKS5tYXRjaCgvXFxzKFthLXpBLVpdKykvKVsxXS50b0xvd2VyQ2FzZSgpO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX2lzSW50ID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIHJldHVybiAhaXNOYU4odmFsdWUpICYmIHBhcnNlSW50KE51bWJlcih2YWx1ZSkpID09PSB2YWx1ZSAmJiAhaXNOYU4ocGFyc2VJbnQodmFsdWUsIDEwKSk7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5faXNFbXB0eSA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgdmFyIGtleTtcbiAgICAgIGZvciAoa2V5IGluIG9iaikge1xuICAgICAgICBpZiAoIV9faGFzUHJvcC5jYWxsKG9iaiwga2V5KSkgY29udGludWU7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX2hhc0hpZ2hSZXNvbHV0aW9uVGltZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIF9yZWY7XG4gICAgICByZXR1cm4gKCh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiICYmIHdpbmRvdyAhPT0gbnVsbCA/IChfcmVmID0gd2luZG93LnBlcmZvcm1hbmNlKSAhPSBudWxsID8gX3JlZi5ub3cgOiB2b2lkIDAgOiB2b2lkIDApICE9IG51bGwpIHx8ICgodHlwZW9mIHByb2Nlc3MgIT09IFwidW5kZWZpbmVkXCIgJiYgcHJvY2VzcyAhPT0gbnVsbCA/IHByb2Nlc3MuaHJ0aW1lIDogdm9pZCAwKSAhPSBudWxsKTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9pc1ZhbGlkVGltZSA9IGZ1bmN0aW9uKHRpbWUpIHtcbiAgICAgIHZhciBrZXksIGtleTIsIG9uZVRpbWVUeXBlLCB2YWwsIHZhbDI7XG4gICAgICBpZiAoIXRoaXMuX3R5cGUodGltZSkgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIG9uZVRpbWVUeXBlID0gZmFsc2U7XG4gICAgICBmb3IgKGtleSBpbiB0aW1lKSB7XG4gICAgICAgIHZhbCA9IHRpbWVba2V5XTtcbiAgICAgICAgaWYgKG9uZVRpbWVUeXBlKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9uZVRpbWVUeXBlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIShfX2luZGV4T2YuY2FsbChUSU1FUywga2V5KSA+PSAwICYmIHRoaXMuX3R5cGUodmFsKSA9PT0gJ29iamVjdCcpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoa2V5MiBpbiB2YWwpIHtcbiAgICAgICAgICB2YWwyID0gdmFsW2tleTJdO1xuICAgICAgICAgIGlmICghKF9faW5kZXhPZi5jYWxsKE1FQVNVUkVTLCBrZXkyKSA+PSAwICYmIHRoaXMuX3R5cGUodmFsMikgPT09ICdudW1iZXInKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5faXNWYWxpZENvdW50ID0gZnVuY3Rpb24oY291bnQpIHtcbiAgICAgIHZhciBrZXksIHZhbDtcbiAgICAgIGZvciAoa2V5IGluIGNvdW50KSB7XG4gICAgICAgIHZhbCA9IGNvdW50W2tleV07XG4gICAgICAgIGlmICghKF9faW5kZXhPZi5jYWxsKENPVU5UUywga2V5KSA+PSAwICYmIHRoaXMuX2lzSW50KHZhbCkpKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9pc1ZhbGlkSW5mbyA9IGZ1bmN0aW9uKGluZm8pIHtcbiAgICAgIHZhciBrZXksIHRpbWUsIHZhbDtcbiAgICAgIHRpbWUgPSB7fTtcbiAgICAgIGZvciAoa2V5IGluIGluZm8pIHtcbiAgICAgICAgdmFsID0gaW5mb1trZXldO1xuICAgICAgICBpZiAoX19pbmRleE9mLmNhbGwoVElNRVMsIGtleSkgPj0gMCkge1xuICAgICAgICAgIHRpbWVba2V5XSA9IHZhbDtcbiAgICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdjb3VudCcpIHtcbiAgICAgICAgICBpZiAoIXRoaXMuX2lzVmFsaWRDb3VudCh2YWwpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCF0aGlzLl9pc0VtcHR5KHRpbWUpKSB7XG4gICAgICAgIGlmICghdGhpcy5faXNWYWxpZFRpbWUodGltZSkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX3ZhbGlkYXRlT3B0aW9ucyA9IGZ1bmN0aW9uKGFyZ3MpIHtcbiAgICAgIHZhciBvcHRpb25zO1xuICAgICAgaWYgKGFyZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihFUlJNU0cubm9Bcmd1bWVudHMpO1xuICAgICAgfSBlbHNlIGlmIChhcmdzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBpZiAodGhpcy5fdHlwZShhcmdzWzBdKSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICBzdGVwOiBhcmdzWzBdXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLl90eXBlKGFyZ3NbMF0pID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgIGlmICh0aGlzLl90eXBlKGFyZ3NbMF0uc3RlcCkgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9wdGlvbnMgPSBhcmdzWzBdO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoRVJSTVNHLm9wdGlvbnMuc3RlcC5taXNzaW5nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKEVSUk1TRy5vcHRpb25zLmJhZC5vbmVBcmd1bWVudCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPj0gMikge1xuICAgICAgICBpZiAodGhpcy5fdHlwZShhcmdzWzBdKSA9PT0gJ29iamVjdCcgJiYgdGhpcy5fdHlwZShhcmdzWzFdKSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGlmIChhcmdzWzBdLnN0ZXAgIT0gbnVsbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKEVSUk1TRy5vcHRpb25zLnN0ZXAucmVkdW5kYW50KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXJnc1swXS5zdGVwID0gYXJnc1sxXTtcbiAgICAgICAgICAgIG9wdGlvbnMgPSBhcmdzWzBdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoRVJSTVNHLm9wdGlvbnMuYmFkLnR3b0FyZ3VtZW50cyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLnBhZCAhPSBudWxsKSB7XG4gICAgICAgIGlmICghKG9wdGlvbnMucGFkID09PSBmYWxzZSB8fCB0aGlzLl9pc0ludChvcHRpb25zLnBhZCkpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKEVSUk1TRy5vcHRpb25zLnBhZC5iYWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gb3B0aW9ucztcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl92YWxpZGF0ZUFyZ3VtZW50cyA9IGZ1bmN0aW9uKGFyZ0FycmF5KSB7XG4gICAgICB2YXIgYXJnSW5mbywgZXJyb3JNZXNzYWdlQmFkLCBlcnJvck1lc3NhZ2VNaXNzaW5nLCB2YWxpZGF0b3IsIHZhbHVlLCBfaSwgX2xlbjtcbiAgICAgIGZvciAoX2kgPSAwLCBfbGVuID0gYXJnQXJyYXkubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgYXJnSW5mbyA9IGFyZ0FycmF5W19pXTtcbiAgICAgICAgdmFsdWUgPSBhcmdJbmZvWzBdO1xuICAgICAgICB2YWxpZGF0b3IgPSBhcmdJbmZvWzFdO1xuICAgICAgICBlcnJvck1lc3NhZ2VCYWQgPSBhcmdJbmZvWzJdO1xuICAgICAgICBlcnJvck1lc3NhZ2VNaXNzaW5nID0gYXJnSW5mb1szXTtcbiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgICBpZiAodGhpcy5fdHlwZSh2YWxpZGF0b3IpID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBpZiAoIXZhbGlkYXRvcih2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZUJhZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmICh0aGlzLl90eXBlKHZhbGlkYXRvcikgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHZhbGlkYXRvcikge1xuICAgICAgICAgICAgICBjYXNlICd0aW1lJzpcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzVmFsaWRUaW1lKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZUJhZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdpbmZvJzpcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX2lzVmFsaWRJbmZvKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZUJhZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdjb3VudCc6XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc1ZhbGlkQ291bnQodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNZXNzYWdlQmFkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3R5cGUodmFsdWUpICE9PSB2YWxpZGF0b3IpIHtcbiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2VCYWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZXJyb3JNZXNzYWdlTWlzc2luZyAhPSBudWxsKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTWVzc2FnZU1pc3NpbmcpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5fYnVpbGRTZXR0aW5ncyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIHZhciBkZWZhdWx0cztcbiAgICAgIGRlZmF1bHRzID0ge1xuICAgICAgICBwYWQ6IGZhbHNlLFxuICAgICAgICBmbG9vcjogZmFsc2VcbiAgICAgIH07XG4gICAgICByZXR1cm4gdGhpcy5fbWVyZ2UoZGVmYXVsdHMsIG9wdGlvbnMpO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX2ZpcmVSZWdpc3RlcmVkQ2FsbGJhY2tzID0gZnVuY3Rpb24oaW5mbykge1xuICAgICAgdmFyIGksIG9iaiwgcnVubmluZ1RpbWUsIF9pLCBfbGVuLCBfcmVmLCBfcmVzdWx0cztcbiAgICAgIHJ1bm5pbmdUaW1lID0gdGhpcy50aW1lLnJ1bm5pbmc7XG4gICAgICBfcmVmID0gdGhpcy5yZWdpc3RlcmVkQ2FsbGJhY2tzO1xuICAgICAgX3Jlc3VsdHMgPSBbXTtcbiAgICAgIGZvciAoaSA9IF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IGkgPSArK19pKSB7XG4gICAgICAgIG9iaiA9IF9yZWZbaV07XG4gICAgICAgIG9iai5tZXRhLmNhbGxlZC5jb3VudCsrO1xuICAgICAgICBvYmoubWV0YS5jYWxsZWQubGFzdCA9IHJ1bm5pbmdUaW1lO1xuICAgICAgICBpZiAob2JqLmNvbmRpdGlvbihpbmZvLCBvYmoubWV0YSkpIHtcbiAgICAgICAgICBvYmouY2FsbGJhY2soaW5mbyk7XG4gICAgICAgICAgb2JqLm1ldGEucGFzc2VkLmNvdW50Kys7XG4gICAgICAgICAgX3Jlc3VsdHMucHVzaChvYmoubWV0YS5wYXNzZWQubGFzdCA9IHJ1bm5pbmdUaW1lKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvYmoubWV0YS5mYWlsZWQuY291bnQrKztcbiAgICAgICAgICBfcmVzdWx0cy5wdXNoKG9iai5tZXRhLmZhaWxlZC5sYXN0ID0gcnVubmluZ1RpbWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5fcnVubmluZ1RpbWVUb0VsYXBzZWRUaW1lID0gZnVuY3Rpb24ocnVubmluZ1RpbWUpIHtcbiAgICAgIHZhciBlbGFwc2VkVGltZSwgbWlsbGlzZWNvbmRzO1xuICAgICAgZWxhcHNlZFRpbWUgPSB7fTtcbiAgICAgIGlmICh0aGlzLm1pY3Jvc2Vjb25kcykge1xuICAgICAgICBlbGFwc2VkVGltZS5taWNyb3NlY29uZHMgPSBydW5uaW5nVGltZSAvIE1TUVRZLm1pY3Jvc2Vjb25kcztcbiAgICAgICAgbWlsbGlzZWNvbmRzID0gcnVubmluZ1RpbWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtaWxsaXNlY29uZHMgPSBydW5uaW5nVGltZTtcbiAgICAgIH1cbiAgICAgIGVsYXBzZWRUaW1lLm1pbGxpc2Vjb25kcyA9IG1pbGxpc2Vjb25kcztcbiAgICAgIGVsYXBzZWRUaW1lLnNlY29uZHMgPSBtaWxsaXNlY29uZHMgLyBNU1FUWS5zZWNvbmRzO1xuICAgICAgZWxhcHNlZFRpbWUubWludXRlcyA9IG1pbGxpc2Vjb25kcyAvIE1TUVRZLm1pbnV0ZXM7XG4gICAgICBlbGFwc2VkVGltZS5ob3VycyA9IG1pbGxpc2Vjb25kcyAvIE1TUVRZLmhvdXJzO1xuICAgICAgZWxhcHNlZFRpbWUuZGF5cyA9IG1pbGxpc2Vjb25kcyAvIE1TUVRZLmRheXM7XG4gICAgICByZXR1cm4gZWxhcHNlZFRpbWU7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5fcnVubmluZ1RpbWVUb0Nsb2NrVGltZSA9IGZ1bmN0aW9uKHJ1bm5pbmdUaW1lKSB7XG4gICAgICB2YXIgY2xvY2tUaW1lLCBtaWxsaXNlY29uZHM7XG4gICAgICBjbG9ja1RpbWUgPSB7fTtcbiAgICAgIGlmICh0aGlzLm1pY3Jvc2Vjb25kcykge1xuICAgICAgICBjbG9ja1RpbWUubWljcm9zZWNvbmRzID0gTWF0aC5mbG9vcigocnVubmluZ1RpbWUgJSAxKSAvIE1TUVRZLm1pY3Jvc2Vjb25kcyk7XG4gICAgICAgIG1pbGxpc2Vjb25kcyA9IE1hdGguZmxvb3IocnVubmluZ1RpbWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWlsbGlzZWNvbmRzID0gcnVubmluZ1RpbWU7XG4gICAgICB9XG4gICAgICBjbG9ja1RpbWUubWlsbGlzZWNvbmRzID0gbWlsbGlzZWNvbmRzICUgMTAwMDtcbiAgICAgIGNsb2NrVGltZS5zZWNvbmRzID0gTWF0aC5mbG9vcihtaWxsaXNlY29uZHMgLyBNU1FUWS5zZWNvbmRzKSAlIDYwO1xuICAgICAgY2xvY2tUaW1lLm1pbnV0ZXMgPSBNYXRoLmZsb29yKG1pbGxpc2Vjb25kcyAvIE1TUVRZLm1pbnV0ZXMpICUgNjA7XG4gICAgICBjbG9ja1RpbWUuaG91cnMgPSBNYXRoLmZsb29yKG1pbGxpc2Vjb25kcyAvIE1TUVRZLmhvdXJzKSAlIDI0O1xuICAgICAgY2xvY2tUaW1lLmRheXMgPSBNYXRoLmZsb29yKG1pbGxpc2Vjb25kcyAvIE1TUVRZLmRheXMpO1xuICAgICAgcmV0dXJuIGNsb2NrVGltZTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9lbGFwc2VkVGltZVRvUnVubmluZ1RpbWUgPSBmdW5jdGlvbihlbGFwc2VkVGltZSkge1xuICAgICAgdmFyIGtleSwgcnVubmluZ1RpbWUsIHZhbDtcbiAgICAgIHJ1bm5pbmdUaW1lID0gMDtcbiAgICAgIGZvciAoa2V5IGluIGVsYXBzZWRUaW1lKSB7XG4gICAgICAgIHZhbCA9IGVsYXBzZWRUaW1lW2tleV07XG4gICAgICAgIHJ1bm5pbmdUaW1lID0gTVNRVFlba2V5XSAqIHZhbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBydW5uaW5nVGltZTtcbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLl9jbG9ja1RpbWVUb1J1bm5pbmdUaW1lID0gZnVuY3Rpb24oY2xvY2tUaW1lKSB7XG4gICAgICB2YXIga2V5LCBydW5uaW5nVGltZSwgdmFsO1xuICAgICAgcnVubmluZ1RpbWUgPSAwO1xuICAgICAgZm9yIChrZXkgaW4gY2xvY2tUaW1lKSB7XG4gICAgICAgIHZhbCA9IGNsb2NrVGltZVtrZXldO1xuICAgICAgICBydW5uaW5nVGltZSArPSBNU1FUWVtrZXldICogdmFsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJ1bm5pbmdUaW1lO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX3RvUnVubmluZ1RpbWUgPSBmdW5jdGlvbih0aW1lKSB7XG4gICAgICBpZiAodGltZS5lbGFwc2VkICE9IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2VsYXBzZWRUaW1lVG9SdW5uaW5nVGltZSh0aW1lLmVsYXBzZWQpO1xuICAgICAgfSBlbHNlIGlmICh0aW1lLmNsb2NrICE9IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Nsb2NrVGltZVRvUnVubmluZ1RpbWUodGltZS5jbG9jayk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5fZ2V0SW5mbyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGNsb2NrLCBlbGFwc2VkLCBrZXksIHRvdGFsVGltZSwgdmFsO1xuICAgICAgdG90YWxUaW1lID0gdGhpcy50aW1lLnN0b3JlZCArIHRoaXMudGltZS5ydW5uaW5nO1xuICAgICAgZWxhcHNlZCA9IHRoaXMuX3J1bm5pbmdUaW1lVG9FbGFwc2VkVGltZSh0b3RhbFRpbWUpO1xuICAgICAgY2xvY2sgPSB0aGlzLl9ydW5uaW5nVGltZVRvQ2xvY2tUaW1lKHRvdGFsVGltZSk7XG4gICAgICBpZiAodGhpcy5zZXR0aW5ncy5mbG9vcikge1xuICAgICAgICBmb3IgKGtleSBpbiBlbGFwc2VkKSB7XG4gICAgICAgICAgdmFsID0gZWxhcHNlZFtrZXldO1xuICAgICAgICAgIGVsYXBzZWQgPSBNYXRoLmZsb29yKHZhbCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnNldHRpbmdzLnBhZCkge1xuICAgICAgICBmb3IgKGtleSBpbiBjbG9jaykge1xuICAgICAgICAgIHZhbCA9IGNsb2NrW2tleV07XG4gICAgICAgICAgdmFsID0gdGhpcy5fcGFkKHZhbCwgdGhpcy5zZXR0aW5ncy5wYWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aW1lOiB7XG4gICAgICAgICAgZWxhcHNlZDogZWxhcHNlZCxcbiAgICAgICAgICBjbG9jazogY2xvY2tcbiAgICAgICAgfSxcbiAgICAgICAgY291bnQ6IHRoaXMuY291bnRcbiAgICAgIH07XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5fYWRqdXN0VGltZSA9IGZ1bmN0aW9uKG9wZXJhdGlvbiwgcnVubmluZ1RpbWUpIHtcbiAgICAgIHZhciBjYWxsZWQ7XG4gICAgICBjYWxsZWQgPSBub3coKTtcbiAgICAgIHRoaXMudGltZS5sYXN0LnN0YXJ0ID0gY2FsbGVkO1xuICAgICAgdGhpcy50aW1lLnJ1bm5pbmcgPSAwO1xuICAgICAgc3dpdGNoIChvcGVyYXRpb24pIHtcbiAgICAgICAgY2FzZSAnc2V0JzpcbiAgICAgICAgICB0aGlzLnRpbWUuc3RvcmVkID0gcnVubmluZ1RpbWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2FkZCc6XG4gICAgICAgICAgdGhpcy50aW1lLnN0b3JlZCArPSBydW5uaW5nVGltZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnc3VidHJhY3QnOlxuICAgICAgICAgIHRoaXMudGltZS5zdG9yZWQgLT0gcnVubmluZ1RpbWU7XG4gICAgICB9XG4gICAgICBpZiAoIXRoaXMuc2V0dGluZ3MuYWxsb3dOZWdhdGl2ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy50aW1lLnN0b3JlZCA9IE1hdGgubWF4KHRoaXMudGltZS5zdG9yZWQsIDApO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX2FkanVzdENvdW50ID0gZnVuY3Rpb24ob3BlcmF0aW9uLCBjb3VudCkge1xuICAgICAgdmFyIGtleSwgdmFsO1xuICAgICAgZm9yIChrZXkgaW4gY291bnQpIHtcbiAgICAgICAgdmFsID0gY291bnRba2V5XTtcbiAgICAgICAgc3dpdGNoIChvcGVyYXRpb24pIHtcbiAgICAgICAgICBjYXNlICdzZXQnOlxuICAgICAgICAgICAgdGhpcy5jb3VudFtrZXldID0gdmFsO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAnYWRkJzpcbiAgICAgICAgICAgIHRoaXMuY291bnRba2V5XSArPSB2YWw7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdzdWJ0cmFjdCc6XG4gICAgICAgICAgICB0aGlzLmNvdW50W2tleV0gLT0gdmFsO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5zZXR0aW5ncy5hbGxvd05lZ2F0aXZlKSB7XG4gICAgICAgICAgdGhpcy5jb3VudFtrZXldID0gTWF0aC5tYXgodGhpcy5jb3VudFtrZXldLCAwKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX2FkanVzdEluZm8gPSBmdW5jdGlvbihvcGVyYXRpb24sIGluZm8pIHtcbiAgICAgIGlmIChpbmZvLmVsYXBzZWQgIT0gbnVsbCkge1xuICAgICAgICB0aGlzLl9hZGp1c3RUaW1lKG9wZXJhdGlvbiwgdGhpcy5fZWxhcHNlZFRpbWVUb1J1bm5pbmdUaW1lKGluZm8uZWxhcHNlZCkpO1xuICAgICAgfVxuICAgICAgaWYgKGluZm8uY2xvY2sgIT0gbnVsbCkge1xuICAgICAgICB0aGlzLl9hZGp1c3RUaW1lKG9wZXJhdGlvbiwgdGhpcy5fY2xvY2tUaW1lVG9SdW5uaW5nVGltZShpbmZvLmNsb2NrKSk7XG4gICAgICB9XG4gICAgICBpZiAoaW5mby5jb3VudCAhPSBudWxsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hZGp1c3RDb3VudChvcGVyYXRpb24sIGluZm8uY291bnQpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX3Jlc2V0VGltZSA9IGZ1bmN0aW9uKGNhbGxlZCkge1xuICAgICAgaWYgKHRoaXMudGltZS5ydW5uaW5nID4gMCB8fCB0aGlzLnRpbWUuc3RvcmVkID4gMCkge1xuICAgICAgICB0aGlzLmNvdW50LnJlc2V0Kys7XG4gICAgICAgIHRoaXMudGltZSA9IElOSVRJQUwudGltZSgpO1xuICAgICAgICB0aGlzLnRpbWUubGFzdC5yZXNldCA9IGNhbGxlZDtcbiAgICAgICAgaWYgKHRoaXMucnVubmluZykge1xuICAgICAgICAgIHRoaXMudGltZS5sYXN0LnN0YXJ0ID0gY2FsbGVkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX3Jlc2V0Q291bnQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBrZXksIHZhbCwgX3JlZjtcbiAgICAgIF9yZWYgPSB0aGlzLmNvdW50O1xuICAgICAgZm9yIChrZXkgaW4gX3JlZikge1xuICAgICAgICB2YWwgPSBfcmVmW2tleV07XG4gICAgICAgIGlmICh2YWwgPiAwKSB7XG4gICAgICAgICAgdGhpcy5jb3VudCA9IElOSVRJQUwuY291bnQoKTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuX3Jlc2V0TWV0YSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG9iaiwgX2ksIF9sZW4sIF9yZWYsIF9yZXN1bHRzO1xuICAgICAgX3JlZiA9IHRoaXMucmVnaXN0ZXJlZENhbGxiYWNrcztcbiAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICBmb3IgKF9pID0gMCwgX2xlbiA9IF9yZWYubGVuZ3RoOyBfaSA8IF9sZW47IF9pKyspIHtcbiAgICAgICAgb2JqID0gX3JlZltfaV07XG4gICAgICAgIF9yZXN1bHRzLnB1c2gob2JqLm1ldGEgPSBJTklUSUFMLm1ldGEoKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5fbG9vcCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5wdWxzZSA9IHJhZih0aGlzLl9sb29wKTtcbiAgICAgIHJldHVybiB0aGlzLl9zdGVwKCk7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5fc3RlcCA9IGZ1bmN0aW9uKHRpbWVOb3cpIHtcbiAgICAgIHZhciBpbmZvO1xuICAgICAgaWYgKHRpbWVOb3cgPT0gbnVsbCkge1xuICAgICAgICB0aW1lTm93ID0gbm93KCk7XG4gICAgICB9XG4gICAgICB0aGlzLnRpbWUucnVubmluZyA9IHRpbWVOb3cgLSB0aGlzLnRpbWUubGFzdC5zdGFydDtcbiAgICAgIGluZm8gPSB0aGlzLl9nZXRJbmZvKCk7XG4gICAgICB0aGlzLnNldHRpbmdzLnN0ZXAoaW5mbyk7XG4gICAgICByZXR1cm4gdGhpcy5fZmlyZVJlZ2lzdGVyZWRDYWxsYmFja3MoaW5mbyk7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5yZWdpc3RlckNhbGxiYWNrID0gZnVuY3Rpb24oY29uZGl0aW9uLCBjYWxsYmFjaykge1xuICAgICAgdGhpcy5fdmFsaWRhdGVBcmd1bWVudHMoW1tjb25kaXRpb24sICdmdW5jdGlvbicsIEVSUk1TRy5jb25kaXRpb24uYmFkLCBFUlJNU0cuY29uZGl0aW9uLm1pc3NpbmddLCBbY2FsbGJhY2ssICdmdW5jdGlvbicsIEVSUk1TRy5jYWxsYmFjay5iYWQsIEVSUk1TRy5jYWxsYmFjay5taXNzaW5nXV0pO1xuICAgICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJlZENhbGxiYWNrcy5wdXNoKHtcbiAgICAgICAgY29uZGl0aW9uOiBjb25kaXRpb24sXG4gICAgICAgIGNhbGxiYWNrOiBjYWxsYmFjayxcbiAgICAgICAgbWV0YTogSU5JVElBTC5tZXRhKClcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgdmFyIGNhbGxlZDtcbiAgICAgIGlmIChjYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICAgIGNhbGxiYWNrID0gdGhpcy5zZXR0aW5ncy5zdGFydDtcbiAgICAgIH1cbiAgICAgIGNhbGxlZCA9IG5vdygpO1xuICAgICAgdGhpcy5fdmFsaWRhdGVBcmd1bWVudHMoW1tjYWxsYmFjaywgJ2Z1bmN0aW9uJywgRVJSTVNHLmNhbGxiYWNrLmJhZF1dKTtcbiAgICAgIGlmICghdGhpcy5ydW5uaW5nKSB7XG4gICAgICAgIHRoaXMuY291bnQuc3RhcnQrKztcbiAgICAgICAgdGhpcy5ydW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy50aW1lLmxhc3Quc3RhcnQgPSBjYWxsZWQ7XG4gICAgICAgIHRoaXMuX2xvb3AoKTtcbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgY2FsbGJhY2sodGhpcy5fZ2V0SW5mbygpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgIHZhciBjYWxsZWQ7XG4gICAgICBpZiAoY2FsbGJhY2sgPT0gbnVsbCkge1xuICAgICAgICBjYWxsYmFjayA9IHRoaXMuc2V0dGluZ3Muc3RvcDtcbiAgICAgIH1cbiAgICAgIGNhbGxlZCA9IG5vdygpO1xuICAgICAgdGhpcy5fdmFsaWRhdGVBcmd1bWVudHMoW1tjYWxsYmFjaywgJ2Z1bmN0aW9uJywgRVJSTVNHLmNhbGxiYWNrLmJhZF1dKTtcbiAgICAgIGlmICh0aGlzLnJ1bm5pbmcpIHtcbiAgICAgICAgcmFmLmNhbmNlbCh0aGlzLnB1bHNlKTtcbiAgICAgICAgdGhpcy5jb3VudC5zdG9wKys7XG4gICAgICAgIHRoaXMucnVubmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnRpbWUubGFzdC5zdG9wID0gY2FsbGVkO1xuICAgICAgICB0aGlzLl9zdGVwKGNhbGxlZCk7XG4gICAgICAgIHRoaXMudGltZS5zdG9yZWQgKz0gdGhpcy50aW1lLnJ1bm5pbmc7XG4gICAgICAgIHRoaXMudGltZS5ydW5uaW5nID0gMDtcbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgY2FsbGJhY2sodGhpcy5fZ2V0SW5mbygpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBjb3VudCwgbWV0YSkge1xuICAgICAgdmFyIGNhbGxiYWNrRWxpZ2libGUsIGNhbGxlZDtcbiAgICAgIGlmIChjYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICAgIGNhbGxiYWNrID0gdGhpcy5zZXR0aW5ncy5yZXNldDtcbiAgICAgIH1cbiAgICAgIGlmIChjb3VudCA9PSBudWxsKSB7XG4gICAgICAgIGNvdW50ID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAobWV0YSA9PSBudWxsKSB7XG4gICAgICAgIG1ldGEgPSB0cnVlO1xuICAgICAgfVxuICAgICAgY2FsbGVkID0gbm93KCk7XG4gICAgICB0aGlzLl92YWxpZGF0ZUFyZ3VtZW50cyhbW2NhbGxiYWNrLCAnZnVuY3Rpb24nLCBFUlJNU0cuY2FsbGJhY2suYmFkXV0pO1xuICAgICAgaWYgKHRoaXMuX3Jlc2V0VGltZShjYWxsZWQpKSB7XG4gICAgICAgIGNhbGxiYWNrRWxpZ2libGUgPSB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKGNvdW50KSB7XG4gICAgICAgIGlmICh0aGlzLl9yZXNldENvdW50KCkpIHtcbiAgICAgICAgICBjYWxsYmFja0VsaWdpYmxlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKG1ldGEpIHtcbiAgICAgICAgdGhpcy5fcmVzZXRNZXRhKCk7XG4gICAgICB9XG4gICAgICBjYWxsYmFja0VsaWdpYmxlICYmICh0eXBlb2YgY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIiA/IGNhbGxiYWNrKHRoaXMuX2dldEluZm8oKSkgOiB2b2lkIDApO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5pbmZvID0gZnVuY3Rpb24oaW5mbywgY2FsbGJhY2spIHtcbiAgICAgIGlmIChjYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICAgIGNhbGxiYWNrID0gdGhpcy5zZXR0aW5ncy5pbmZvO1xuICAgICAgfVxuICAgICAgaWYgKGluZm8gIT0gbnVsbCkge1xuICAgICAgICB0aGlzLl92YWxpZGF0ZUFyZ3VtZW50cyhbW2luZm8sICdpbmZvJywgRVJSTVNHLmluZm8uYmFkLCBFUlJNU0cubm9Bcmd1bWVudHNdLCBbY2FsbGJhY2ssICdmdW5jdGlvbicsIEVSUk1TRy5jYWxsYmFjay5iYWRdXSk7XG4gICAgICAgIHRoaXMuX2FkanVzdEluZm8oJ3NldCcsIGluZm8pO1xuICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICBjYWxsYmFjayh0aGlzLl9nZXRJbmZvKCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dldEluZm8oKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgTG9ja3N0ZXAucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uKGluZm8sIGNhbGxiYWNrKSB7XG4gICAgICBpZiAoY2FsbGJhY2sgPT0gbnVsbCkge1xuICAgICAgICBjYWxsYmFjayA9IHRoaXMuc2V0dGluZ3MuYWRkO1xuICAgICAgfVxuICAgICAgdGhpcy5fdmFsaWRhdGVBcmd1bWVudHMoW1tpbmZvLCAnaW5mbycsIEVSUk1TRy5pbmZvLmJhZCwgRVJSTVNHLm5vQXJndW1lbnRzXSwgW2NhbGxiYWNrLCAnZnVuY3Rpb24nLCBFUlJNU0cuY2FsbGJhY2suYmFkXV0pO1xuICAgICAgdGhpcy5fYWRqdXN0SW5mbygnYWRkJywgaW5mbyk7XG4gICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgY2FsbGJhY2sodGhpcy5fZ2V0SW5mbygpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuc3VidHJhY3QgPSBmdW5jdGlvbihpbmZvLCBjYWxsYmFjaykge1xuICAgICAgaWYgKGNhbGxiYWNrID09IG51bGwpIHtcbiAgICAgICAgY2FsbGJhY2sgPSB0aGlzLnNldHRpbmdzLnN1YnRyYWN0O1xuICAgICAgfVxuICAgICAgdGhpcy5fdmFsaWRhdGVBcmd1bWVudHMoW1tpbmZvLCAnaW5mbycsIEVSUk1TRy5pbmZvLmJhZCwgRVJSTVNHLm5vQXJndW1lbnRzXSwgW2NhbGxiYWNrLCAnZnVuY3Rpb24nLCBFUlJNU0cuY2FsbGJhY2suYmFkXV0pO1xuICAgICAgdGhpcy5fYWRqdXN0SW5mbygnc3VidHJhY3QnLCBpbmZvKTtcbiAgICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBjYWxsYmFjayh0aGlzLl9nZXRJbmZvKCkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS53aGVuID0gZnVuY3Rpb24odGltZSwgY2FsbGJhY2spIHtcbiAgICAgIGlmIChjYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICAgIGNhbGxiYWNrID0gdGhpcy5zZXR0aW5ncy53aGVuO1xuICAgICAgfVxuICAgICAgdGhpcy5fdmFsaWRhdGVBcmd1bWVudHMoW1t0aW1lLCAndGltZScsIEVSUk1TRy50aW1lLmJhZCwgRVJSTVNHLm5vQXJndW1lbnRzXSwgW2NhbGxiYWNrLCAnZnVuY3Rpb24nLCBFUlJNU0cuY2FsbGJhY2suYmFkLCBFUlJNU0cuY2FsbGJhY2subWlzc2luZ11dKTtcbiAgICAgIHRoaXMucmVnaXN0ZXJDYWxsYmFjaygoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGluZm8sIG1ldGEpIHtcbiAgICAgICAgICByZXR1cm4gbWV0YS5wYXNzZWQuY291bnQgPT09IDAgJiYgX3RoaXMuX2VsYXBzZWRUaW1lVG9SdW5uaW5nVGltZShpbmZvLnRpbWUuZWxhcHNlZCkgPj0gX3RoaXMuX3RvUnVubmluZ1RpbWUodGltZSk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSwgY2FsbGJhY2spO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5ldmVyeSA9IGZ1bmN0aW9uKHRpbWUsIGNhbGxiYWNrKSB7XG4gICAgICBpZiAoY2FsbGJhY2sgPT0gbnVsbCkge1xuICAgICAgICBjYWxsYmFjayA9IHRoaXMuc2V0dGluZ3MuZXZlcnk7XG4gICAgICB9XG4gICAgICB0aGlzLl92YWxpZGF0ZUFyZ3VtZW50cyhbW3RpbWUsICd0aW1lJywgRVJSTVNHLnRpbWUuYmFkLCBFUlJNU0cubm9Bcmd1bWVudHNdLCBbY2FsbGJhY2ssICdmdW5jdGlvbicsIEVSUk1TRy5jYWxsYmFjay5iYWQsIEVSUk1TRy5jYWxsYmFjay5taXNzaW5nXV0pO1xuICAgICAgdGhpcy5yZWdpc3RlckNhbGxiYWNrKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oaW5mbywgbWV0YSkge1xuICAgICAgICAgIHJldHVybiBfdGhpcy5fZWxhcHNlZFRpbWVUb1J1bm5pbmdUaW1lKGluZm8udGltZS5lbGFwc2VkKSAtIG1ldGEucGFzc2VkLmxhc3QgPj0gX3RoaXMuX3RvUnVubmluZ1RpbWUodGltZSk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSwgY2FsbGJhY2spO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZVtcIndoaWxlXCJdID0gZnVuY3Rpb24oc3RhcnRUaW1lLCBlbmRUaW1lLCBjYWxsYmFjaykge1xuICAgICAgaWYgKGNhbGxiYWNrID09IG51bGwpIHtcbiAgICAgICAgY2FsbGJhY2sgPSB0aGlzLnNldHRpbmdzW1wid2hpbGVcIl07XG4gICAgICB9XG4gICAgICB0aGlzLl92YWxpZGF0ZUFyZ3VtZW50cyhbW3N0YXJ0VGltZSwgJ3RpbWUnLCBFUlJNU0cuc3RhcnRUaW1lLmJhZCwgRVJSTVNHLm5vQXJndW1lbnRzXSwgW2VuZFRpbWUsICd0aW1lJywgRVJSTVNHLmVuZFRpbWUuYmFkLCBFUlJNU0cuZW5kVGltZS5taXNzaW5nXSwgW2NhbGxiYWNrLCAnZnVuY3Rpb24nLCBFUlJNU0cuY2FsbGJhY2suYmFkLCBFUlJNU0cuY2FsbGJhY2subWlzc2luZ11dKTtcbiAgICAgIHRoaXMucmVnaXN0ZXJDYWxsYmFjaygoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGluZm8pIHtcbiAgICAgICAgICB2YXIgX3JlZjtcbiAgICAgICAgICByZXR1cm4gKF90aGlzLl90b1J1bm5pbmdUaW1lKHN0YXJ0VGltZSkgPD0gKF9yZWYgPSBfdGhpcy5fZWxhcHNlZFRpbWVUb1J1bm5pbmdUaW1lKGluZm8udGltZS5lbGFwc2VkKSkgJiYgX3JlZiA8PSBfdGhpcy5fdG9SdW5uaW5nVGltZShlbmRUaW1lKSk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSwgY2FsbGJhY2spO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5kdXJpbmcgPSBmdW5jdGlvbihzdGFydFRpbWUsIGVuZFRpbWUsIHN0YXJ0Q2FsbGJhY2ssIGVuZENhbGxiYWNrKSB7XG4gICAgICBpZiAoc3RhcnRDYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICAgIHN0YXJ0Q2FsbGJhY2sgPSB0aGlzLnNldHRpbmdzLmR1cmluZ1N0YXJ0O1xuICAgICAgfVxuICAgICAgaWYgKGVuZENhbGxiYWNrID09IG51bGwpIHtcbiAgICAgICAgZW5kQ2FsbGJhY2sgPSB0aGlzLnNldHRpbmdzLmR1cmluZ0VuZDtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3ZhbGlkYXRlQXJndW1lbnRzKFtbc3RhcnRUaW1lLCAndGltZScsIEVSUk1TRy5zdGFydFRpbWUuYmFkLCBFUlJNU0cubm9Bcmd1bWVudHNdLCBbZW5kVGltZSwgJ3RpbWUnLCBFUlJNU0cuZW5kVGltZS5iYWQsIEVSUk1TRy5lbmRUaW1lLm1pc3NpbmddLCBbc3RhcnRDYWxsYmFjaywgJ2Z1bmN0aW9uJywgRVJSTVNHLnN0YXJ0Q2FsbGJhY2suYmFkLCBFUlJNU0cuc3RhcnRDYWxsYmFjay5taXNzaW5nXSwgW2VuZENhbGxiYWNrLCAnZnVuY3Rpb24nLCBFUlJNU0cuZW5kQ2FsbGJhY2suYmFkLCBFUlJNU0cuZW5kQ2FsbGJhY2subWlzc2luZ11dKTtcbiAgICAgIHRoaXMud2hlbihzdGFydFRpbWUsIHN0YXJ0Q2FsbGJhY2spO1xuICAgICAgdGhpcy53aGVuKGVuZFRpbWUsIGVuZENhbGxiYWNrKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBMb2Nrc3RlcC5wcm90b3R5cGUuYmVnaW5uaW5nID0gZnVuY3Rpb24oc3RhcnRUaW1lLCBzdGFydENhbGxiYWNrKSB7XG4gICAgICBpZiAoc3RhcnRDYWxsYmFjayA9PSBudWxsKSB7XG4gICAgICAgIHN0YXJ0Q2FsbGJhY2sgPSB0aGlzLnNldHRpbmdzLmJlZ2lubmluZztcbiAgICAgIH1cbiAgICAgIHRoaXMuX3ZhbGlkYXRlQXJndW1lbnRzKFtbc3RhcnRUaW1lLCAndGltZScsIEVSUk1TRy5zdGFydFRpbWUuYmFkLCBFUlJNU0cubm9Bcmd1bWVudHNdLCBbc3RhcnRDYWxsYmFjaywgJ2Z1bmN0aW9uJywgRVJSTVNHLnN0YXJ0Q2FsbGJhY2suYmFkLCBFUlJNU0cuc3RhcnRDYWxsYmFjay5taXNzaW5nXV0pO1xuICAgICAgdGhpc1tcIndoaWxlXCJdKHN0YXJ0VGltZSwgSW5maW5pdHksIHN0YXJ0Q2FsbGJhY2spO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIExvY2tzdGVwLnByb3RvdHlwZS5lbmRpbmcgPSBmdW5jdGlvbihlbmRUaW1lLCBlbmRDYWxsYmFjaykge1xuICAgICAgaWYgKGVuZENhbGxiYWNrID09IG51bGwpIHtcbiAgICAgICAgZW5kQ2FsbGJhY2sgPSB0aGlzLnNldHRpbmdzLmVuZGluZztcbiAgICAgIH1cbiAgICAgIHRoaXMuX3ZhbGlkYXRlQXJndW1lbnRzKFtbZW5kVGltZSwgJ3RpbWUnLCBFUlJNU0cudGltZS5iYWQsIEVSUk1TRy5ub0FyZ3VtZW50c10sIFtlbmRDYWxsYmFjaywgJ2Z1bmN0aW9uJywgRVJSTVNHLmVuZENhbGxiYWNrLmJhZCwgRVJSTVNHLmVuZENhbGxiYWNrLm1pc3NpbmddXSk7XG4gICAgICB0aGlzW1wid2hpbGVcIl0oMCwgZW5kVGltZSwgZW5kQ2FsbGJhY2spO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIHJldHVybiBMb2Nrc3RlcDtcblxuICB9KSgpO1xuXG4gIG1vZHVsZS5leHBvcnRzID0gTG9ja3N0ZXA7XG5cbn0pLmNhbGwodGhpcyk7XG5cbn0pLmNhbGwodGhpcyxyZXF1aXJlKFwiMVlpWjVTXCIpKSJdfQ==
(5)
});
